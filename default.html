<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bio Bank</title>

  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Round|Material+Icons+Sharp|Material+Icons+Two+Tone"
    rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" />

  <!-- jQuery UI CSS for datepicker -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>

  <script
    src="https://cdn.jsdelivr.net/npm/tempusdominus-bootstrap-4@5.39.0/build/js/tempusdominus-bootstrap-4.min.js"></script>

  <link rel="stylesheet" href="assets/css/style.css">
  <script src="index.js"></script>

  <style>
    /* Progress Bar Styles */
    /* #progressBarContainer {
      height: 20px;
      background-color: #f3f3f3;
      border-radius: 10px;
    }

    #progressBar {
      height: 100%;
      border-radius: 10px;
      text-align: center;
      line-height: 20px;
      color: white;
      font-weight: bold;
    } */
    :root {
      --primary-color: #1991c9;
    }

    /* Progressbar */
    .progressbar {
      position: relative;
      display: flex;
      width: 900px;
      justify-content: space-between;
      counter-reset: step;
      margin: 1rem 4rem 1rem 5rem;
    }

    .progressbar::before,
    .progress {
      content: "";
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 4px;
      width: 100%;
      background-color: #dcdcdc;
      z-index: -1;
    }

    .progress {
      background-color: var(--primary-color);
      width: 0%;
      transition: 0.3s;
    }

    .progress-step {
      width: 2.1875rem;
      height: 2.1875rem;
      background-color: #e0e0e0;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .progress-step::before {
      counter-increment: step;
      content: counter(step);
    }

    .progress-step-active {
      background-color: var(--primary-color);
      color: #f3f3f3;
    }

    .nav-tab-link {
      color: #1991c9;
      font-weight: bold;
    }
  </style>

</head>

<body>
  <nav class="navbar sticky-top navbar-expand-lg navbar-light" style="background-color: #1991c994;">
    <div class="container-fluid">
      <div class="mx-auto">
        <ul class="nav nav-pills nav-fill">
          <li class="nav-item">
            <a class="nav-link" href="statistics.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="home.html">Sample</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="search.html">Search</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="todo.html">To-Do list</a>
          </li>

        </ul>
      </div>
      <div class="d-flex ms-auto">
        <button onclick="logout()" id="logout" type="submit" class="btn btn-outline-light">Logout</button>
      </div>
    </div>
  </nav>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item" id="bread2"></li>
      <li class="breadcrumb-item active" aria-current="page">Library</li>
    </ol>
  </nav>
  <div class="wrapper">
    <div class="container mt-3">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link nav-tab-link active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab"
            aria-controls="tab1" aria-selected="true">Sample Inputs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-tab-link" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab" aria-controls="tab2"
            aria-selected="false">Follow-Ups</a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-tab-link" id="tab3-tab" data-toggle="tab" href="#tab3" role="tab" aria-controls="tab3"
            aria-selected="false">Shared</a>
        </li>
      </ul>

      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">

          <div class="progressbar">
            <div class="progress" id="progress"></div>
            <div class="progress-step progress-step-active" data-title="form1"></div>
            <div class="progress-step" data-title="form2"></div>
            <div class="progress-step" data-title="form3"></div>
          </div>
          <div class="table-responsive" id="inputSampleTable">
            <form class="form-group mt-3 form-step form-step-active" id="form1">
              <div class="row ml-1 mb-3">
                <h3>Initial Entry</h3>
              </div>

              <div class="row ml-1 mb-3" id="mnrId">
                <label for="mrnNo" class="col-sm-2 mb-1 col-form-label">MRN Number <span
                    style="color: red; font-weight: bold;">*</span> </label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="mrnNo" placeholder="Enter MRN Number" required>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="bioBankId" class="col-sm-2 mb-1 col-form-label">Bio Bank ID <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="bioBankId" placeholder="Enter Bio Bank ID" required>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="patAge" class="col-sm-2 mb-1 col-form-label">Age <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="100" id="patAge" class="form-control" placeholder="yrs">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="gender" class="col-sm-2 mb-1 col-form-label">Gender <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioMale" name="customRadio" class="custom-control-input" value="M">
                    <label class="custom-control-label" for="radioMale">Male</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioFemale" name="customRadio" class="custom-control-input" value="F">
                    <label class="custom-control-label" for="radioFemale">Female</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="cancer_type" class="col-sm-2 mb-1 col-form-label">Cancer Type <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadio1" name="radioCancerType" class="custom-control-input" required
                      value="brst">
                    <label class="custom-control-label" for="customRadio1">Breast Cancer</label>
                  </div>
                  <!-- <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadio2" name="radioCancerType" class="custom-control-input">
                    <label class="custom-control-label" for="customRadio2">Liver Cancer</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadio3" name="radioCancerType" class="custom-control-input">
                    <label class="custom-control-label" for="customRadio3">Throat Cancer</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadio4" name="radioCancerType" class="custom-control-input">
                    <label class="custom-control-label" for="customRadio4">Lung Cancer</label>
                  </div> -->
                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="cancer_stage" class="col-sm-2 mb-1 col-form-label">Cancer Stage <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio0" name="radioCancerStage" class="custom-control-input"
                      value="Stage0">
                    <label class="custom-control-label" for="CSRadio0">Stage 0</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio1" name="radioCancerStage" class="custom-control-input"
                      value="Stage1">
                    <label class="custom-control-label" for="CSRadio1">Stage 1</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio2" name="radioCancerStage" class="custom-control-input"
                      value="Stage2">
                    <label class="custom-control-label" for="CSRadio2">Stage 2</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio3" name="radioCancerStage" class="custom-control-input"
                      value="Stage3">
                    <label class="custom-control-label" for="CSRadio3">Stage 3</label>
                  </div>
                </div>
              </div> -->

              <div class="row ml-1 mb-3">
                <label for="procedure" class="col-sm-2 mb-1 col-form-label">Procedure Types <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioProcedure1" name="customProcedure" class="custom-control-input"
                      value="b" required>
                    <label class="custom-control-label" for="radioProcedure1">Biopsy</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioProcedure2" name="customProcedure" class="custom-control-input"
                      value="r" required>
                    <label class="custom-control-label" for="radioProcedure2">Resection</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="procedureDetail" class="col-sm-2 mb-1 col-form-label">Details of Procedure</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="procedureDetail" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="surgeonName" class="col-sm-2 mb-1 col-form-label">Surgeon Name</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="surgeonName" placeholder="Enter the Name of Surgeon">
                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Box No.</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="boxNo" placeholder="Box No.">
                </div>
              </div> -->
              <div class="row ml-1 mb-3">
                <label for="MetastasisSample" class="col-sm-2 mb-1 col-form-label">Metastasis Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MetastasisSampleY" name="MetastasisSample" class="custom-control-input"
                      value=true required>
                    <label class="custom-control-label" for="MetastasisSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MetastasisSampleN" name="MetastasisSample" class="custom-control-input"
                      value=false required>
                    <label class="custom-control-label" for="MetastasisSampleN">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="specimensample" class="col-sm-2 mb-1 col-form-label">Specimen Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="specimenSampleY" name="specimenSample" class="custom-control-input"
                      value=true required>
                    <label class="custom-control-label" for="specimenSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="specimenSampleN" name="specimenSample" class="custom-control-input"
                      value=false required>
                    <label class="custom-control-label" for="specimenSampleN">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="countFttubes" style="display: none;">
                <label for="ft_tubes" class="col-sm-2 mb-1 col-form-label">No of FT Tubes <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <select id="ft_tubes" class="form-control">
                    <option value="">None</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="fttubes" style="display: none;">
                <label for="gridNo" class="col-sm-2 mb-1 col-form-label">FT Tubes Grids <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="ftgrid" onclick="FTModal()" placeholder="FT Grid No.">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="countFntubes" style="display: none;">
                <label for="fn_tubes" class="col-sm-2 mb-1 col-form-label">No of FN Tubes <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <select id="fn_tubes" class="form-control">
                    <option value="">None</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="fntubes" style="display: none;">
                <label for="gridNo" class="col-sm-2 mb-1 col-form-label">FN Tubes Grids <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="fngrid" onclick="FNModal()" placeholder="FN Grid No.">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="bloodsample">
                <label for="bloodsample" class="col-sm-2 mb-1 col-form-label">Blood Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="bloodSampleY" name="bloodSample" class="custom-control-input" value=true
                      required>
                    <label class="custom-control-label" for="bloodSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="bloodSampleN" name="bloodSample" class="custom-control-input" value=false
                      required>
                    <label class="custom-control-label" for="bloodSampleN">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="plasmatubes" style="display: none;">
                <label for="PlasmagridNo" class="col-sm-2 mb-1 col-form-label">Plasma Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="PlasmagridNo" onclick="plasmaModal()"
                    placeholder="Plasma Grid">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="serumtubes" style="display: none;">
                <label for="SerumgridNo" class="col-sm-2 mb-1 col-form-label">Serum Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="SerumgridNo" onclick="serumModal()"
                    placeholder="Serum Grid">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="bufferCoatTubes" style="display: none;">
                <label for="bufferCoatgridNo" class="col-sm-2 mb-1 col-form-label">Buffy Coat Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="bufferCoatgridNo" onclick="buffyModal()"
                    placeholder="Buffer Grid">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="otherSample" class="col-sm-2 mb-1 col-form-label">Other Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="otherSampleY" name="otherSample" class="custom-control-input" value=true
                      required>
                    <label class="custom-control-label" for="otherSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="otherSampleN" name="otherSample" class="custom-control-input" value=false
                      required>
                    <label class="custom-control-label" for="otherSampleN">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="oSampleTubes" style="display: none;">
                <label for="OSgridNo" class="col-sm-2 mb-1 col-form-label">Other Sample Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="OSgridNo" onclick="OSModal()"
                    placeholder="Other Sample Grid">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="oSampleDesc" style="display: none;">
                <label for="otSampleDesc" class="col-sm-2 mb-1 col-form-label">Other Sample description</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="otSampleDesc" placeholder="Other sample description">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="consent" class="col-sm-2 mb-1 col-form-label">Consent</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioConsent1" name="customConsent" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="radioConsent1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioConsent2" name="customConsent" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="radioConsent2">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ischemic" class="col-sm-2 mb-1 col-form-label">Ischemic Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioIschemic1" name="IschemicRadio" class="custom-control-input"
                      value=true>
                    <label class="custom-control-label" for="radioIschemic1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioIschemic2" name="IschemicRadio" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="radioIschemic2">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="ischemic" class="col-sm-2 mb-1 col-form-label">All samples Received Together? <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioprocessed1" name="processedRadio" class="custom-control-input"
                      value=true>
                    <label class="custom-control-label" for="radioprocessed1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioprocessed2" name="processedRadio" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="radioprocessed2">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="AllSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="processedBy" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="receiveAllSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label"> Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="sampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="sampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processAllSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Processed Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="sampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="sampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="BloodSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Blood Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="BprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveBloodSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Blood sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="bloodSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="bloodSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processBloodSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Blood sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="bloodSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="bloodSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="SpecimenSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Specimen Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="SprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveSpecimenSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Specimen sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="SpecimenSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="SpecimenSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processSpecimenSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Specimen sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="SpecimenSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="SpecimenSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="OtherSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Other Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="OprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveOtherSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Other sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="OtherSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="OtherSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processOtherSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Other sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="OtherSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="OtherSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div id="sefCurrentUser" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Data Entry By </label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="sefdataEB" placeholder="">
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="row" style="justify-content: space-around;">
                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-success btn-xs" id="sampleEntry1">Done</button>
                  </div>
                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-primary btn-xs btn-next" id="nextButton1">Next</button>
                  </div>
                </div>
              </div>
            </form>
            <form class="form-group mt-3 form-step" id="form2" style="display: none;">
              <div class="row ml-1 mb-3">
                <h3>MetaData</h3>
              </div>
              <div id="mdCurrentUser" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="boxNo" class="col-sm-3 mb-1 col-form-label">Data Entry By </label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="mddataEB" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="RadioFHabit" class="col-sm-3 mb-1 col-form-label">Family History of Cancer</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="familyHistoryCancer1" name="RadioFHabit" class="custom-control-input"
                      value=true>
                    <label class="custom-control-label" for="familyHistoryCancer1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="familyHistoryCancer2" name="RadioFHabit" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="familyHistoryCancer2">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="relation_Cancer" style="display: none;">
                <label for="date" class="col-sm-3 mb-1 col-form-label">Relation and Cancer type</label>
                <div class="col-sm-9">
                  <div class="row">
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="familyRelation" placeholder="Relation">
                    </div>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="familyCancerType" placeholder="Cancer Type">
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="foodHabit" class="col-sm-3 mb-1 col-form-label">Food Habits</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="foodH1" name="RadioFdHabit" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="foodH1">Veg</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="foodH2" name="RadioFdHabit" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="foodH2">Non Veg</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="alcoholHabit" class="col-sm-3 mb-1 col-form-label">History of Alcohol Consumption</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="AlcoholH1" name="RadioAlcoholHabit" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="AlcoholH1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="AlcoholH2" name="RadioAlcoholHabit" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="AlcoholH2">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="smokingHabit" class="col-sm-3 mb-1 col-form-label">History of Smoking</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="smokeH1" name="RadioSmokeHabit" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="smokeH1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="smokeH2" name="RadioSmokeHabit" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="smokeH2">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="EComorb" class="col-sm-3 mb-1 col-form-label">Existing Comorbidities</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ECH1" name="ECH" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="ECH1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ECH2" name="ECH" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="ECH2">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="medications" style="display: none;">
                <label for="Comorbidity" class="col-sm-3 mb-1 col-form-label">Comorbidity & Corresponding Medications
                  for Comorbidity</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="comorbidityMedications" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="FF_QC" class="col-sm-3 mb-1 col-form-label">FF_QC comments</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="ffQcComments" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="FF_ti" class="col-sm-3 mb-1 col-form-label">FF_tissue Remarks</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="ffTissueRemarks" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="tumor" class="col-sm-3 mb-1 col-form-label">Tumor Site (Right/Left/Bilateral)</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="tumorR" name="tumorSite" class="custom-control-input" value="R">
                    <label class="custom-control-label" for="tumorR">Right</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="tumorL" name="tumorSite" class="custom-control-input" value="L">
                    <label class="custom-control-label" for="tumorL">Left</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="tumorB" name="tumorSite" class="custom-control-input" value="BL">
                    <label class="custom-control-label" for="tumorB">Bilateral</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="tumorPercentage" class="col-sm-3 mb-1 col-form-label">Tumor %</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="tumorPercentage" placeholder="Percentage %">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ageAtDiagnosis" class="col-sm-3 mb-1 col-form-label">Age at Diagnosis</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="ageAtDiagnosis" placeholder="yrs">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="cStage" class="col-sm-3 mb-1 col-form-label">Clinical Stage</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="clinicalStage" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="IHC_Status" class="col-sm-3 mb-1 col-form-label">IHC Marker status</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="IHC_yes" name="IHC" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="IHC_yes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="IHC_no" name="IHC" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="IHC_no">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="ihcDescr" style="display: none;">
                <label for="IHC_Description" class="col-sm-3 mb-1 col-form-label">IHC Marker Description</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="IHC_Description" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="gTest" class="col-sm-3 mb-1 col-form-label">Genetic Testing</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="gt_yes" name="GeneticT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="gt_yes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="gt_no" name="GeneticT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="gt_no">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="dt_Desc" style="display: none;">
                <label for="GT_Description" class="col-sm-3 mb-1 col-form-label">Genetic Testing Description</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="GT_Description" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="pSubtype" class="col-sm-3 mb-1 col-form-label">Pathologic Subtype</label>
                <div class="col-sm-9">
                  <select id="subtype" class="form-control">
                    <option value="">Select</option>
                    <option value="option1">No residual invasive carcinoma</option>
                    <option value="option2">Invasive carcinoma of no special type (ductal)</option>
                    <option value="option3">Micro-invasive carcinoma</option>
                    <option value="option4">Invasive lobular carcinoma</option>
                    <option value="option5">Invasive carcinoma with mixed ductal and lobular features</option>
                    <option value="option6">Invasive carcinoma with features of (specify)</option>
                    <option value="option7">Tubular carcinoma</option>
                    <option value="option8">Invasive cribriform carcinoma</option>
                    <option value="option9">Mucinous carcinoma</option>
                    <option value="option10">Invasive micropapillary carcinoma</option>
                    <option value="option11">Apocrine adenocarcinoma</option>
                    <option value="option12">Metaplastic carcinoma</option>
                    <option value="option13">Encapsulated papillary carcinoma with invasion</option>
                    <option value="option14">Solid papillary carcinoma with invasion</option>
                    <option value="option15">Intraductal papillary adenocarcinoma with invasion</option>
                    <option value="option16">Adenoid cystic carcinoma</option>
                    <option value="option17">Neuroendocrine tumor</option>
                    <option value="option18">Neuroendocrine carcinoma</option>
                    <option value="option19">Invasive carcinoma, type cannot be determined</option>
                    <option value="other">Other histologic type not listed (specify)</option>
                  </select>
                </div>
              </div>
              <div id="pSubtypeOther" style="display: none;">
                <div class="row ml-1 mb-3">
                  <div class="col-sm-3 mb-1">
                    <label for="pSubtypeOther" class="col-form-label">Other Subtype</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="pstOt" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="grade" class="col-sm-3 mb-1 col-form-label">Grade</label>
                <div class="col-sm-9">
                  <select id="sampleGrade" class="form-control">
                    <option value="">Select</option>
                    <option value="grade1">Grade 1</option>
                    <option value="grade2">Grade 2</option>
                    <option value="grade3">Grade 3</option>
                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="focality" class="col-sm-3 mb-1 col-form-label">Focality</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="unifocal" name="focal" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="unifocal">Unifocal</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="multifocal" name="focal" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="multifocal">Multifocal</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="LVI" class="col-sm-3 mb-1 col-form-label">LVI</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="lviYes" name="LVI" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="lviYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="lviNo" name="LVI" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="lviNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="PNI" class="col-sm-3 mb-1 col-form-label">PNI</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PNIYes" name="PNI" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="PNIYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PNINo" name="PNI" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="PNINo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="pTNM" class="col-sm-3 mb-1 col-form-label">pTNM</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="pTNM" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="AJCC" class="col-sm-3 mb-1 col-form-label">AJCC Staging</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="AJCC" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="nodes" class="col-sm-3 mb-1 col-form-label">Number of Nodes tested</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="nodesTested" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="nodes" class="col-sm-3 mb-1 col-form-label">Number of Positive Nodes</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="positiveNodes" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="tumor_Size" class="col-sm-3 mb-1 col-form-label">Tumor Size</label>
                <div class="col-sm-9">
                  <div class="row">
                    <div class="col-4">
                      <input type="text" class="form-control" id="tumorSizeL" placeholder="cm">
                    </div>
                    <div class="col-4">
                      <input type="text" class="form-control" id="tumorSizeW" placeholder="cm">
                    </div>
                    <div class="col-4">
                      <input type="text" class="form-control" id="tumorSizeH" placeholder="cm">
                    </div>
                  </div>

                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="denovo" class="col-sm-3 mb-1 col-form-label">Denovo metastasis</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="denovoYes" name="denovo" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="denovoYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="denovoNo" name="denovo" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="denovoNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="MetastasisPT" class="col-sm-3 mb-1 col-form-label">Metastasis Post Treatment</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MPTYes" name="MPT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="MPTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MPTNo" name="MPT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="MPTNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="HPE" class="col-sm-3 mb-1 col-form-label">Biopsy Tissue number HPE</label>
                <div class="col-sm-9">
                  <input type="text" id="btHPEInput" class="form-control" placeholder="24-S-xxxxxx" maxlength="11"
                    oninput="formatbtHPEInput(this)" />
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="biospyDate" class="col-sm-3 mb-1 col-form-label">Biopsy Date</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="biopsyDate" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="NACT" class="col-sm-3 mb-1 col-form-label">NACT</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="NACTYes" name="NACT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="NACTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="NACTNo" name="NACT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="NACTNo">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="nactDC" style="display: none;">
                <label for="NACT_cycle" class="col-sm-3 mb-1 col-form-label">NACT Drug Cycle</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="NACT_cycle" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="nactDLC" style="display: none;">
                <label for="NACT_cycle_D" class="col-sm-3 mb-1 col-form-label">NACT Date of last Cycle</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="NACT_cycle_D" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="surTissueNum" class="col-sm-3 mb-1 col-form-label">Surgery Tissue Number HPE</label>
                <div class="col-sm-9">
                  <input type="text" id="StHPEInput" class="form-control" placeholder="24-S-xxxxxx" maxlength="11"
                    oninput="formatStHPEInput(this)" />
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="surDate" class="col-sm-3 mb-1 col-form-label">Surgery Date</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="surgeryDate" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="rcbScore" class="col-sm-3 mb-1 col-form-label">RCB Scores</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="rcbScores" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ACT" class="col-sm-3 mb-1 col-form-label">ACT</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ACTYes" name="ACT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="ACTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ACTNo" name="ACT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="ACTNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="actDC" style="display: none;">
                <label for="ACT_Cycles" class="col-sm-3 mb-1 col-form-label">ACT Drug Cycles</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="actDrugCycles" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="actDLC" style="display: none;">
                <label for="actDate" class="col-sm-3 mb-1 col-form-label">ACT Date of last Cycle</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="actDateLastCycle" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="radioThy" class="col-sm-3 mb-1 col-form-label">Radio Therapy</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="RTYes" name="RadioT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="RTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="RTNo" name="RadioT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="RTNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="rtDC" style="display: none;">
                <label for="RT_Cycles" class="col-sm-3 mb-1 col-form-label">Radiotherapy Details</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="radiotherapyDetails" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="rtDLC" style="display: none;">
                <label for="rtDate" class="col-sm-3 mb-1 col-form-label">Radiotherapy Date of last Cycle</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="radiotherapyLastCycleDate" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="paraThy" class="col-sm-3 mb-1 col-form-label">Is paraffin Block Available</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pbYes" name="pbT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="pbYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pbNo" name="pbT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="pbNo">No</label>
                  </div>
                </div>
              </div>


              <div class="col-12">
                <div class="row" style="justify-content: space-around;">

                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-primary btn-xs btn-prev" id="backButton1">Back</button>
                  </div>
                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-success btn-xs btn-next" id="nextButton2">Next</button>
                  </div>
                </div>
              </div>
            </form>
            <form class="form-group mt-3 form-step" id="form3" style="display: none;">
              <div class="row ml-1 mb-3">
                <h3>BR Specific</h3>
              </div>
              <div id="brfCurrentUser" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Data Entry By </label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="brfdataEB" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="age@menarche" class="col-sm-2 mb-1 col-form-label">Age at Menarche</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="8" max="30" id="ageAtMenarche" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="parity" class="col-sm-2 mb-1 col-form-label">Parity</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="15" id="parity" name="parity" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="noChild" style="display: none;">
                <label for="noChild" class="col-sm-2 mb-1 col-form-label">Number of Children</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="15" id="numChild" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="ageFC" style="display: none;">
                <label for="ageFC" class="col-sm-2 mb-1 col-form-label">Age at First Child</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="10" max="60" id="ageAtFirstChild" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="breFd" style="display: none;">
                <label for="breFd" class="col-sm-2 mb-1 col-form-label">Breastfed</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="breFdYes" name="breFd" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="breFdYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="breFdNo" name="breFd" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="breFdNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="durFeed" style="display: none;">
                <label for="durFeed" class="col-sm-2 mb-1 col-form-label">Duration of Breast Feeding</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="dbf" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="mStatus" class="col-sm-2 mb-1 col-form-label">Menopausal Status</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="mStatusPre" name="mStatus" class="custom-control-input"
                      value="Pre Menopausal">
                    <label class="custom-control-label" for="mStatusPre">Pre Menopausal</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="mStatusPost" name="mStatus" class="custom-control-input"
                      value="Post Menopausal">
                    <label class="custom-control-label" for="mStatusPost">Post Menopausal</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="mStatusHyster" name="mStatus" class="custom-control-input"
                      value="Hysterectomy">
                    <label class="custom-control-label" for="mStatusHyster">Hysterectomy</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="age@Diagon" class="col-sm-2 mb-1 col-form-label">Age at Diagnosis</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="100" id="ad" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ER" class="col-sm-2 mb-1 col-form-label">ER</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ERPos" name="ERRadio" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="ERPos">Positive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ERNev" name="ERRadio" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="ERNev">Negative</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="PR" class="col-sm-2 mb-1 col-form-label">PR</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PRPos" name="PRRadio" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="PRPos">Positive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PRNev" name="PRRadio" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="PRNev">Negative</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="HER2" class="col-sm-2 mb-1 col-form-label">HER2</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="HER2Pos" name="HER2Radio" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="HER2Pos">Positive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="HER2Nev" name="HER2Radio" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="HER2Nev">Negative</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="subType" class="col-sm-2 mb-1 col-form-label">Subtype</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="sbt" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ki" class="col-sm-2 mb-1 col-form-label">Ki67</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" class="form-control" id="k67" placeholder="Percentage %">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ClinicalS" class="col-sm-2 mb-1 col-form-label">Clinical Stage</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="ClinicalS" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="histo_t" class="col-sm-2 mb-1 col-form-label">Histological Stage</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="HistologicalS" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="stils" class="col-sm-2 mb-1 col-form-label">sTILs Percent Scores</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" class="form-control" id="sps" placeholder="Percentage %">
                </div>
              </div>

              <div class="col-12">
                <div class="row" style="justify-content: space-around;">
                  <div class="col-4 mt-6" style="text-align: center;">
                    <button type="button" class="btn btn-primary btn-xs btn-prev" id="backButton2">Back</button>
                  </div>
                  <!-- <div class="col-4 mt-6" id style="text-align: center; display: flex; justify-content: space-around;" >
                  </div> -->
                  <div class="col-4 mt-6" style="text-align: center; display: flex; justify-content: space-around;">
                    <button type="button" class="btn btn-success btn-xs" id="finishButton">Finish</button>

                    <button type="button" class="btn btn-success btn-xs" id="submitButton">Submit</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <!-- Submit Button -->
        </div>

        <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
          <form class="form-group mt-3">
            <div class="form-check pl-2">
              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold" for="">Last Followup status <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDisease"
                      value="DiseaseF">
                    <label class="custom-control-label" for="radioDisease">Disease Free</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioRecurrence"
                      value="Recurrence">
                    <label class="custom-control-label" for="radioRecurrence">Recurrence</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDiseasePro"
                      value="diseasePro">
                    <label class="custom-control-label" for="radioDiseasePro">Disease Progressive</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDeath_Disease"
                      value="death_Dise">
                    <label class="custom-control-label" for="radioDeath_Disease">Death due to disease</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioLost"
                      value="Lost_Follow">
                    <label class="custom-control-label" for="radioLost">Lost to Follow up</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioOther"
                      value="Other">
                    <label class="custom-control-label" for="radioOther">Other</label>
                  </div>
                </div>
              </div>



              <div class="row ml-1 mb-3" id="otherText" style="display: none;">
                <label class="col-sm-2 col-form-label Bold">Other reason</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="otherR" placeholder="Other reason">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold" for="startInputFollow">Last Follow up Date</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="startInputFollow" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="lostFollowUpID" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="reason">Reason For lost to follow up</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="lostFollowUp" placeholder="Reason">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="recurID" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="recurrenceDate">Recurrence Date</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="recurrenceDate" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="proDisID" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="reportedDate">Reported Date for Progressive
                  Disease</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="reportedDate" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="pmr" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="remark">Progression metastasis remark</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="PET" placeholder="Remark">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold">Vital Status <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" name="livestatus" id="radioAlive" value="Alive">
                    <label class="custom-control-label" for="radioAlive">Alive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" name="livestatus" id="radioDead" value="Dead">
                    <label class="custom-control-label" for="radioDead">Dead</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="deathDateContainer" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="deathDate">Death Date</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="deathDate" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold" for="remark">Remark</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" placeholder="Remark" id="remark">
                </div>
              </div>

              <div class="row " style="text-align: center;">
                <div class="col-sm-12">
                  <button type="button" class="btn btn-success" onclick="submitFollowup()">Submit</button>
                  <!-- Function call here -->
                </div>
              </div>
            </div>
          </form>
        </div>


        <div class="tab-pane fade" id="tab3" role="tabpanel" aria-labelledby="tab3-tab">
          <div class="card" id="sharedCard" style="display: none;">
            <!-- <div class="card-header" style="text-align: center;">
              Featured
            </div> -->
            <div class="card-container">
              <!-- Cards will be dynamically inserted here -->
            </div>
          </div>



          <form class="form-group mt-3" id="shareForm" style="display: block;">
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Date <span
                  style="color: red; font-weight: bold;">*</span></label>
              <div class="col-sm-10 mt-2">
                <input type="text" id="startInputOutsource" class="form-control" placeholder="Select Date">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Institute /
                Department <span style="color: red; font-weight: bold;">*</span></label>
              <div class="col-sm-10 mt-2">
                <input type="text" class="form-control " placeholder="Name of the Institite / Department"
                  id="institute">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Project <span
                  style="color: red; font-weight: bold;">*</span> </label>
              <div class="col-sm-10 mt-2">
                <input type="text" class="form-control " placeholder="Name the project" id="projectName">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">PI of the Project</label>
              <div class="col-sm-10 mt-2">
                <input type="text" class="form-control " placeholder="Name of PI" id="nopi">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label class="col-sm-2 col-form-label Bold">Shared Status <span
                  style="color: red; font-weight: bold;">*</span></label>
              <div class="col-sm-10 mt-2">
                <div class="custom-control custom-radio custom-control-inline">
                  <input class="custom-control-input" type="radio" name="sharestatus" id="radioPartial" value="ps">
                  <label class="custom-control-label" for="radioPartial">Partial</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input class="custom-control-input" type="radio" name="sharestatus" id="radioFull" value="s">
                  <label class="custom-control-label" for="radioFull">Complete</label>
                </div>
              </div>
            </div>
            <div id="partialSamples" style="display: none;">
              <div class="row ml-1 mb-3">
                <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Partial shared
                  remark</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control " placeholder="" id="parSharedRemark">
                </div>
              </div>
            </div>


            <div id="sharedSampleBox" style="display: none;">
              <div class="row ml-1 mb-3">
                <label for="sharedSampleBox" class="col-sm-2 mb-1 col-form-label">Grid No.</label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="sharedSample" onclick="popSharedmodal()"
                    placeholder="Shared Grid Box">
                </div>
              </div>
            </div>
            <div class="col mt-4" style="text-align: center;" id="backToCardBtn">
              <button type="button" class="btn btn-primary" onclick="goToTimestampCard()">Back</button>
            </div>
            <div class="col mt-4" style="text-align: center;" id="shareSubmit">
              <button type="submit" class="btn btn-success">Submit</button>
            </div>
          </form>

        </div>
      </div>
    </div>

    <div class="modal fade  bd-example-modal-lg" id="bloodModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="currBloodBoxName"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="blood-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="continuePage" onclick="handleDone()">Done</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade bd-example-modal-lg" id="specimenModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="currSpecimenBoxName"></span> </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="specimen-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="P1" />
                </div>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="continuePage" onclick="handleDone()">Done</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade  bd-example-modal-lg" id="sharedBloodModal" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="cursharedBloodBox"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="shared-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade  bd-example-modal-lg" id="sharedSpecimenModal" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="cursharedSpecimenBox"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="shared-s-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>

  </div>







  <footer id="footer" style="margin-top: 10px;">
    <div class="container footer-bottom clearfix">
      <div class="copyright">
        &copy; Copyright <strong><span></span></strong>. All Rights Reserved
      </div>
      <div class="credits">

      </div>
      <div class="version" style="float: right; font-size: 12px; color: rgb(255, 255, 255);">
        Version 1.3.0
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>


  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <!-- Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>



  <script>

    if (!sessionStorage.getItem('isLoggedIn') || sessionStorage.getItem('isLoggedIn') !== 'true') {
      window.location.href = "login.html";
    }

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database(app);

    localStorage.removeItem('selectedGrid');
    const referrer = document.referrer;
    const bread2 = document.getElementById('bread2');
    const sampleInputTab = document.getElementById('tab1-tab');
    const followUpTab = document.getElementById('tab2-tab');
    const sharedTab = document.getElementById('tab3-tab');

    const urlParams = new URLSearchParams(window.location.search);
    const hideMnrId = urlParams.get('hideMnrId');
    const shared = urlParams.get('shared');
    const mode = urlParams.get('mode');

    console.log("shared", shared);

    if (referrer.includes('home.html')) {
      if (shared === "true") {
        bread2.innerHTML = '<a href="search.html">Search</a>';
        sharedTab.click();
      }
      else {
        bread2.innerHTML = '<a href="home.html">Home</a>';
        sampleInputTab.click();
      }
    }
    else if (referrer.includes('search.html')) {
      if (shared === "true") {
        bread2.innerHTML = '<a href="search.html">Search</a>';
        sharedTab.click();
      } else {
        bread2.innerHTML = '<a href="search.html">Search</a>';
        sampleInputTab.click();
      }

      // Clear all input fields
      const inputs = document.querySelectorAll('input');
      inputs.forEach(input => {
        if (input.type === 'text' || input.type === 'textarea') {
          input.value = '';
        } else if (input.type === 'radio') {
          input.checked = false;
        }
      });

      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        select.selectedIndex = 0;
      });
    }

    // if (referrer.includes('todo.html')) {
    //   if(mode==='PendingEdit' || mode==='PendingView'){
    //     bread2.innerHTML = '<a href="todo.html">To-Do</a>';
    //     sampleInputTab.click();
    //   }
    //   else if (mode==="") {
    //     bread2.innerHTML = '<a href="todo.html">To-Do</a>';
    //     followUpTab.click();
    //   }
    // }
    if (referrer.includes('todo.html')) {
      if (mode === 'view' || mode === 'edit') {
        bread2.innerHTML = '<a href="todo.html">To-Do</a>';
        followUpTab.click();
      }
      else {
        bread2.innerHTML = '<a href="todo.html">To-Do</a>';
        sampleInputTab.click();
      }
    }




    if (hideMnrId === 'true') {
      const mnrIdElement = document.getElementById('mnrId');
      if (mnrIdElement) {
        mnrIdElement.style.display = 'none';
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById("sampleEntry1").addEventListener("click", function () {
        validateAndCollectData();
        console.log("Saved to Firebase!")

        // window.location.href = 'home.html';
      });
    });

    document.getElementById('submitButton').addEventListener('click', function () {
      // Validate and collect data from all forms
      validateAndCollectData();

      // window.location.href = 'home.html';

    });
    document.getElementById('finishButton').addEventListener('click', function () {

      window.location.href = 'home.html';

    });
    // document.addEventListener("DOMContentLoaded", function () {
    //   // Array to store the sample data
    //   let sampleDataArray = [];

    //   // document.getElementById("addSample").addEventListener("click", function () {
    //   //   document.getElementById("inputSampleTable").style.display = 'block';
    //   // });
    //   // document.getElementById("sampleEntry1").addEventListener("click", function () {
    //   //   window.location.href = 'home.html';
    //   // });
    //   document.getElementById("sampleEntry").addEventListener("click", function () {
    //     const bioBankID = document.querySelector('input[placeholder="Enter Bio Bank ID"]').value;
    //     const age = document.querySelector('input[placeholder="yrs"]').value;
    //     const gender = document.querySelector('#gender').value;
    //     const sample = document.querySelector('#sample').value;
    //     const sampleType = document.querySelector('#sampleType').value;
    //     const boxNo = document.querySelector('input[placeholder="Box No."]').value;
    //     const PgridNo = document.querySelector('input[placeholder="Plasma Grid"]').value;

    //     const gridNo = document.querySelector('input[placeholder="Grid No."]').value;

    //     const sampleData = {
    //       bioBankID,
    //       age,
    //       gender,
    //       sample,
    //       sampleType,
    //       boxNo,
    //       gridNo
    //     };

    //     sampleDataArray.push(sampleData);

    //     console.log(sampleDataArray);

    //     document.getElementById("inputSampleTable").style.display = 'none';

    //     document.querySelector('input[placeholder="Enter Bio Bank ID"]').value = '';
    //     document.querySelector('input[placeholder="yrs"]').value = '';
    //     document.querySelector('#gender').value = '';
    //     document.querySelector('#sample').value = '';
    //     document.querySelector('#sampleType').value = '';
    //     document.querySelector('input[placeholder="Box No."]').value = '';
    //     document.querySelector('input[placeholder="Grid No."]').value = '';
    //     window.location.href = referrer
    //   });

    //   document.getElementById('logout').addEventListener('click', function () {
    //     window.location.href = 'login.html';
    //   });
    // });

    function logout() {
      sessionStorage.removeItem('isLoggedIn');
      sessionStorage.removeItem('userName');
      window.location.href = 'login.html';
    }

  </script>
  <script>
    let BloodSelectedSeats = [];
    let SpecimenSelectedSeats = [];

    // function popmodal() {
    //   let sampleType = document.querySelector('#sample').value;

    //   if (sampleType === "Blood") {
    //     $('#bloodModalCenter').modal('show');
    //     generateSeats('blood-box', 'BR');
    //   } else if (sampleType === "Specimen") {
    //     $('#specimenModalCenter').modal('show');
    //     generateSeats('specimen-box', 'SR');
    //   }
    // }

    // function generateSeats(containerClass, seatPrefix) {
    //   let container = document.querySelector(`.${containerClass}`);
    //   container.innerHTML = '';
    //   selectedSeats = [];

    //   for (let i = 0; i < 54; i++) {
    //     let seatID = seatPrefix + '_' + (i + 1);
    //     let booked = "";
    //     if (i >= 0 && i <= 41) {
    //       booked = "booked";
    //       container.insertAdjacentHTML(
    //         "beforeend",
    //         `<input type="checkbox" name="seats" id="${seatID}" />` +
    //         `<label for="${seatID}" class="seat ${booked}">${seatID}</label>`
    //       );

    //       document.getElementById(seatID).addEventListener('change', function () {
    //         handleSeatSelection(seatID);
    //       });
    //     }
    //     else {
    //       container.insertAdjacentHTML(
    //         "beforeend",
    //         `<input type="checkbox" name="seats" id="${seatID}" />` +
    //         `<label for="${seatID}" class="seat ${booked}"></label>`
    //       );

    //       document.getElementById(seatID).addEventListener('change', function () {
    //         handleSeatSelection(seatID);
    //       });
    //     }

    //   }
    // }

    // function handleSeatSelection(seatID) {

    //   let seatIndex = selectedSeats.indexOf(seatID);
    //   if (seatIndex === -1) {
    //     if (seatID === "BR_43") {
    //       selectedSeats.push("A8");
    //     }
    //     else if (seatID === "BR_44") {
    //       selectedSeats.push("B8");
    //     }
    //     else {
    //       selectedSeats.push(seatID);

    //     }
    //   }
    //   else {
    //     selectedSeats.splice(seatIndex, 1);
    //   }
    //   console.log("Seat index", seatID)

    // }

    // function handleDone() {
    //   if (selectedSeats.length > 0) {
    //     // Select the input for Grid No. within the form layout
    //     let gridInput = document.querySelector("input[placeholder='Grid No.']");
    //     if (gridInput) {
    //       gridInput.value = selectedSeats.join(', ');
    //     }
    //   }
    //   // Close the modals
    //   $('#bloodModalCenter').modal('hide');
    //   $('#specimenModalCenter').modal('hide');
    // }


    let grid = '';

    let spgrid = '';

    let arr = [];

    let arrS = [];

    let arrinx = [];

    let arrSinx = [];

    function plasmaModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("bloodVStatus")
      console.log("sts bloodVStatus",sts)
      if (mode === 'SearchView' || ((mode === 'SearchEdit') && (sts==="true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if(document.getElementById("PlasmagridNo").value!==''){
          popVPlasmaModal()
        }
      }
      else {
        popPlasmamodal()
      }
    }
    
    function serumModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("bloodVStatus")
      if (mode === 'SearchView' || (mode === 'SearchEdit' && (sts==="true") ) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if(document.getElementById("SerumgridNo").value!==''){
          popVSerumModal()
        }
      }
      else {
        popSerummodal()
      }
    }
    
    function buffyModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("bloodVStatus")

      if (mode === 'SearchView' || (mode === 'SearchEdit' && (sts==="true") ) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if(document.getElementById("bufferCoatgridNo").value!==''){
          popVBufferModal()
        }
      }
      else {
        popBuffermodal()
      }
    }
    
    function OSModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("otherVStatus")

      if (mode === 'SearchView' || (mode === 'SearchEdit' && (sts==="true") ) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if(document.getElementById("OSgridNo").value!==''){
          popVOtherSampleModal()
        }
      }
      else {
        popOtherSamplemodal()
      }
    }

    function FTModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("specimenVStatus")

      if (mode === 'SearchView' || (mode === 'SearchEdit' && (sts==="true") ) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if(document.getElementById("ftgrid").value!==''){
          popVFTmodal()
        }
      }
      else {
        popFTmodal()
      }
    }

    function FNModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("specimenVStatus")

      if (mode === 'SearchView' || (mode === 'SearchEdit' && (sts==="true") ) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if(document.getElementById("fngrid").value!==''){
          popVFNmodal()
        }
      }
      else {
        popFNmodal()
      }
    }


    function popVPlasmaModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const plasmaBoxName = document.getElementById("PlasmagridNo").value;
        const boxname = plasmaBoxName.split('/')[0];
        const gridSample = plasmaBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;


        console.log("box name", boxname);
        console.log("seatData", seatData);

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => boxName === boxname);

        if (!activeBoxEntry) {
          console.log("No active box found.");
          return;
        }

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        const indexedSeats = filteredSeats;

        document.getElementById('currBloodBoxName').textContent = activeBoxName;


        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }


        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
              );

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                } else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (seat.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }

                if (gridSamples.includes(seatID)) {
                  labelElement.style.background = "#4d6335";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }

    }



        function popPlasmamodal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => data.bxsts === 'AC');
        let BloodSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }

        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data in Plasma:", grid);

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("activeBoxEntry", activeBoxEntry)
        // console.log("filteredSeats", filteredSeats)
        let psData = document.getElementById("PlasmagridNo").value;

        console.log("psData", psData);
        if (psData.length !== 0) {
          if (localStorage.getItem('LocalPlasma') !== null) {
            psGridData = psData.split('/')[1];
            console.log("psGridData", psGridData)

            let ld = psGridData + "," + localStorage.getItem('LocalPlasma')

            localStorage.setItem('LocalPlasma', ld);
            console.log("FN Data from if", localStorage.getItem('LocalPlasma'))
          } else {
            psGridData = psData.split('/')[1];
            console.log("psGridData", psGridData)

            //let ld = psGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalPlasma', psGridData);
            console.log("Plasma Data from else", localStorage.getItem('LocalPlasma'))
          }
        }


        console.log("Active Box Name:", activeBoxName);
        document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }


        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                handleBSeatSelection(seatID, event.target.checked, seat.status);
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                // if (seatID.includes(grid)) {
                //   console.log("seatID", seatID.includes(grid) + " seatID", seatID)
                // }

                if (seat.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalPlasma");

          if (rev !== null) {
            let arr = splitStringToArray(rev);
            BloodSelectedSeats = arr;
          }

          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              // Change the color of the seat to reflect its selection (e.g., #4d6335)
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            }
            else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          } else {
            let arr = splitStringToArray(grid);
            if (status === 'o' && arr.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
              // Change the color to reflect its current state (e.g., for 'o' status)
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            } else {
              alert("Error clicking the filled component.");
            }
          }

          // Filter out any empty or null values from BloodSelectedSeats
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalPlasma", BloodSelectedSeats.join(','));  // Store as a comma-separated string
          updatePlasmaGridInput();
        }

        function updatePlasmaGridInput() {
          let gridInput = document.querySelector("input[placeholder='Plasma Grid']");

          // Remove null or empty values from BloodSelectedSeats
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats.join(',')); // Store as comma-separated string
          } else {
            // Remove any empty values from grid before updating
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid.concat(BloodSelectedSeats)).join(','));
          }

          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid);
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid);

          if (gridInput) {
            const box_name = activeBoxName;
            const status = document.querySelector('input[name="MetastasisSample"]:checked') &&
              document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MPlasma" : "Plasma";
            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updatePlasmaGridInput();
          }
          $('#bloodModalCenter').modal('hide');
        };
      }

    }




    function popVSerumModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const plasmaBoxName = document.getElementById("SerumgridNo").value
        const boxname = plasmaBoxName.split('/')[0];
        console.log("box name", boxname);
        const gridSample = plasmaBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;

        console.log("box name", seatData);

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => boxName === boxname);



        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("activeBoxEntry", activeBoxEntry);
        document.getElementById('currBloodBoxName').textContent = activeBoxName;


        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
              );

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seat.bioBankId || ""} \n ${seat.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';
                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                // if (seatID.includes(grid)) {
                //   console.log("seatID", seatID.includes(grid) + " seatID", seatID)
                // }

                if (seat.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }

                if (gridSamples.includes(seatID)) {
                  labelElement.style.background = "#4d6335";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }
        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }

    }


    function popSerummodal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;
        let BloodSelectedSeats = [];

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => data.bxsts === 'AC');

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }

        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }

        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data:", grid);

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);

        let ssData = document.getElementById("SerumgridNo").value;

        console.log("ssData", ssData);
        if (ssData.length !== 0) {
          if (localStorage.getItem('LocalSerum') !== null) {
            ssGridData = ssData.split('/')[1];
            console.log("ssGridData", ssGridData)

            let ld = ssGridData + "," + localStorage.getItem('LocalSerum')

            localStorage.setItem('LocalSerum', ld);
            console.log("Serum Data from if", localStorage.getItem('LocalSerum'))
          } else {
            ssGridData = ssData.split('/')[1];
            console.log("ssGridData", ssGridData)

            //let ld = ssGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalSerum', ssGridData);
            console.log("Serum Data from else", localStorage.getItem('LocalSerum'))
          }
        }

        document.getElementById('currBloodBoxName').textContent = activeBoxName;


        if (grid !== null) {
          console.log("grid", grid)
          arr = splitStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }


        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);


            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                handleBSeatSelection(seatID, event.target.checked, seat.status);
              });

              let labelElement = document.getElementById(labelName);

              if (labelElement) {
                // labelElement.textContent = `${seat.bioBankId || ""} \n ${seat.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';
                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                if (seat.status === "o" || (seatID.includes(grid))) {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalSerum")
          if (rev !== null) {
            let arr = splitStringToArray(rev)
            BloodSelectedSeats = arr;
          }
          console.log("rev : ", rev, " BloodSelectedSeats : ", BloodSelectedSeats)
          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            } else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          }
          else {
            let arr = splitStringToArray(grid)
            if (status === 'o' && arr.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
            }
            else {
              alert("Error clicking the filled component.");

            }
          }
          // BloodSelectedSeats = splitStringToArray(BloodSelectedSeats)
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalSerum", BloodSelectedSeats)
          updateSerumGridInput();
        }

        function updateSerumGridInput() {
          let gridInput = document.querySelector("input[placeholder='Serum Grid']");
          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats.join(','));
            //localStorage.setItem("selectedGrid", JSON.stringify(BloodSelectedSeats));
          }
          else {
            //grid.push(BloodSelectedSeats)
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid + ',' + BloodSelectedSeats));
            // let combinedArray = splitStringToArray(grid).concat(BloodSelectedSeats); // Concatenate both arrays
            // localStorage.setItem("selectedGrid", JSON.stringify([...new Set(combinedArray)])); // Remove duplicates and store as array
          }


          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid)
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid);
          if (gridInput) {
            const box_name = activeBoxName;
            const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MSerum" : "Serum";
            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updateSerumGridInput();
          }
          $('#bloodModalCenter').modal('hide');
        };
      }
    }

    // function splitStringToArray(grid) {
    //   const data = [ ...new Set(grid.split(',').map(item => item.trim()))];
    //   console.log("data ",data)
    //   return data;
    // }

    function splitStringToArray(grid) {
      const data = [...new Set(grid.split(',').map(item => item.trim()))];
      console.log("data", data);
      return data;
    }

    function removeItemFromArray(arr, itemToRemove) {
      // Filter out the item to remove from the array
      return arr.filter(item => item !== itemToRemove);
    }

    function popVBufferModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const buffyBoxName = document.getElementById("bufferCoatgridNo").value
        const boxname = buffyBoxName.split('/')[0];
        console.log("box name", boxname);
        const gridSample = buffyBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        console.log("box name", seatData);

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => boxName === boxname);



        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("activeBoxEntry", activeBoxEntry);
        document.getElementById('currBloodBoxName').textContent = activeBoxName;


        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
              );

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seat.bioBankId || ""} \n ${seat.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';
                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                // if (seatID.includes(grid)) {
                //   console.log("seatID", seatID.includes(grid) + " seatID", seatID)
                // }

                if (seat.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }


                if (gridSamples.includes(seatID)) {
                  labelElement.style.background = "#4d6335";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }
        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }

    }


    function popBuffermodal() {
      $('#bloodModalCenter').modal('show');
      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => data.bxsts === 'AC');
        let BloodSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }

        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data:", grid);

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);

        let bcsData = document.getElementById("bufferCoatgridNo").value;

        console.log("bcsData", bcsData);
        if (bcsData.length !== 0) {
          if (localStorage.getItem('LocalBuffy') !== null) {
            bcsGridData = bcsData.split('/')[1];
            console.log("bcsGridData", bcsGridData)

            let ld = bcsGridData + "," + localStorage.getItem('LocalBuffy')

            localStorage.setItem('LocalBuffy', ld);
            console.log("Buffy Coat Data from if", localStorage.getItem('LocalBuffy'))
          } else {
            bcsGridData = bcsData.split('/')[1];
            console.log("bcsGridData", bcsGridData)

            //let ld = bcsGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalBuffy', bcsGridData);
            console.log("Buffy Coat Data from else", localStorage.getItem('LocalBuffy'))
          }
        }

        document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }

        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );

              document.getElementById(seatID).addEventListener('click', function (event) {
                handleBSeatSelection(seatID, event.target.checked, seat.status, 'buffy Coat')
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seat.bioBankId || ""} \n ${seat.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';

                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (seat.status === "o" || (seatID.includes(grid))) {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }
        function handleBSeatSelection(seatID, isChecked, status, debug) {
          console.log("handleBSeatSelection", debug)
          const rev = localStorage.getItem("LocalBuffy");
          if (rev !== null) {
            let arr = splitStringToArray(rev)
            BloodSelectedSeats = arr;
          }
          console.log("rev : ", rev, " BloodSelectedSeats : ", BloodSelectedSeats)
          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';

            } else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }

          }
          else {
            let arr = splitStringToArray(grid)
            if (status === 'o' && arr.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
            else {
              alert("Error clicking the filled component.");
            }
          }
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalBuffy", BloodSelectedSeats)
          updateBuffyGridInput();
        }
        function updateBuffyGridInput() {
          let gridInput = document.querySelector("input[placeholder='Buffer Grid']");
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats).join(',');
            //localStorage.setItem("selectedGrid", JSON.stringify(BloodSelectedSeats));
          }
          else {
            //grid.push(BloodSelectedSeats)
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values

            localStorage.setItem("selectedGrid", (grid + ',' + BloodSelectedSeats));

            // let combinedArray = splitStringToArray(grid).concat(BloodSelectedSeats); // Concatenate both arrays
            // localStorage.setItem("selectedGrid", JSON.stringify([...new Set(combinedArray)])); // Remove duplicates and store as array
          }


          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid)
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid);
          if (gridInput) {
            const box_name = activeBoxName;
            const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MBuffy Coat" : "Buffy Coat";
            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updateBuffyGridInput();
          }
          $('#bloodModalCenter').modal('hide');
        };
      }
    }



    function popVOtherSampleModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const OSBoxName = document.getElementById("OSgridNo").value
        const boxname = OSBoxName.split('/')[0];
        const gridSample = OSBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        console.log("box name", boxname);
        console.log("box name", seatData);

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => boxName === boxname);



        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("activeBoxEntry", activeBoxEntry);
        document.getElementById('currBloodBoxName').textContent = activeBoxName;


        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
              );

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seat.bioBankId || ""} \n ${seat.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';

                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                if (seat.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }

                if (gridSamples.includes(seatID)) {
                  labelElement.style.background = "#4d6335";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }
        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }
    }


    function popOtherSamplemodal() {
      $('#bloodModalCenter').modal('show');

      // Fetch data from the database
      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      // Function to fetch seat data from the database
      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();  // Assumes seat data is stored in the 'bb' node
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let BloodSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => data.bxsts === 'AC');

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }
        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data:", grid);

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);

        let osData = document.getElementById("OSgridNo").value;

        console.log("osData", osData);
        if (osData.length !== 0) {
          if (localStorage.getItem('LocalOther') !== null) {
            osGridData = osData.split('/')[1];
            console.log("osGridData", osGridData)

            let ld = osGridData + "," + localStorage.getItem('LocalOther')

            localStorage.setItem('LocalOther', ld);
            console.log("Other Data from if", localStorage.getItem('LocalOther'))
          } else {
            osGridData = osData.split('/')[1];
            console.log("osGridData", osGridData)

            //let ld = osGridData+","+localStorage.getItem('LocalOther')

            localStorage.setItem('LocalOther', osGridData);
            console.log("Other Data from else", localStorage.getItem('LocalOther'))
          }
        }

        document.getElementById('currBloodBoxName').textContent = activeBoxName;

        if (grid !== null) {
          let arr = splitStringToArray(grid);
          let arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }
        // Make sure indexedSeats is defined
        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;  // Stop further execution if no indexed seats are available
        }

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                handleBSeatSelection(seatID, event.target.checked, seat.status);
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seat.bioBankId || ""} \n ${seat.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';

                if (seat.bioBankId !== '') {
                  labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seat.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                if (seat.status === "o" || (seatID.includes(grid))) {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seat.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seat.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seat.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalOther")

          if (rev !== null) {
            let arr = splitStringToArray(rev)
            BloodSelectedSeats = arr;
          }

          console.log("rev : ", rev, " BloodSelectedSeats : ", BloodSelectedSeats)
          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            } else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
          }
          else {
            let arr = splitStringToArray(grid)
            if (status === 'o' && arr.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
            else {
              alert("Error clicking the filled component.");
            }
          }
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalOther", BloodSelectedSeats)
          updateOtherGridInput();
        }

        function updateOtherGridInput() {
          let gridInput = document.querySelector("input[placeholder='Other Sample Grid']");

          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats);
            //localStorage.setItem("selectedGrid", JSON.stringify(BloodSelectedSeats));
          }
          else {
            //grid.push(BloodSelectedSeats)
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid + ',' + BloodSelectedSeats));
            // let combinedArray = splitStringToArray(grid).concat(BloodSelectedSeats); // Concatenate both arrays
            // localStorage.setItem("selectedGrid", JSON.stringify([...new Set(combinedArray)])); // Remove duplicates and store as array
          }


          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid)
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid)
          if (gridInput) {
            const box_name = activeBoxName;
            const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MOther" : "Other";
            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updateOtherGridInput();
          }
          $('#bloodModalCenter').modal('hide');
        };
      }
    }

    function splitSpecimenStringToArray(spgrid) {
      const Sdata = [...new Set(spgrid.split(',').map(item => item.trim()))];
      console.log("Sdata", Sdata);
      return Sdata;
    }

    function removeItemFromSpecimenArray(arrS, itemToRemove) {
      return arrS.filter(item => item !== itemToRemove);
    }

    window.onload = function () {
      // Clear the selected specimen grid data on page reload
      localStorage.removeItem("selectedSGrid");
      // localStorage.removeItem("LocalPlasma");
      // localStorage.removeItem("LocalSerum");
      // localStorage.removeItem("LocalBuffy");
      // localStorage.removeItem("LocalOther");  
    };


    function popVFTmodal() {
      $('#specimenModalCenter').modal('show');

      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'ft');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const FTBoxName = document.getElementById("ftgrid").value
        const boxname = FTBoxName.split('/')[0];
        const gridSample = FTBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        console.log("box name", boxname);
        console.log("box name", seatData);

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => boxName === boxname);
        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }


        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);
        document.getElementById('currSpecimenBoxName').textContent = activeBoxName;
        console.log("spgrid -- ", spgrid);


        const indexedSeats = filteredSeats;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_S${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seatData = indexedSeats[index];

            if (seatData) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
              );

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seatData.bioBankId || ""} \n ${seatData.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';
                if (seatData.bioBankId !== '') {
                  labelElement.innerHTML = `${seatData.bioBankId || ''}<br>${seatData.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seatData.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                if (seatData.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seatData.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seatData.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seatData.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }

                if (gridSamples.includes(seatID)) {
                  labelElement.style.background = "#4d6335";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }
        window.handleDone = function () {
          $('#specimenModalCenter').modal('hide');
        };
      }
    }

    function popFTmodal() {
      $('#specimenModalCenter').modal('show');

      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'ft');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => data.bxsts === 'AC');
        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }

        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        };
        let ftData = document.getElementById("ftgrid").value;

        console.log("ftData", ftData);
        if (ftData.length !== 0) {
          if (localStorage.getItem('LocalFT') !== null) {
            ftGridData = ftData.split('/')[1];
            console.log("ftGridData", ftGridData)

            let ld = ftGridData + "," + localStorage.getItem('LocalFT')

            localStorage.setItem('LocalFT', ld);
            console.log("FT Data from if", localStorage.getItem('LocalFT'))
          } else {
            ftGridData = ftData.split('/')[1];
            console.log("ftGridData", ftGridData)

            localStorage.setItem('LocalFT', ftGridData);
            console.log("FT Data from else", localStorage.getItem('LocalFT'))
          }
        }

        let spgrid = localStorage.getItem("selectedSGrid");
        const maxSelectionsFT = parseInt(document.getElementById('ft_tubes').value, 10);

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);
        document.getElementById('currSpecimenBoxName').textContent = activeBoxName;
        console.log("spgrid -- ", spgrid);

        if (spgrid !== null) {
          let arrS = splitSpecimenStringToArray(spgrid);
          let arrSinx = [];
          console.log(" arrS = ", arrS);
          arrS.forEach(item => arrSinx.push(getSeatIndex(item)));

          arrSinx.forEach(item => {
            filteredSeats[item] = stsInx;
          });
        }
        console.log("filteredSeats --- ", filteredSeats);

        const indexedSeats = filteredSeats;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_S${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seatData = indexedSeats[index];

            if (seatData) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );

              document.getElementById(seatID).addEventListener('click', function (event) {
                handleSSeatSelection(seatID, event.target.checked, seatData.status, maxSelectionsFT, 'FT Grid');
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (seatData.bioBankId !== '') {
                  labelElement.innerHTML = `${seatData.bioBankId || ''}<br>${seatData.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seatData.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (seatData.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seatData.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seatData.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seatData.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleSSeatSelection(seatID, isChecked, status, maxSelectionsFT, debug) {
          console.log("handleSSeatSelection", debug);
          const rev = localStorage.getItem("LocalFT");

          if (rev !== null) {
            let arr = splitSpecimenStringToArray(rev);
            SpecimenSelectedSeats = arr.filter(item => item);  // Filter out falsy values
          }

          console.log("rev : ", rev, " SpecimenSelectedSeats : ", SpecimenSelectedSeats);
          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              if (SpecimenSelectedSeats.length < maxSelectionsFT) {
                SpecimenSelectedSeats.push(seatID);
                if (labelElement) labelElement.style.backgroundColor = '#4d6335';
              } else {
                document.getElementById(seatID).checked = false;
                alert(`You can select a maximum of ${maxSelectionsFT} seats.`);
              }
            } else {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
          } else {
            let arr = splitSpecimenStringToArray(spgrid);
            if (status === 'o' && arr.includes(seatID)) {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            } else {
              alert("Error clicking the filled component.");
            }
          }

          console.log("Selected seats:", SpecimenSelectedSeats);
          localStorage.setItem("LocalFT", SpecimenSelectedSeats.filter(item => item).join(','));  // Filter out falsy values
          updateFTGridInput();
        }

        function updateFTGridInput() {
          let gridInput = document.querySelector("input[placeholder='FT Grid No.']");

          SpecimenSelectedSeats = SpecimenSelectedSeats.filter(item => item);  // Filter out falsy values

          if (spgrid === null) {
            localStorage.setItem("selectedSGrid", SpecimenSelectedSeats.join(','));
          } else {
            spgrid = splitSpecimenStringToArray(spgrid).filter(item => item);  // Filter out falsy values
            localStorage.setItem("selectedSGrid", (spgrid.concat(SpecimenSelectedSeats)).join(','));
          }

          spgrid = localStorage.getItem("selectedSGrid");
          splitSpecimenStringToArray(spgrid);

          if (gridInput) {
            const box_name = activeBoxName;
            let ftStatuses = [];

            for (let i = 1; i <= SpecimenSelectedSeats.length; i++) {
              if (document.querySelector('input[name="MetastasisSample"]:checked').value === "true") {
                ftStatuses.push(`MFT-${i}`);
              } else {
                ftStatuses.push(`FT-${i}`);
              }
            }

            const grid_id = SpecimenSelectedSeats.join(', ');
            const status = ftStatuses.join(', ');

            if (grid_id.length > 0) {
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (SpecimenSelectedSeats.length > 0) {
            updateFTGridInput();
          }
          $('#specimenModalCenter').modal('hide');
        };
      }
    }



    function popVFNmodal() {
      $('#specimenModalCenter').modal('show');

      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'ft');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const FNBoxName = document.getElementById("fngrid").value
        const boxname = FNBoxName.split('/')[0];
        const gridSample = FNBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        console.log("box name", boxname);
        console.log("box name", seatData);

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => boxName === boxname);
        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }


        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);
        document.getElementById('currSpecimenBoxName').textContent = activeBoxName;
        console.log("spgrid -- ", spgrid);


        const indexedSeats = filteredSeats;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_S${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seatData = indexedSeats[index];

            if (seatData) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
              );

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                // labelElement.textContent = `${seatData.bioBankId || ""} \n ${seatData.sampleType}` || '';
                // labelElement.style.fontWeight = "bold";
                // labelElement.style.fontSize = "10px";
                // labelElement.style.textAlign = 'center';
                // labelElement.style.color = 'white';
                if (seatData.bioBankId !== '') {
                  labelElement.innerHTML = `${seatData.bioBankId || ''}<br>${seatData.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seatData.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                if (seatData.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seatData.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seatData.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seatData.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
                if (gridSamples.includes(seatID)) {
                  labelElement.style.background = "#4d6335";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }
        window.handleDone = function () {
          $('#specimenModalCenter').modal('hide');
        };
      }
    }

    function popFNmodal() {
      $('#specimenModalCenter').modal('show');

      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'fn');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([boxName, data]) => data.bxsts === 'AC');
        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }

        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        };
        let fnData = document.getElementById("fngrid").value;
        console.log("fnData", fnData);
        if (fnData.length !== 0) {
          if (localStorage.getItem('LocalFN') !== null) {
            fnGridData = fnData.split('/')[1];
            console.log("fnGridData", fnGridData)

            let ld = fnGridData + "," + localStorage.getItem('LocalFN')

            localStorage.setItem('LocalFN', ld);
            console.log("FN Data from if", localStorage.getItem('LocalFN'))
          } else {
            fnGridData = fnData.split('/')[1];
            console.log("fnGridData", fnGridData)

            localStorage.setItem('LocalFN', fnGridData);
            console.log("FN Data from else", localStorage.getItem('LocalFN'))
          }
        }

        spgrid = localStorage.getItem("selectedSGrid");
        const maxSelections = parseInt(document.getElementById('fn_tubes').value, 10);

        const [activeBoxName, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", activeBoxName);
        document.getElementById('currSpecimenBoxName').textContent = activeBoxName;

        if (spgrid !== null) {
          let arrS = splitSpecimenStringToArray(spgrid);
          let arrSinx = [];
          arrS.forEach(item => arrSinx.push(getSeatIndex(item)));

          arrSinx.forEach(item => {
            filteredSeats[item] = stsInx;
          });
        }

        const indexedSeats = filteredSeats;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_S${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seatData = indexedSeats[index];

            if (seatData) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );

              document.getElementById(seatID).addEventListener('click', function (event) {
                handleSSeatSelection(seatID, event.target.checked, seatData.status, maxSelections, 'FN Grid');
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (seatData.bioBankId !== '') {
                  labelElement.innerHTML = `${seatData.bioBankId || ''}<br>${seatData.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (seatData.bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (seatData.status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (seatData.status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (seatData.status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (seatData.status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleSSeatSelection(seatID, isChecked, status, maxSelections, debug) {
          console.log("handleSSeatSelection", debug);
          const rev = localStorage.getItem("LocalFN")

          if (rev !== null) {
            let arr = splitSpecimenStringToArray(rev)
            SpecimenSelectedSeats = arr.filter(item => item);
          }

          //console.log("rev : ",rev," SpecimenSelectedSeats : ",SpecimenSelectedSeats)
          console.log(" maxSelections : ", maxSelections)
          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              if (SpecimenSelectedSeats.length < maxSelections) {
                SpecimenSelectedSeats.push(seatID);
                if (labelElement) labelElement.style.backgroundColor = '#4d6335';
              } else {
                document.getElementById(seatID).checked = false;
                alert(`You can select a maximum of ${maxSelections} seats.`);
              }
            } else {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
          } else {
            let arr = splitSpecimenStringToArray(spgrid)
            if (status === 'o' && arr.includes(seatID)) {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
            else {
              alert("Error clicking the filled component.");
            }
          }

          console.log("Selected seats:", SpecimenSelectedSeats);
          localStorage.setItem("LocalFN", SpecimenSelectedSeats);
          updateFNGridInput();
        }

        function updateFNGridInput() {
          let gridInput = document.querySelector("input[placeholder='FN Grid No.']");

          SpecimenSelectedSeats = SpecimenSelectedSeats.filter(item => item);  // Filter out falsy values

          if (spgrid === null) {
            localStorage.setItem("selectedSGrid", SpecimenSelectedSeats.join(','));
          } else {
            spgrid = splitSpecimenStringToArray(spgrid).filter(item => item);  // Filter out falsy values
            localStorage.setItem("selectedSGrid", (spgrid.concat(SpecimenSelectedSeats)).join(','));
          }

          spgrid = localStorage.getItem("selectedSGrid");
          splitSpecimenStringToArray(spgrid);

          if (gridInput) {
            const box_name = activeBoxName;
            let fnStatuses = [];

            for (let i = 1; i <= SpecimenSelectedSeats.length; i++) {
              if (document.querySelector('input[name="MetastasisSample"]:checked').value === "true") {
                fnStatuses.push(`MFN-${i}`);
              } else {
                fnStatuses.push(`FN-${i}`);
              }
            }

            const grid_id = SpecimenSelectedSeats.join(', ');
            const status = fnStatuses.join(', ');

            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (SpecimenSelectedSeats.length > 0) {
            updateFNGridInput();
          }
          $('#specimenModalCenter').modal('hide');
        };
      }
    }



  </script>

  <script>
    $(document).ready(function () {
      let startInput = $('#startInputFollow');
      let endInput = $('#startInputOutsource');
      let receivedTime = $('#receivedTime');
      let processedTime = $('#processedTime');
      let deathDate = $('#deathDate');
      let recurrenceDate = $('#recurrenceDate');
      let reportedDate = $('#reportedDate');

      const today = new Date();

      startInput.datepicker({
        format: 'dd/mm/yyyy ',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });

      endInput.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      receivedTime.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      processedTime.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      deathDate.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      recurrenceDate.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        minDate: today
      });
      reportedDate.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });

    });
    document.getElementById("nextButton1").addEventListener("click", function () {
      const requiredFields = [
        { field: document.getElementById('mrnNo'), name: 'MRN Number' },
        { field: document.getElementById('bioBankId'), name: 'Bio Bank ID' },
        { field: document.getElementById('patAge'), name: 'Age' },
        { field: document.querySelector('input[name="customRadio"]:checked'), name: 'Gender' },
        { field: document.querySelector('input[name="radioCancerType"]:checked'), name: 'Cancer Type' },
        { field: document.querySelector('input[name="customProcedure"]:checked'), name: 'Procedure Types' },
        { field: document.querySelector('input[name="MetastasisSample"]:checked'), name: 'Metastasis Sample' },
        { field: document.querySelector('input[name="bloodSample"]:checked'), name: 'Blood Sample' },
        { field: document.querySelector('input[name="specimenSample"]:checked'), name: 'Specimen Sample' },
        { field: document.querySelector('input[name="otherSample"]:checked'), name: 'Other Sample' },
        // { field: document.querySelector('input[name="customConsent"]:checked'), name: 'Consent' },
        // { field: document.querySelector('input[name="IschemicRadio"]:checked'), name: 'Ischemic Sample' },
        // { field: document.querySelector('input[name="processedRadio"]:checked'), name: 'All samples Received Together' }
      ];

      let allFilled = true;
      const emptyFields = [];

      requiredFields.forEach(item => {
        if (!item.field || (item.field.type === 'radio' && !item.field.checked) || (item.field.type === 'number' && item.field.value === '')) {
          allFilled = false;
          emptyFields.push(item.name);
        }
      });

      if (!allFilled) {
        console.log('Please fill in the following required fields:', emptyFields.join(', '));
        alert('Please enter all the required fields.');
        return;
      }
      // Hide form1 and show form2
      document.getElementById("form1").style.display = "none";
      document.getElementById("form2").style.display = "block";

    });

    document.getElementById("nextButton2").addEventListener("click", function () {
      // Hide form2 and show form3
      document.getElementById("form2").style.display = "none";
      document.getElementById("form3").style.display = "block";
    });

    document.getElementById("backButton1").addEventListener("click", function () {
      document.getElementById("form2").style.display = "none";
      document.getElementById("form1").style.display = "block";
    });

    // Back button from form3 to form2
    document.getElementById("backButton2").addEventListener("click", function () {
      document.getElementById("form3").style.display = "none";
      document.getElementById("form2").style.display = "block";
    });
  </script>

  <script>
    document.getElementById('subtype').addEventListener('change', function () {
      var selectedValue = this.value;
      var otherSubtypeDiv = document.getElementById('pSubtypeOther');

      if (selectedValue === 'other' || selectedValue === 'option6') {
        otherSubtypeDiv.style.display = 'block';
      } else {
        otherSubtypeDiv.style.display = 'none';
      }
    });

    $(document).ready(function () {
      // Show/Hide death date input based on selected radio button
      function toggleDeathDate() {
        if ($('#radioDead').is(':checked')) {
          $('#deathDateContainer').show();
        }
        else {
          $('#deathDateContainer').hide();
        }
      }

      // Call the function on page load
      toggleDeathDate();

      // Add change event listeners for the radio buttons
      $('input[name="livestatus"]').change(function () {
        toggleDeathDate();
      });

    });
    $(document).ready(function () {
      function toggleFollowup() {
        if ($('#radioOther').is(':checked')) {
          $('#otherText').show();
        }
        else {
          $('#otherText').hide();
        }
        if ($('#radioRecurrence').is(':checked')) {
          $('#recurID').show();
        }
        else {
          $('#recurID').hide();
        }
        if ($('#radioLost').is(':checked')) {
          $('#lostFollowUpID').show();
        }
        else {
          $('#lostFollowUpID').hide();
        }
        if ($('#radioDiseasePro').is(':checked')) {
          $('#proDisID').show();
          $('#pmr').show();
        }
        else {
          $('#proDisID').hide();
          $('#pmr').hide();

        }
      }
      toggleFollowup();
      $('input[name="flexRadioDefault"]').change(function () {
        toggleFollowup();
      });




      function familyHabitToggle() {
        if ($('#familyHistoryCancer1').is(':checked')) {
          $('#relation_Cancer').show();
        }
        else {
          $('#relation_Cancer').hide();
        }
      }

      familyHabitToggle();
      $('input[name="RadioFHabit"]').change(function () {
        familyHabitToggle();
      });

      function ExistComorbidity() {
        if ($('#ECH1').is(':checked')) {
          $('#medications').show();
        }
        else {
          $('#medications').hide();
        }
      }

      ExistComorbidity();
      $('input[name="ECH"]').change(function () {
        ExistComorbidity();
      });

      function IHCMarker() {
        if ($('#IHC_yes').is(':checked')) {
          $('#ihcDescr').show();
        }
        else {
          $('#ihcDescr').hide();
        }
      }

      IHCMarker();
      $('input[name="IHC"]').change(function () {
        IHCMarker();
      });

      function GeneticT() {
        if ($('#gt_yes').is(':checked')) {
          $('#dt_Desc').show();
        }
        else {
          $('#dt_Desc').hide();
        }
      }

      GeneticT();
      $('input[name="GeneticT"]').change(function () {
        GeneticT();
      });

      function NactYes() {
        if ($('#NACTYes').is(':checked')) {
          $('#nactDC').show();
          $('#nactDLC').show();
        }
        else {
          $('#nactDC').hide();
          $('#nactDLC').hide();
        }
      }

      NactYes();
      $('input[name="NACT"]').change(function () {
        NactYes();
      });

      function actYes() {
        if ($('#ACTYes').is(':checked')) {
          $('#actDC').show();
          $('#actDLC').show();
        }
        else {
          $('#actDC').hide();
          $('#actDLC').hide();
        }
      }

      actYes();
      $('input[name="ACT"]').change(function () {
        actYes();
      });

      function bloodSample() {
        if ($('#bloodSampleY').is(':checked')) {
          $('#plasmatubes').show();
          $('#serumtubes').show();
          $('#bufferCoatTubes').show();
        }
        else if ($('#bloodSampleN').is(':checked')) {
          $('#plasmatubes').hide();
          $('#serumtubes').hide();
          $('#bufferCoatTubes').hide();
          $('#PlasmagridNo').val('');
          $('#SerumgridNo').val('')
          $('#bufferCoatgridNo').val('')
          // localStorage.removeItem("LocalPlasma");
          // localStorage.removeItem("LocalSerum");
          // localStorage.removeItem("LocalBuffy");
          // localStorage.removeItem("LocalOther");  
        }
      }

      bloodSample();
      $('input[name="bloodSample"]').change(function () {
        bloodSample();
      });

      function otherSample() {
        if ($('#otherSampleY').is(':checked')) {
          $('#oSampleTubes').show();
          $('#oSampleDesc').show();
        }
        else if ($('#otherSampleN').is(':checked')) {
          $('#oSampleTubes').hide();
          $('#oSampleDesc').hide();
          $('#OSgridNo').val('');
          $('#otSampleDesc').val('');
          // localStorage.removeItem("LocalOther");
        }
      }

      otherSample();
      $('input[name="otherSample"]').change(function () {
        otherSample();
      });

      function specimenSample() {
        if ($('#specimenSampleY').is(':checked')) {
          $('#countFttubes').show();
          $('#fttubes').show();
          $('#countFntubes').show();
          $('#fntubes').show();
        }
        else if ($('#specimenSampleN').is(':checked')) {
          $('#countFttubes').hide();
          $('#fttubes').hide();
          $('#countFntubes').hide();
          $('#fntubes').hide();
          $('#ftgrid').val('');
          $('#fngrid').val('');
          $('#ft_tubes').val('');
          $('#fn_tubes').val('');
        }
      }

      specimenSample();
      $('input[name="specimenSample"]').change(function () {
        specimenSample();
      });


      function sampleReceive() {
        if ($('#radioprocessed1').is(':checked')) {
          $('#receiveAllSample').show();
          $('#processAllSample').show();
          $('#AllSamplesProcess').show();
        }
        else {
          $('#receiveAllSample').hide();
          $('#processAllSample').hide();
          $('#AllSamplesProcess').hide();
        }
        if (($('#radioprocessed2').is(':checked')) && ($('#bloodSampleY').is(':checked'))) {
          $('#receiveBloodSample').show();
          $('#processBloodSample').show();
          $('#BloodSamplesProcess').show();
        }
        else {
          $('#receiveBloodSample').hide();
          $('#processBloodSample').hide();
          $('#BloodSamplesProcess').hide();
        }
        if (($('#radioprocessed2').is(':checked')) && ($('#specimenSampleY').is(':checked'))) {
          $('#receiveSpecimenSample').show();
          $('#processSpecimenSample').show();
          $('#SpecimenSamplesProcess').show();
        }
        else {
          $('#receiveSpecimenSample').hide();
          $('#processSpecimenSample').hide();
          $('#SpecimenSamplesProcess').hide();
        }
        if (($('#radioprocessed2').is(':checked')) && ($('#otherSampleY').is(':checked'))) {
          $('#receiveOtherSample').show();
          $('#processOtherSample').show();
          $('#OtherSamplesProcess').show();
        }
        else {
          $('#receiveOtherSample').hide();
          $('#processOtherSample').hide();
          $('#OtherSamplesProcess').hide();
        }
      }

      sampleReceive();
      $('input[name="processedRadio"]').change(function () {
        sampleReceive();
      });

      // function sampleBloodReceive() {
      //   if (($('#radioprocessed2').is(':checked'))&&($('#bloodSampleY').is(':checked'))) {
      //     $('#receiveBloodSample').show();
      //     $('#processBloodSample').show();
      //   }
      //   else {
      //     $('#receiveBloodSample').hide();
      //     $('#processBloodSample').hide();
      //   }
      // }

      // sampleBloodReceive();
      // $('input[name="processedRadio"]').change(function () {
      //   sampleBloodReceive();
      // });

      // function sampleSpecimenReceive() {
      //   if (($('#radioprocessed2').is(':checked'))&&($('#specimenSampleY').is(':checked'))) {
      //     $('#receiveSpecimenSample').show();
      //     $('#processSpecimenSample').show();
      //   }
      //   else {
      //     $('#receiveSpecimenSample').hide();
      //     $('#processSpecimenSample').hide();
      //   }
      // }

      // sampleSpecimenReceive();
      // $('input[name="processedRadio"]').change(function () {
      //   sampleSpecimenReceive();
      // });
      // function sampleOtherReceive() {
      //   if (($('#radioprocessed2').is(':checked'))&&($('#otherSampleY').is(':checked'))) {
      //     $('#receiveOtherSample').show();
      //     $('#processOtherSample').show();
      //   }
      //   else {
      //     $('#receiveOtherSample').hide();
      //     $('#processOtherSample').hide();
      //   }
      // }

      // sampleOtherReceive();
      // $('input[name="processedRadio"]').change(function () {
      //   sampleOtherReceive();
      // });

      function RadioTYes() {
        if ($('#RTYes').is(':checked')) {
          $('#rtDC').show();
          $('#rtDLC').show();
        }
        else {
          $('#rtDC').hide();
          $('#rtDLC').hide();
        }
      }

      RadioTYes();
      $('input[name="RadioT"]').change(function () {
        RadioTYes();
      });


      //form3

      function sharestatusYes() {
        if ($('#radioPartial').is(':checked')) {
          $('#partialSamples').show();
        }
        else {
          $('#partialSamples').hide();
        }
      }

      sharestatusYes();
      $('input[name="sharestatus"]').change(function () {
        sharestatusYes();
      });


      function parity() {
        let parityValue = parseInt($('#parity').val(), 10);

        if (parityValue > 15) {
          parityValue = 0;
          $('#parity').val(parityValue);
        } else if (parityValue < 0) {
          parityValue = 0;
          $('#parity').val(parityValue);
        }

        if (parityValue > 0) {
          $('#noChild').show();
        } else {
          $('#noChild').hide();
        }
      }
      parity();
      $('#parity').on('input', function () {
        parity();
      });

      $('#patAge').on('input', function () {
        let patAgeValue = parseInt($('#patAge').val(), 10);

        if (patAgeValue > 100) {
          patAgeValue = 0;
          $('#patAge').val(patAgeValue);
        } else if (patAgeValue < 0) {
          patAgeValue = 0;
          $('#patAge').val(patAgeValue);
        }
      });

      //       document.addEventListener('DOMContentLoaded', function() {
      //   const now = new Date();
      //   const formattedDateTime = now.toISOString().slice(0, 16);  

      //   document.getElementById('sampleProcessedTime').setAttribute('max', formattedDateTime);
      // });


      function numChild() {
        let numChildValue = parseInt($('#numChild').val(), 10);

        if (numChildValue > 30) {
          numChildValue = 0;
          $('#numChild').val(numChildValue);
        } else if (numChildValue < 0) {
          numChildValue = 0;
          $('#numChild').val(numChildValue);
        }

        if (numChildValue > 0) {
          $('#ageFC').show();
          $('#breFd').show();
        } else {
          $('#ageFC').hide();
          $('#breFd').hide();
        }
      }
      numChild();
      $('#numChild').on('change', function () {
        numChild();
      });

      function breFd() {
        if ($('#breFdYes').is(':checked')) {
          $('#durFeed').show();
        }
        else {
          $('#durFeed').hide();
        }
      }
      breFd();
      $('#breFd').on('change', function () {
        breFd();
      });


    });

  </script>
  <script>
    function formatbtHPEInput(input) {
      let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
      let formattedValue = '';

      if (value.length > 2) {
        formattedValue += value.substring(0, 2) + '-';
        if (value.length > 3) {
          formattedValue += value.substring(2, 3) + '-';
          formattedValue += value.substring(3, 9);
        } else {
          formattedValue += value.substring(2, 3);
        }
      } else {
        formattedValue = value;
      }

      input.value = formattedValue;
    }
    function formatStHPEInput(input) {
      let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
      let formattedValue = '';

      if (value.length > 2) {
        formattedValue += value.substring(0, 2) + '-';
        if (value.length > 3) {
          formattedValue += value.substring(2, 3) + '-';
          formattedValue += value.substring(3, 9);
        } else {
          formattedValue += value.substring(2, 3);
        }
      } else {
        formattedValue = value;
      }

      input.value = formattedValue;
    }
  </script>

  <script>
    const prevBtns = document.querySelectorAll(".btn-prev");
    const nextBtns = document.querySelectorAll(".btn-next");
    const progress = document.getElementById("progress");
    const formSteps = document.querySelectorAll(".form-step");
    const progressSteps = document.querySelectorAll(".progress-step");

    let formStepsNum = 0;

    nextBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        formStepsNum++;
        updateFormSteps();
        updateProgressbar();
      });
    });

    prevBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        formStepsNum--;
        updateFormSteps();
        updateProgressbar();
      });
    });

    function updateFormSteps() {
      formSteps.forEach((formStep) => {
        formStep.classList.contains("form-step-active") &&
          formStep.classList.remove("form-step-active");
      });

      formSteps[formStepsNum].classList.add("form-step-active");
    }

    function updateProgressbar() {
      progressSteps.forEach((progressStep, idx) => {
        if (idx < formStepsNum + 1) {
          progressStep.classList.add("progress-step-active");
        } else {
          progressStep.classList.remove("progress-step-active");
        }
      });

      const progressActive = document.querySelectorAll(".progress-step-active");

      progress.style.width =
        ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
    }
    // window.onload = function () {
    //   let storedMrn = localStorage.getItem('MRN');
    //   let storeBio = localStorage.getItem("BioVal");

    //   if (storedMrn) {
    //     document.getElementById('mrnNo').value = storedMrn;
    //   }
    //   if (storeBio) {
    //     document.getElementById('bioBankId').value = storeBio;
    //   }

    // };

    window.onload = function () {
      let storedMrn = localStorage.getItem('MRN');
      let storeBio = localStorage.getItem("BioVal");
      localStorage.removeItem("selectedSGrid");
      localStorage.removeItem("LocalPlasma")
      localStorage.removeItem("LocalSerum")
      localStorage.removeItem("LocalBuffy")
      localStorage.removeItem("LocalOther")
      localStorage.removeItem("LocalFT");
      localStorage.removeItem("LocalFN");

      if (storedMrn) {
        document.getElementById('mrnNo').value = storedMrn;
      }
      if (storeBio) {
        document.getElementById('bioBankId').value = storeBio;
      }
    };
    $(document).ready(function () {
      document.getElementById("bloodSampleN").addEventListener('click', function () {
        localStorage.removeItem("LocalPlasma");
        localStorage.removeItem("LocalSerum");
        localStorage.removeItem("LocalBuffy");
      });

      var subtypeElement = document.getElementById('subtype');
  var otherSubtypeDiv = document.getElementById('pSubtypeOther');

  // Check the initial value of the subtype dropdown
  if (subtypeElement.value === 'other' || subtypeElement.value === 'option6') {
    otherSubtypeDiv.style.display = 'block';
  } else {
    otherSubtypeDiv.style.display = 'none';
  }
    });



    document.addEventListener('DOMContentLoaded', function () {
      const formData = sessionStorage.getItem('formData');
      let mode = localStorage.getItem('mode');
      let biobankID = localStorage.getItem('bioid')
      console.log("mode", mode)
      if (mode === 'SearchView' || mode === 'PendingView' || mode === 'ViewFollowUp') {
        const formElements = document.querySelectorAll('input, select, textarea');
        const doneBtn = document.getElementById("sampleEntry1");
        const submitBtn = document.getElementById("submitButton");
        const finishBtn = document.getElementById('finishButton');

        // formElements.forEach(element => {
        //   element.disabled = true;
        // });
        formElements.forEach(element => {
          const idsToExclude = ['PlasmagridNo', 'SerumgridNo', 'bufferCoatgridNo', 'OSgridNo', 'ftgrid', 'fngrid'];

          // Only disable elements that are not in idsToExclude and have a value
          if (!idsToExclude.includes(element.id)) {
            element.disabled = true;
          }
        });


        finishBtn.style.display = 'block'
        doneBtn.style.display = 'none'
        submitBtn.style.display = 'none'
        document.getElementById('sefCurrentUser').style.display = "block"
        document.getElementById('mdCurrentUser').style.display = "block"
        document.getElementById('brfCurrentUser').style.display = "block"



      }
      // else if (mode === 'SearchEdit') {
      //   // document.getElementById('mrnNo').setAttribute('disabled', true);
      //   document.getElementById('bioBankId').setAttribute('disabled', true);
      // }
      else if (mode === 'SearchEdit' || mode === 'PendingEdit') {
        document.getElementById('mrnNo').setAttribute('disabled', true);
        document.getElementById('bioBankId').setAttribute('disabled', true);
        const finishBtn = document.getElementById('finishButton');

        finishBtn.style.display = 'none';

        // const bloodSampleElementY = document.querySelector('#bloodSampleY').isChecked;
        // console.log("BloodSampleY element:", bloodSampleElementY);
        // const bloodSampleInputs = document.querySelectorAll('input[name="bloodSample"]');
        // const bloodSampleElementN = document.querySelector('#bloodSampleN').isChecked;

        // if (bloodSampleElementY) {
        //   const queryInput = document.querySelector('input[name="bloodSample"]'); // Adjust selector as needed
        //   console.log('queryInput', queryInput)

        //   bloodSampleInputs.forEach(input => {
        //     input.setAttribute('disabled', true);
        //     console.log(`Input with ID ${input.id} disabled`);
        //   });
        // } else if(bloodSampleElementN) {
        //   bloodSampleInputs.forEach(input => {
        //     input.setAttribute('disabled', false);
        //     console.log(`Input with ID ${input.id} is not disabled`);
        //   });
        // }
      }

      else if (mode === "undefined") {
        console.log("mode", mode)
        const finishBtn = document.getElementById('finishButton');

        finishBtn.style.display = 'none'
      }



      if (formData) {
        const data = JSON.parse(formData);
        console.log("Data retrieved from sessionStorage:", data);

        if (data.ie) fillIeForm(data.ie);
        if (data.md) fillMdForm(data.md);
        if (data.brf) fillBrfForm(data.brf);
        console.log("data.ie.bs", data.ie.bs)
        const bloodSampleInputs = document.querySelectorAll('input[name="bloodSample"]');
        const specimenSampleInputs = document.querySelectorAll('input[name="specimenSample"]');
        const otherSampleInputs = document.querySelectorAll('input[name="otherSample"]');
        localStorage.setItem("bloodVStatus", data.ie.bs);
        localStorage.setItem("specimenVStatus", data.ie.ss);
        localStorage.setItem("otherVStatus", data.ie.osmp);

        if (data.ie.bs === 'true') {

          bloodSampleInputs.forEach(input => {
            input.setAttribute('disabled', true);  // Disable the inputs
            console.log(`Input with ID ${input.id} disabled`);
          });
        } else {
          bloodSampleInputs.forEach(input => {
            input.removeAttribute('disabled');  // Re-enable the inputs if not checked
            console.log(`Input with ID ${input.id} enabled`);
          });
        }
        if (data.ie.ss === 'true') {
          document.getElementById('ft_tubes').setAttribute('disabled', true);
          document.getElementById('fn_tubes').setAttribute('disabled', true);
          specimenSampleInputs.forEach(input => {
            input.setAttribute('disabled', true);  // Disable the inputs
            console.log(`Input with ID ${input.id} disabled`);
          });
        } else {
          specimenSampleInputs.forEach(input => {
            input.removeAttribute('disabled');  // Re-enable the inputs if not checked
            console.log(`Input with ID ${input.id} enabled`);
          });
        }
        if (data.ie.osmp === 'true') {

          otherSampleInputs.forEach(input => {
            input.setAttribute('disabled', true);  // Disable the inputs
            console.log(`Input with ID ${input.id} disabled`);
          });
        } else {
          otherSampleInputs.forEach(input => {
            input.removeAttribute('disabled');  // Re-enable the inputs if not checked
            console.log(`Input with ID ${input.id} enabled`);
          });
        }

      } else {
        console.error('No data found in sessionStorage');
      }

      retrieveFollowup(biobankID);

    });

    document.addEventListener('DOMContentLoaded', function () {
      let mode = localStorage.getItem('mode');
      console.log("mode", mode);

      if (mode === "" || mode === "undefined") {
        // Clear all input fields
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
          if (input.type === 'radio' || input.type === 'checkbox') {
            input.checked = false; // Uncheck radio buttons and checkboxes
          } else {
            input.value = ''; // Clear other input fields (e.g., text, number)
          }
        });

        // Clear all select elements
        const selects = document.querySelectorAll('select');
        selects.forEach(select => select.selectedIndex = 0);

        // Clear all textareas
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(textarea => textarea.value = '');
      }
    });

  </script>
  <script>
    let userN = sessionStorage.getItem('userName');
    console.log("User Name", userN)


    function shareData(selectedPatients) {
      console.log("Shared patients :", selectedPatients);
    }
    document.addEventListener('DOMContentLoaded', function () {
      const selectedPatients = JSON.parse(localStorage.getItem('selectedPatients'));

      console.log('Retrieved selectedPatients:', selectedPatients);
    });
    document.getElementById('shareForm').addEventListener('submit', function (e) {
      e.preventDefault(); // Prevent the default form submission
      const timestamp = Math.floor(Date.now() / 1000);

      // Collect form data
      const dateOfEntry = document.getElementById('startInputOutsource').value;
      const institute = document.getElementById('institute').value;
      const projectName = document.getElementById('projectName').value;
      const nopi = document.getElementById('nopi').value;
      const sharedStatus = document.querySelector('input[name="sharestatus"]:checked').value;
      const parSharedRemark = document.getElementById('parSharedRemark').value;

      // Retrieve selected patients from localStorage
      const selectedPatients = JSON.parse(localStorage.getItem('selectedPatients'));

      if (!selectedPatients || selectedPatients.length === 0) {
        alert("No patients selected.");
        return;
      }

      // Prepare the database structure
      const database = {};  // This will be your database object

      selectedPatients.forEach(patient => {
        const { bioBankId, seqKey, boxName, gridData } = patient;

        // Ensure gridData is an array
        let seatList = Array.isArray(gridData) ? gridData : gridData.split(',').map(seat => seat.trim());

        // Fetch existing sections from Firebase for the specific bioBankId
        db.ref(`Os/${bioBankId}`).once('value')
          .then(snapshot => {
            const sections = snapshot.val();

            // Create the structure for each patient
            const patientEntry = {
              doe: dateOfEntry,
              dpt: institute,
              prj: projectName,
              pip: nopi || "N/A",
              os_ub: userN,
              lbi: {},
              ossts: sharedStatus,
              psr: parSharedRemark || "N/A"
            };

            // Check if the patient entry already exists in the database structure
            if (!database[bioBankId]) database[bioBankId] = {};
            if (!database[bioBankId][seqKey]) database[bioBankId][seqKey] = {};
            if (!database[bioBankId][seqKey][timestamp]) {
              database[bioBankId][seqKey][timestamp] = patientEntry;
            }

            // Initialize lbi[boxName] as an array if it doesn't exist
            const existingEntry = database[bioBankId][seqKey][timestamp];
            if (!existingEntry.lbi[boxName]) {
              existingEntry.lbi[boxName] = [];
            }

            // Iterate over gridData to append each seatID to the array
            seatList.forEach(seatID => {
              existingEntry.lbi[boxName].push(seatID.trim());
            });

            // Update Firebase with the consolidated data
            return db.ref(`Os/${bioBankId}/${seqKey}/${timestamp}`).set(existingEntry);
          })
          .then(() => {
            alert('Form submitted successfully for BioBank ID: ' + bioBankId);

            // Update the grid status in the appropriate boxes
            const seatPromises = seatList.map(seatID => {
              seatID = seatID.trim();
              const index = getSeatIndex(seatID);

              // Handle updating both bb and sb nodes in parallel
              const bbPromise = db.ref(`bb/${boxName}`).once('value')
                .then(snapshot => {
                  if (snapshot.exists()) {
                    return db.ref(`bb/${boxName}/${index}`).update({ status: sharedStatus });
                  }
                  console.log("bb does not exist");
                });

              const sbPromise = db.ref(`sb/${boxName}`).once('value')
                .then(snapshot => {
                  if (snapshot.exists()) {
                    return db.ref(`sb/${boxName}/${index}`).update({ status: sharedStatus });
                  }
                  console.log("sb does not exist");
                });

              return Promise.all([bbPromise, sbPromise]);
            });

            return Promise.all(seatPromises);
          })
          .then(() => {
            // Redirect based on the mode
            let mode = localStorage.getItem('mode');
            switch (mode) {
              case 'SearchView':
              case 'SearchEdit':
              case 'share':
                window.location.href = 'search.html';
                break;
              case 'PendingView':
              case 'PendingEdit':
              case 'EditFollowUps':
              case 'ViewFollowUp':
                window.location.href = 'todo.html';
                break;
              default:
                window.location.href = 'home.html';
                break;
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error submitting form for BioBank ID: ' + bioBankId);
          });
      });

      console.log("Database structure to be saved:", database);
    });

  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Assuming you have Firebase initialized already

      // Fetch the bioBankId from the input field
      var bioidFetch = document.getElementById("bioBankId").value;

      if (bioidFetch) {
        // Query Firebase to get the MRN number for the given bioBankId
        db.ref('bbnmrn').orderByValue().equalTo(bioidFetch).once('value', snapshot => {
          if (snapshot.exists()) {
            // Retrieve the MRN key (which is the MRN number)
            const mrnNumber = Object.keys(snapshot.val())[0];
            console.log("MRN Number for BioBank ID", bioidFetch, ":", mrnNumber);

            document.getElementById("mrnNo").value = mrnNumber;
          } else {
            console.log("No MRN found for BioBank ID:", bioidFetch);
          }
        }).catch(error => {
          console.error("Error fetching MRN:", error);
        });
      } else {
        console.log("BioBank ID is empty or undefined.");
      }
    });

  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      let mode = localStorage.getItem('mode');
      let biobankID = localStorage.getItem('sharedbioid');
      console.log("mode in shared :", mode)
      if (mode === 'share') {
        console.log("Adv. Happy New Year");
        document.getElementById("backToCardBtn").style.display = 'none';
        document.getElementById("sharedSampleBox").style.display = 'none';

        document.getElementById('sharedCard').style.display = 'none';
        document.getElementById('shareForm').style.display = 'block';


      }

      if (mode === 'sharedView') {
        const formElements = document.querySelectorAll('input, select, textarea');
        const doneBtn = document.getElementById("sampleEntry1");
        const submitBtn = document.getElementById("shareSubmit");

        // Disable all form elements
        formElements.forEach(element => {
          // Exclude the input with id 'sharedSampleBox' from being disabled
          if (element.id !== 'sharedSample') {
            element.disabled = true;
          }
        });



        document.getElementById('sharedSampleBox').style.display = 'block';
        document.getElementById('sharedCard').style.display = 'block';
        document.getElementById('shareForm').style.display = 'none';
        doneBtn.style.display = 'none';
        submitBtn.style.display = 'none';
      }

      console.log("bhanu");
      retrieveOs(biobankID);
    });




  </script>
</body>

</html>
