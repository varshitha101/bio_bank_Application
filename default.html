<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bio Bank</title>

  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Round|Material+Icons+Sharp|Material+Icons+Two+Tone"
    rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" />

  <!-- jQuery UI CSS for datepicker -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>

  <script
    src="https://cdn.jsdelivr.net/npm/tempusdominus-bootstrap-4@5.39.0/build/js/tempusdominus-bootstrap-4.min.js"></script>

  <link rel="stylesheet" href="assets/css/style.css">
  <script src="index.js"></script>

  <style>
    /* Progress Bar Styles */
    /* #progressBarContainer {
      height: 20px;
      background-color: #f3f3f3;
      border-radius: 10px;
    }

    #progressBar {
      height: 100%;
      border-radius: 10px;
      text-align: center;
      line-height: 20px;
      color: white;
      font-weight: bold;
    } */
    :root {
      --primary-color: #1991c9;
    }

    /* Progressbar */
    .progressbar {
      position: relative;
      display: flex;
      width: 900px;
      justify-content: space-between;
      counter-reset: step;
      margin: 1rem 4rem 1rem 5rem;
    }

    .progressbar::before,
    .progress {
      content: "";
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 4px;
      width: 100%;
      background-color: #dcdcdc;
      z-index: -1;
    }

    .progress {
      background-color: var(--primary-color);
      width: 0%;
      transition: 0.3s;
    }

    .progress-step {
      width: 2.1875rem;
      height: 2.1875rem;
      background-color: #e0e0e0;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .progress-step::before {
      counter-increment: step;
      content: counter(step);
    }

    .progress-step-active {
      background-color: var(--primary-color);
      color: #f3f3f3;
    }

    .nav-tab-link {
      color: #1991c9;
      font-weight: bold;
    }
  </style>

</head>

<body>
  <div class="sticky-top">
    <nav class="navbar sticky-top navbar-expand-lg navbar-light" style="background-color: rgba(25, 145, 201,1)">
      <div class="container-fluid">
        <div class="mx-auto">
          <ul class="nav nav-pills nav-fill">
            <li class="nav-item">
              <a class="nav-link navLinks" href="#" data-href="statistics.html" id="homeLink">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link navLinks" href="#" data-href="home.html" id="sampleLink">Sample</a>
            </li>
            <li class="nav-item">
              <a class="nav-link navLinks" href="#" data-href="search.html" id="searchLink">Search</a>
            </li>
            <li class="nav-item">
              <a class="nav-link navLinks" href="#" data-href="todo.html" id="todoLink">To-Do list</a>
            </li>
          </ul>
        </div>
        <div id="loading" class="spinmodal" style="display: none;">
          <!-- Initially hidden -->
          <div class="spinmodal-content">
            <div class="row">
              <div class="col-4">
                <div class="spinner"></div> <!-- Spinner circle -->
              </div>
              <div class="col-8">
                <h3 style="align-content: center; padding-top: 20px;">Loading...</h3>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex ms-auto">
          <button onclick="logout()" id="logout" type="submit" class="btn btn-outline-light">Logout</button>
        </div>
      </div>
    </nav>
    <nav aria-label="breadcrumb">
      <div class="d-flex justify-content-between align-items-center">
        <ol class="breadcrumb col-sm-12">
          <li class="breadcrumb-item" id="bread2"></li>
          <li class="breadcrumb-item active" aria-current="page">Library</li>
        </ol>
        <button type="button" id="breadBack"
          style="display: none; position: absolute; top: 60px; right: 32px; height: 40px;" class="btn btn-secondary"
          onclick="window.history.back();">Cancel</button>
      </div>
    </nav>

  </div>

  <div class="wrapper">
    <div class="container mt-3">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link nav-tab-link active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab"
            aria-controls="tab1" aria-selected="true">Sample Inputs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-tab-link" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab" aria-controls="tab2"
            aria-selected="false">Follow-Ups</a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-tab-link" id="tab3-tab" data-toggle="tab" href="#tab3" role="tab" aria-controls="tab3"
            aria-selected="false">Shared</a>
        </li>
      </ul>

      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">

          <div class="progressbar">
            <div class="progress" id="progress"></div>
            <div class="progress-step progress-step-active" data-title="form1"></div>
            <div class="progress-step" data-title="form2"></div>
            <div class="progress-step" data-title="form3"></div>
          </div>
          <div class="table-responsive" id="inputSampleTable">
            <form class="form-group mt-3 form-step form-step-active" id="form1">
              <div class="row ml-1 mb-3">
                <h3>Initial Entry</h3>
              </div>

              <div class="row ml-1 mb-3" id="mnrId">
                <label for="mrnNo" class="col-sm-2 mb-1 col-form-label">MRN Number <span
                    style="color: red; font-weight: bold;">*</span> </label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="mrnNo" placeholder="Enter MRN Number" required>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="cancer_type" class="col-sm-2 mb-1 col-form-label">Cancer Type <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <select id="cancer_type" class="form-control">
                    <option value="0" selected>Select</option>
                    <option value="brst">Breast Cancer</option>
                    <option value="2" disabled>Ovary</option>
                    <option value="3" disabled>Cervix</option>
                    <option value="4" disabled>Endometrium</option>
                    <option value="5" disabled>Pancreas</option>
                    <option value="6" disabled>Uterus</option>
                    <option value="7" disabled>Omentum</option>
                    <option value="8" disabled>Vulva</option>
                    <option value="9" disabled>Rectum</option>
                    <option value="10" disabled>Colon</option>
                    <option value="10" disabled>Esophagus</option>
                    <option value="10" disabled>Stomach</option>
                    <option value="10" disabled>Liver</option>
                    <option value="10" disabled>Head and Neck</option>
                    <option value="10" disabled>Urinary Bladder</option>
                    <option value="10" disabled>Lung</option>
                    <option value="10" disabled>Ureter</option>
                    <option value="10" disabled>Thyroid</option>
                    <option value="10" disabled>Lymph node</option>
                    <option value="10" disabled>Soft tissue</option>
                  </select>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="bioBankId" class="col-sm-2 mb-1 col-form-label">Bio Bank ID <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="bioBankId" placeholder="Enter Bio Bank ID"
                    oninput="formatBioInput(this)" required>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="patAge" class="col-sm-2 mb-1 col-form-label">Age <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="100" id="patAge" class="form-control" placeholder="yrs">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="gender" class="col-sm-2 mb-1 col-form-label">Gender <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioMale" name="customRadio" class="custom-control-input" value="M">
                    <label class="custom-control-label" for="radioMale">Male</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioFemale" name="customRadio" class="custom-control-input" value="F">
                    <label class="custom-control-label" for="radioFemale">Female</label>
                  </div>
                </div>
              </div>


              <!-- <div class="row ml-1 mb-3">
                <label for="cancer_stage" class="col-sm-2 mb-1 col-form-label">Cancer Stage <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio0" name="radioCancerStage" class="custom-control-input"
                      value="Stage0">
                    <label class="custom-control-label" for="CSRadio0">Stage 0</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio1" name="radioCancerStage" class="custom-control-input"
                      value="Stage1">
                    <label class="custom-control-label" for="CSRadio1">Stage 1</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio2" name="radioCancerStage" class="custom-control-input"
                      value="Stage2">
                    <label class="custom-control-label" for="CSRadio2">Stage 2</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="CSRadio3" name="radioCancerStage" class="custom-control-input"
                      value="Stage3">
                    <label class="custom-control-label" for="CSRadio3">Stage 3</label>
                  </div>
                </div>
              </div> -->

              <div class="row ml-1 mb-3">
                <label for="procedure" class="col-sm-2 mb-1 col-form-label">Procedure Types <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">

                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioProcedure1" name="customProcedure" class="custom-control-input"
                      value="b" required>
                    <label class="custom-control-label" for="radioProcedure1">Biopsy</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioProcedure2" name="customProcedure" class="custom-control-input"
                      value="r" required>
                    <label class="custom-control-label" for="radioProcedure2">Resection</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="procedureDetail" class="col-sm-2 mb-1 col-form-label">Details of Procedure</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="procedureDetail" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="surgeonName" class="col-sm-2 mb-1 col-form-label">Surgeon Name</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="surgeonName" placeholder="Enter the Name of Surgeon">
                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Box No.</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="boxNo" placeholder="Box No.">
                </div>
              </div> -->
              <div class="row ml-1 mb-3">
                <label for="MetastasisSample" class="col-sm-2 mb-1 col-form-label">Metastasis Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MetastasisSampleY" name="MetastasisSample" class="custom-control-input"
                      value=true required>
                    <label class="custom-control-label" for="MetastasisSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MetastasisSampleN" name="MetastasisSample" class="custom-control-input"
                      value=false required>
                    <label class="custom-control-label" for="MetastasisSampleN">No</label>
                  </div>
                </div>
                <span></span>
              </div>
              <div class="row ml-1 mb-3">
                <label for="denovo" class="col-sm-2 mb-1 col-form-label">Denovo metastasis</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="denovoYes" name="denovo" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="denovoYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="denovoNo" name="denovo" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="denovoNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-denovo">
                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="MetastasisPT" class="col-sm-3 mb-1 col-form-label">Metastasis Post Treatment</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MPTYes" name="MetaPT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="MPTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MPTNo" name="MetaPT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="MPTNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-MPT">
                </div>
              </div> -->

              <div class="row ml-1 mb-3" id="mptA" style="display: none;">
                <label for="mpt_age" class="col-sm-2 mb-1 col-form-label">Age at Metastasis</label>
                <div class="col-sm-10">
                  <input type="number" class="form-control" max="100" id="mpt_age" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="mptS" style="display: none;">
                <label for="mpt_site" class="col-sm-2 mb-1 col-form-label">Site</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="mpt_site" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="mptRS" style="display: none;">
                <label for="mpt_rs" class="col-sm-2 mb-1 col-form-label">Receptor Status</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="mpt_rs" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="specimensample" class="col-sm-2 mb-1 col-form-label">Tissue Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="specimenSampleY" name="specimenSample" class="custom-control-input"
                      value=true required>
                    <label class="custom-control-label" for="specimenSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="specimenSampleN" name="specimenSample" class="custom-control-input"
                      value=false required>
                    <label class="custom-control-label" for="specimenSampleN">No</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="countFttubes" style="display: none;">
                <label for="ft_tubes" class="col-sm-2 mb-1 col-form-label">No of FT Tubes <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <select id="ft_tubes" class="form-control">
                    <option value="0">None</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="fttubes" style="display: none;">
                <label for="gridNo" class="col-sm-2 mb-1 col-form-label">FT Tubes Grids <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="ftgrid" onclick="FTModal()" placeholder="FT Grid No.">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="countFntubes" style="display: none;">
                <label for="fn_tubes" class="col-sm-2 mb-1 col-form-label">No of FN Tubes <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <select id="fn_tubes" class="form-control">
                    <option value="0">None</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="fntubes" style="display: none;">
                <label for="gridNo" class="col-sm-2 mb-1 col-form-label">FN Tubes Grids <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="fngrid" onclick="FNModal()" placeholder="FN Grid No.">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="bloodsample">
                <label for="bloodsample" class="col-sm-2 mb-1 col-form-label">Blood Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="bloodSampleY" name="bloodSample" class="custom-control-input" value=true
                      required>
                    <label class="custom-control-label" for="bloodSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="bloodSampleN" name="bloodSample" class="custom-control-input" value=false
                      required>
                    <label class="custom-control-label" for="bloodSampleN">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="serumtubes" style="display: none;">
                <label for="SerumgridNo" class="col-sm-2 mb-1 col-form-label">Serum Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="SerumgridNo" onclick="serumModal()"
                    placeholder="Serum Grid">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="plasmatubes" style="display: none;">
                <label for="PlasmagridNo" class="col-sm-2 mb-1 col-form-label">Plasma Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="PlasmagridNo" onclick="plasmaModal()"
                    placeholder="Plasma Grid">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="bufferCoatTubes" style="display: none;">
                <label for="bufferCoatgridNo" class="col-sm-2 mb-1 col-form-label">Buffy Coat Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="bufferCoatgridNo" onclick="buffyModal()"
                    placeholder="Buffer Grid">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="otherSample" class="col-sm-2 mb-1 col-form-label">Other Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="otherSampleY" name="otherSample" class="custom-control-input" value=true
                      required>
                    <label class="custom-control-label" for="otherSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="otherSampleN" name="otherSample" class="custom-control-input" value=false
                      required>
                    <label class="custom-control-label" for="otherSampleN">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="oSampleTubes" style="display: none;">
                <label for="OSgridNo" class="col-sm-2 mb-1 col-form-label">Other Sample Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="OSgridNo" onclick="OSModal()"
                    placeholder="Other Sample Grid">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="oSampleDesc" style="display: none;">
                <label for="otSampleDesc" class="col-sm-2 mb-1 col-form-label">Other Sample description</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="otSampleDesc" placeholder="Other sample description">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="rltSample" class="col-sm-2 mb-1 col-form-label">RLT Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="rltSampleY" name="rltSample" class="custom-control-input" value=true
                      required>
                    <label class="custom-control-label" for="rltSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="rltSampleN" name="rltSample" class="custom-control-input" value=false
                      required>
                    <label class="custom-control-label" for="rltSampleN">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="rltSampleTubes" style="display: none;">
                <label for="rltSgridNo" class="col-sm-2 mb-1 col-form-label">RLT Sample Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="rltSgridNo" onclick="rltSModal()"
                    placeholder="RLT Sample Grid">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="pcbSample" class="col-sm-2 mb-1 col-form-label">Primary Culture Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pcbSampleY" name="pcbSample" class="custom-control-input" value=true
                      required>
                    <label class="custom-control-label" for="pcbSampleY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pcbSampleN" name="pcbSample" class="custom-control-input" value=false
                      required>
                    <label class="custom-control-label" for="pcbSampleN">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="pcbViable" style="display: none;">
                <label for="pcbV" class="col-sm-2 mb-1 col-form-label">PC sample viable ?<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pcbVY" name="pcbV" class="custom-control-input" value=Yes required>
                    <label class="custom-control-label" for="pcbVY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pcbVN" name="pcbV" class="custom-control-input" value=No required>
                    <label class="custom-control-label" for="pcbVN">No</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pcbVIp" name="pcbV" class="custom-control-input" value=Inprogress required>
                    <label class="custom-control-label" for="pcbVIp">Inprogress</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="pcbSampleTubes" style="display: none;">
                <label for="pcbSgridNo" class="col-sm-2 mb-1 col-form-label">PC Sample Grid <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="pcSgridNo" onclick="pcSModal()"
                    placeholder="PC Sample Grid">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="consent" class="col-sm-2 mb-1 col-form-label">Consent</label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioConsent1" name="customConsent" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="radioConsent1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioConsent2" name="customConsent" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="radioConsent2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-consent">
                  <!-- The icon will be dynamically inserted here -->
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ischemic" class="col-sm-2 mb-1 col-form-label">Ischemic Sample <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioIschemic1" name="IschemicRadio" class="custom-control-input"
                      value=true>
                    <label class="custom-control-label" for="radioIschemic1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioIschemic2" name="IschemicRadio" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="radioIschemic2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container">
                  <!-- The icon will be dynamically inserted here -->
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="NACT" class="col-sm-2 mb-1 col-form-label">NACT</label>
                <div class="col-sm-9">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="NACTYes" name="NACT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="NACTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="NACTNo" name="NACT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="NACTNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-NACT">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="nactDC" style="display: none;">
                <label for="NACT_cycle" class="col-sm-2 mb-1 col-form-label">NACT Drug Cycle</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="NACT_cycle" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="nactDLC" style="display: none;">
                <label for="NACT_cycle_D" class="col-sm-2 mb-1 col-form-label">NACT Date of last Cycle</label>
                <div class="col-sm-10">
                  <input type="date" class="form-control" id="NACT_cycle_D" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="ischemic" class="col-sm-2 mb-1 col-form-label">All samples Received Together? <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioprocessed1" name="processedRadio" class="custom-control-input"
                      value=true>
                    <label class="custom-control-label" for="radioprocessed1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="radioprocessed2" name="processedRadio" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="radioprocessed2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-samRev">
                  <!-- The icon will be dynamically inserted here -->
                </div>
              </div>

              <div class="row ml-1 mb-3" id="AllSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="processedBy" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="receiveAllSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label"> Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="sampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="sampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processAllSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Processed Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="sampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="sampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="BloodSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Blood Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="BprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveBloodSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Blood sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="bloodSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="bloodSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processBloodSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Blood sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="bloodSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="bloodSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="SpecimenSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Tissue Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="SprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveSpecimenSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Tissue sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="SpecimenSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="SpecimenSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processSpecimenSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Tissue sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="SpecimenSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="SpecimenSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="OtherSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Other Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="OprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveOtherSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Other sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="OtherSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="OtherSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processOtherSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Other sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="OtherSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="OtherSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="RLTSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">RLT Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="RLTprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receiveRLTSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">RLT sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="RLTSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="RLTSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processRLTSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">RLT sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="RLTSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="RLTSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="PCSamplesProcess" style="display: none;">
                <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Primary Culture Sample Processed By <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="PCprocessedBy" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="receivePCSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Primary Culture sample Received Time <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="PCSampleReceivedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="PCSampleReceivedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="processPCSample" style="display: none;">
                <label for="date" class="col-sm-2 mb-1 col-form-label">Primary Culture sample Processed Time<span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="row">

                    <div class="col-sm-6">
                      <input type="date" class="form-control" id="PCSampleProcessedDate" placeholder="Select Date"
                        required>
                    </div>
                    <div class="col-sm-6">
                      <input type="time" class="form-control" id="PCSampleProcessedTime" placeholder="Select Date"
                        required>
                    </div>
                  </div>
                </div>
              </div>







              <div id="sefCurrentUser" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Data Entry By </label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="sefdataEB" placeholder="">
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="row" style="justify-content: space-around;">
                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="submit" class="btn btn-success btn-xs" id="sampleEntry1">Done</button>
                  </div>
                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-primary btn-xs btn-next" id="nextButton1">Next</button>
                  </div>
                </div>
              </div>
            </form>
            <form class="form-group mt-3 form-step" id="form2" style="display: none;">
              <div class="row ml-1 mb-3">
                <h3>MetaData</h3>
              </div>
              <div id="mdCurrentUser" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="boxNo" class="col-sm-3 mb-1 col-form-label">Data Entry By </label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="mddataEB" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="RadioFHabit" class="col-sm-3 mb-1 col-form-label">Family History of Cancer</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="familyHistoryCancer1" name="RadioFHabit" class="custom-control-input"
                      value=true>
                    <label class="custom-control-label" for="familyHistoryCancer1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="familyHistoryCancer2" name="RadioFHabit" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="familyHistoryCancer2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-RadioFHabit">
                  <!-- The icon will be dynamically inserted here -->
                </div>
              </div>

              <div class="row ml-1 mb-3" id="relation_Cancer" style="display: none;">
                <label for="date" class="col-sm-3 mb-1 col-form-label">Relation and Cancer type</label>
                <div class="col-sm-9">
                  <div class="row">
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="familyRelation" placeholder="Relation">
                    </div>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="familyCancerType" placeholder="Cancer Type">
                    </div>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="foodHabit" class="col-sm-3 mb-1 col-form-label">Food Habits</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="foodH1" name="RadioFdHabit" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="foodH1">Veg</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="foodH2" name="RadioFdHabit" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="foodH2">Non Veg</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-RadioFdHabit">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="alcoholHabit" class="col-sm-3 mb-1 col-form-label">History of Alcohol Consumption</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="AlcoholH1" name="RadioAlcoholHabit" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="AlcoholH1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="AlcoholH2" name="RadioAlcoholHabit" class="custom-control-input"
                      value=false>
                    <label class="custom-control-label" for="AlcoholH2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-RadioAlcoholHabit">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="smokingHabit" class="col-sm-3 mb-1 col-form-label">History of Smoking</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="smokeH1" name="RadioSmokeHabit" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="smokeH1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="smokeH2" name="RadioSmokeHabit" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="smokeH2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-RadioSmokeHabit">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="EComorb" class="col-sm-3 mb-1 col-form-label">Existing Comorbidities</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ECH1" name="ECH" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="ECH1">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ECH2" name="ECH" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="ECH2">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-ECH">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="medications" style="display: none;">
                <label for="Comorbidity" class="col-sm-3 mb-1 col-form-label">Comorbidity & Corresponding Medications
                  for Comorbidity</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="comorbidityMedications" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="FF_QC" class="col-sm-3 mb-1 col-form-label">FF_QC comments</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="ffQcComments" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="FF_ti" class="col-sm-3 mb-1 col-form-label">FF_tissue Remarks</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="ffTissueRemarks" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="tumor" class="col-sm-3 mb-1 col-form-label">Tumor Site (Right/Left/Bilateral)</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="tumorR" name="tumorSite" class="custom-control-input" value="R">
                    <label class="custom-control-label" for="tumorR">Right</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="tumorL" name="tumorSite" class="custom-control-input" value="L">
                    <label class="custom-control-label" for="tumorL">Left</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="tumorB" name="tumorSite" class="custom-control-input" value="BL">
                    <label class="custom-control-label" for="tumorB">Bilateral</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-tumorSite">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="tumorPercentage" class="col-sm-3 mb-1 col-form-label">Tumor %</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="tumorPercentage" placeholder="Percentage %">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="ageAtDiagnosis" class="col-sm-3 mb-1 col-form-label">Age at Diagnosis</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="ageAtDiagnosis" placeholder="yrs">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="cStage" class="col-sm-3 mb-1 col-form-label">Clinical Stage</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="clinicalStage" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="IHC_Status" class="col-sm-3 mb-1 col-form-label">IHC Marker status</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="IHC_yes" name="IHC" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="IHC_yes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="IHC_no" name="IHC" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="IHC_no">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-IHC">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="ihcDescr" style="display: none;">
                <label for="IHC_Description" class="col-sm-3 mb-1 col-form-label">IHC Marker Description</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="IHC_Description" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="gTest" class="col-sm-3 mb-1 col-form-label">Genetic Testing</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="gt_yes" name="GeneticT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="gt_yes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="gt_no" name="GeneticT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="gt_no">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-GeneticT">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="dt_Desc" style="display: none;">
                <label for="GT_Description" class="col-sm-3 mb-1 col-form-label">Genetic Testing Description</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="GT_Description" placeholder="">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="pSubtype" class="col-sm-3 mb-1 col-form-label">Histological Subtype</label>
                <div class="col-sm-9">
                  <select id="subtype" class="form-control">
                    <option value="">Select</option>
                    <option value="option1">No residual invasive carcinoma</option>
                    <option value="option2">Invasive carcinoma of no special type (ductal)</option>
                    <option value="option3">Micro-invasive carcinoma</option>
                    <option value="option4">Invasive lobular carcinoma</option>
                    <option value="option5">Invasive carcinoma with mixed ductal and lobular features</option>
                    <option value="option6">Invasive carcinoma with features of (specify)</option>
                    <option value="option7">Tubular carcinoma</option>
                    <option value="option8">Invasive cribriform carcinoma</option>
                    <option value="option9">Mucinous carcinoma</option>
                    <option value="option10">Invasive micropapillary carcinoma</option>
                    <option value="option11">Apocrine adenocarcinoma</option>
                    <option value="option12">Metaplastic carcinoma</option>
                    <option value="option13">Encapsulated papillary carcinoma with invasion</option>
                    <option value="option14">Solid papillary carcinoma with invasion</option>
                    <option value="option15">Intraductal papillary adenocarcinoma with invasion</option>
                    <option value="option16">Adenoid cystic carcinoma</option>
                    <option value="option17">Neuroendocrine tumor</option>
                    <option value="option18">Neuroendocrine carcinoma</option>
                    <option value="option19">Invasive carcinoma, type cannot be determined</option>
                    <option value="other">Other histologic type not listed (specify)</option>
                  </select>
                </div>
              </div>
              <div id="pSubtypeOther" style="display: none;">
                <div class="row ml-1 mb-3">
                  <div class="col-sm-3 mb-1">
                    <label for="pSubtypeOther" class="col-form-label">Other Subtype</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="pstOt" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="grade" class="col-sm-3 mb-1 col-form-label">Grade</label>
                <div class="col-sm-9">
                  <select id="sampleGrade" class="form-control">
                    <option value="">Select</option>
                    <option value="grade1">Grade 1</option>
                    <option value="grade2">Grade 2</option>
                    <option value="grade3">Grade 3</option>
                    <option value="Only microinvasion present">Only microinvasion present</option>
                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="focality" class="col-sm-3 mb-1 col-form-label">Focality</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="unifocal" name="focal" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="unifocal">Unifocal</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="multifocal" name="focal" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="multifocal">Multifocal</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-focal">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="dcisF" class="col-sm-3 mb-1 col-form-label">DCIS</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="dcisY" name="dcis" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="dcisY">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="dcisN" name="dcis" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="dcisN">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-dcis">
                </div>
              </div>
              <div id="dcisGradeSec" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="dcisGrade" class="col-sm-3 mb-1 col-form-label">DCIS Grade</label>
                  <div class="col-sm-9">
                    <select id="dcisGrade" class="form-control">
                      <option value="">Select</option>
                      <option value="Grade1">I</option>
                      <option value="Grade2">II</option>
                      <option value="Grade3">III</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="LVI" class="col-sm-3 mb-1 col-form-label">LVI</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="lviYes" name="LVI" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="lviYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="lviNo" name="LVI" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="lviNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-LVI">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="PNI" class="col-sm-3 mb-1 col-form-label">PNI</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PNIYes" name="PNI" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="PNIYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PNINo" name="PNI" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="PNINo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-PNI">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="pTNM" class="col-sm-3 mb-1 col-form-label">pTNM</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="pTNM" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="AJCC" class="col-sm-3 mb-1 col-form-label">AJCC Staging</label>
                <div class="col-sm-9">
                  <div class="row">
                    <div class="col-sm-6">
                      <select id="AJCC1" class="form-control">
                        <option value="">Select</option>
                        <option value="I">I</option>
                        <option value="II">II</option>
                        <option value="III">III</option>
                        <option value="IV">IV</option>
                      </select>
                    </div>
                    <div class="col-sm-6">
                      <select id="AJCC2" class="form-control">
                        <option value="">Select</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                      </select>
                    </div>
                  </div>

                </div>
              </div>


              <div class="row ml-1 mb-3">
                <label for="nodes" class="col-sm-3 mb-1 col-form-label">Number of Nodes tested</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="nodesTested" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="nodes" class="col-sm-3 mb-1 col-form-label">Number of Positive Nodes</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="positiveNodes" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="tumor_Size" class="col-sm-3 mb-1 col-form-label">Tumor Size</label>
                <div class="col-sm-9">
                  <div class="row">
                    <div class="col-4">
                      <input type="text" class="form-control" id="tumorSizeL" placeholder="cm">
                    </div>
                    <div class="col-4">
                      <input type="text" class="form-control" id="tumorSizeW" placeholder="cm">
                    </div>
                    <div class="col-4">
                      <input type="text" class="form-control" id="tumorSizeH" placeholder="cm">
                    </div>
                  </div>

                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="denovo" class="col-sm-3 mb-1 col-form-label">Denovo metastasis</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="denovoYes" name="denovo" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="denovoYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="denovoNo" name="denovo" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="denovoNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-denovo">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="MetastasisPT" class="col-sm-3 mb-1 col-form-label">Metastasis Post Treatment</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MPTYes" name="MetaPT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="MPTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="MPTNo" name="MetaPT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="MPTNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-MPT">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="mptA" style="display: none;">
                <label for="mpt_age" class="col-sm-3 mb-1 col-form-label">Age at Metastasis</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" max="100" id="mpt_age" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="mptS" style="display: none;">
                <label for="mpt_site" class="col-sm-3 mb-1 col-form-label">Site</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="mpt_site" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="mptRS" style="display: none;">
                <label for="mpt_rs" class="col-sm-3 mb-1 col-form-label">Receptor Status</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="mpt_rs" placeholder="">
                </div>
              </div> -->
              <!-- <div class="row ml-1 mb-3">
                <label for="HPE" class="col-sm-3 mb-1 col-form-label">Biopsy Tissue number HPE</label>
                <div class="col-sm-9">
                  <input type="text" id="btHPEInput" class="form-control" placeholder="YY-S-XXXXXX" maxlength="11"
                    oninput="formatbtHPEInput(this)" />
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="biospyDate" class="col-sm-3 mb-1 col-form-label">Biopsy Date</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="biopsyDate" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="surTissueNum" class="col-sm-3 mb-1 col-form-label">Surgery Tissue Number HPE</label>
                <div class="col-sm-9">
                  <input type="text" id="StHPEInput" class="form-control" placeholder="YY-S-XXXXXX" maxlength="11"
                    oninput="formatStHPEInput(this)" />
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="surDate" class="col-sm-3 mb-1 col-form-label">Surgery Date</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="surgeryDate" placeholder="Select Date">
                </div>
              </div> -->

              <div class="row ml-1 mb-3">
                <label for="rcbScore" class="col-sm-3 mb-1 col-form-label">RCB Scores</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="rcbScores" placeholder="value from 0 to 3.28">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="rcbClass" class="col-sm-3 mb-1 col-form-label">RCB Class</label>
                <div class="col-sm-9">
                  <select id="rcbClass" class="form-control">
                    <option value="" selected>Select</option>
                    <option value="1">I</option>
                    <option value="2">II</option>
                    <option value="3">III</option>
                  </select>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="ACT" class="col-sm-3 mb-1 col-form-label">ACT</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ACTYes" name="ACT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="ACTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ACTNo" name="ACT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="ACTNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-ACT">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="actDC" style="display: none;">
                <label for="ACT_Cycles" class="col-sm-3 mb-1 col-form-label">ACT Drug Cycles</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="actDrugCycles" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="actDLC" style="display: none;">
                <label for="actDate" class="col-sm-3 mb-1 col-form-label">ACT Date of last Cycle</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="actDateLastCycle" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="radioThy" class="col-sm-3 mb-1 col-form-label">Radio Therapy</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="RTYes" name="RadioT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="RTYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="RTNo" name="RadioT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="RTNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-RadioT">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="rtDC" style="display: none;">
                <label for="RT_Cycles" class="col-sm-3 mb-1 col-form-label">Radiotherapy Details</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="radiotherapyDetails" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="rtDLC" style="display: none;">
                <label for="rtDate" class="col-sm-3 mb-1 col-form-label">Radiotherapy Date of last Cycle</label>
                <div class="col-sm-9">
                  <input type="date" class="form-control" id="radiotherapyLastCycleDate" placeholder="Select Date">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="paraThy" class="col-sm-3 mb-1 col-form-label">Is paraffin Block Available</label>
                <div class="col-sm-8">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pbYes" name="pbT" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="pbYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="pbNo" name="pbT" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="pbNo">No</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-pbT">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="PBN">
                <label for="PBNum" class="col-sm-3 mb-1 col-form-label">Paraffin Block Number</label>
                <div class="col-sm-9">
                  <input type="text" id="PBInput" class="form-control" placeholder="YY-M-XXXX" maxlength="9"
                    oninput="formatPBInput(this)" />
                </div>
              </div>

              <div class="col-12">
                <div class="row" style="justify-content: space-around;">

                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-primary btn-xs btn-prev" id="backButton1">Back</button>
                  </div>
                  <div class="col-4 mt-2" style="text-align: center;">
                    <button type="button" class="btn btn-success btn-xs btn-next" id="nextButton2">Next</button>
                  </div>
                </div>
              </div>
            </form>
            <form class="form-group mt-3 form-step" id="form3" style="display: none;">
              <div class="row ml-1 mb-3">
                <h3>BR Specific</h3>
              </div>
              <div id="brfCurrentUser" style="display: none;">
                <div class="row ml-1 mb-3">
                  <label for="boxNo" class="col-sm-2 mb-1 col-form-label">Data Entry By </label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="brfdataEB" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="age@menarche" class="col-sm-2 mb-1 col-form-label">Age at Menarche</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="8" max="30" id="ageAtMenarche" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="parity" class="col-sm-2 mb-1 col-form-label">Parity</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="15" id="parity" name="parity" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="noChild" style="display: none;">
                <label for="noChild" class="col-sm-2 mb-1 col-form-label">Number of Children</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="15" id="numChild" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="ageFC" style="display: none;">
                <label for="ageFC" class="col-sm-2 mb-1 col-form-label">Age at First Child</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="10" max="60" id="ageAtFirstChild" class="form-control" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3" id="breFd" style="display: none;">
                <label for="breFd" class="col-sm-2 mb-1 col-form-label">Breastfed</label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="breFdYes" name="breFd" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="breFdYes">Yes</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="breFdNo" name="breFd" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="breFdNo">No</label>
                  </div>
                </div>
              </div>
              <div class="row ml-1 mb-3" id="durFeed" style="display: none;">
                <label for="durFeed" class="col-sm-2 mb-1 col-form-label">Duration of Breast Feeding</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="dbf" placeholder="">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="mStatus" class="col-sm-2 mb-1 col-form-label">Menopausal Status</label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="mStatusPre" name="mStatus" class="custom-control-input"
                      value="Pre Menopausal">
                    <label class="custom-control-label" for="mStatusPre">Pre Menopausal</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="mStatusPost" name="mStatus" class="custom-control-input"
                      value="Post Menopausal">
                    <label class="custom-control-label" for="mStatusPost">Post Menopausal</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="mStatusHyster" name="mStatus" class="custom-control-input"
                      value="Hysterectomy">
                    <label class="custom-control-label" for="mStatusHyster">Hysterectomy</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-mStatus">
                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="age@Diagon" class="col-sm-2 mb-1 col-form-label">Age at Diagnosis</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" min="0" max="100" id="ad" class="form-control" placeholder="">
                </div>
              </div> -->
              <div class="row ml-1 mb-3">
                <label for="ER" class="col-sm-2 mb-1 col-form-label">ER</label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ERPos" name="ERRadio" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="ERPos">Positive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="ERNev" name="ERRadio" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="ERNev">Negative</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-ERRadio">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="PR" class="col-sm-2 mb-1 col-form-label">PR</label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PRPos" name="PRRadio" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="PRPos">Positive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="PRNev" name="PRRadio" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="PRNev">Negative</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-PRRadio">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="HER2" class="col-sm-2 mb-1 col-form-label">HER2</label>
                <div class="col-sm-9 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="HER2Pos" name="HER2Radio" class="custom-control-input" value=true>
                    <label class="custom-control-label" for="HER2Pos">Positive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="HER2Nev" name="HER2Radio" class="custom-control-input" value=false>
                    <label class="custom-control-label" for="HER2Nev">Negative</label>
                  </div>
                </div>
                <div class="col-sm-1 mt-2 erase-icon-container-HER2Radio">
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="subType" class="col-sm-2 mb-1 col-form-label">Subtype</label>
                <div class="col-sm-10 mt-2">
                  <select id="sbt" class="form-control">
                    <option value="">Select</option>
                    <option value="HR positive">HR Positive</option>
                    <option value="Her2 enriched">Her2 enriched</option>
                    <option value="Triple positive">Triple positive</option>
                    <option value="TNBC">TNBC</option>
                  </select>
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label for="ki" class="col-sm-2 mb-1 col-form-label">Ki67</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" class="form-control" id="k67" placeholder="Percentage %">
                </div>
              </div>
              <!-- <div class="row ml-1 mb-3">
                <label for="ClinicalS" class="col-sm-2 mb-1 col-form-label">Clinical Stage</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="ClinicalS" placeholder="">
                </div>
              </div> -->
              <!-- <div class="row ml-1 mb-3">
                <label for="histo_t" class="col-sm-2 mb-1 col-form-label">Histological Stage</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="HistologicalS" placeholder="">
                </div>
              </div> -->
              <div class="row ml-1 mb-3">
                <label for="histo_t" class="col-sm-2 mb-1 col-form-label">BIRADS score</label>
                <div class="col-sm-10">
                  <select id="HistologicalS" class="form-control">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="4A">4A</option>
                    <option value="4B">4B</option>
                    <option value="4C">4C</option>
                    <option value="5">5</option>
                    <option value="6">6</option>

                  </select>
                </div>
              </div>
              <div class="row ml-1 mb-3">
                <label for="stils" class="col-sm-2 mb-1 col-form-label">sTILs Percent Scores</label>
                <div class="col-sm-10 mt-2">
                  <input type="number" class="form-control" id="sps" placeholder="Percentage %">
                </div>
              </div>

              <div class="col-12">
                <div class="row" style="justify-content: space-around;">
                  <div class="col-4 mt-6" style="text-align: center;">
                    <button type="button" class="btn btn-primary btn-xs btn-prev" id="backButton2">Back</button>
                  </div>
                  <!-- <div class="col-4 mt-6" id style="text-align: center; display: flex; justify-content: space-around;" >
                  </div> -->
                  <div class="col-4 mt-6" style="text-align: center; display: flex; justify-content: space-around;">
                    <button type="button" class="btn btn-success btn-xs" id="finishButton">Finish</button>

                    <button type="button" class="btn btn-success btn-xs" id="submitButton">Submit</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <!-- Submit Button -->
        </div>

        <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
          <form class="form-group mt-3">
            <div class="form-check pl-2">
              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold" for="">Last Followup status <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDisease"
                      value="DiseaseF">
                    <label class="custom-control-label" for="radioDisease">Disease Free</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioRecurrence"
                      value="Recurrence">
                    <label class="custom-control-label" for="radioRecurrence">Recurrence</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDiseasePro"
                      value="diseasePro">
                    <label class="custom-control-label" for="radioDiseasePro">Disease Progressive</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDeath_Disease"
                      value="death_Dise">
                    <label class="custom-control-label" for="radioDeath_Disease">Death due to disease</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioLost"
                      value="Lost_Follow">
                    <label class="custom-control-label" for="radioLost">Lost to Follow up</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioDeath_n_Disease"
                      value="death_n_Dise">
                    <label class="custom-control-label" for="radioDeath_n_Disease">Death not due to disease</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioRemission"
                      value="remission">
                    <label class="custom-control-label" for="radioRemission">Remission</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input class="custom-control-input" type="radio" name="flexRadioDefault" id="radioOther"
                      value="Other">
                    <label class="custom-control-label" for="radioOther">Other</label>
                  </div>
                </div>
              </div>



              <div class="row ml-1 mb-3" id="otherText" style="display: none;">
                <label class="col-sm-2 col-form-label Bold">Other reason</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="otherR" placeholder="Other reason">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold" for="startInputFollow">Last Follow up Date</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="startInputFollow" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="lostFollowUpID" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="reason">Reason For lost to follow up</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="lostFollowUp" placeholder="Reason">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="recurID" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="recurrenceDate">Recurrence Date</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="recurrenceDate" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="proDisID" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="reportedDate">Reported Date for Progressive
                  Disease</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="reportedDate" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3" id="pmr" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="remark">Progression metastasis remark</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" id="PET" placeholder="Remark">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold">Vital Status <span
                    style="color: red; font-weight: bold;">*</span></label>
                <div class="col-sm-10 mt-2">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" name="livestatus" id="radioAlive" value="Alive">
                    <label class="custom-control-label" for="radioAlive">Alive</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" name="livestatus" id="radioDead" value="Dead">
                    <label class="custom-control-label" for="radioDead">Dead</label>
                  </div>
                </div>
              </div>

              <div class="row ml-1 mb-3" id="deathDateContainer" style="display: none;">
                <label class="col-sm-2 col-form-label Bold" for="deathDate">Death Date</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" id="deathDate" class="form-control" placeholder="Select Date">
                </div>
              </div>

              <div class="row ml-1 mb-3">
                <label class="col-sm-2 col-form-label Bold" for="remark">Remark</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control" placeholder="Remark" id="remark">
                </div>
              </div>

              <div class="row " style="text-align: center;">
                <div class="col-sm-12">
                  <button type="button" class="btn btn-success" id="subFollowUp"
                    onclick="submitFollowup()">Submit</button>
                  <!-- Function call here -->
                </div>
              </div>
            </div>
          </form>
        </div>


        <div class="tab-pane fade" id="tab3" role="tabpanel" aria-labelledby="tab3-tab">
          <div class="card" id="sharedCard" style="display: none;">
            <!-- <div class="card-header" style="text-align: center;">
              Featured
            </div> -->
            <div class="card-container">
              <!-- Cards will be dynamically inserted here -->
            </div>
          </div>



          <form class="form-group mt-3" id="shareForm" style="display: block;">
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Date <span
                  style="color: red; font-weight: bold;">*</span></label>
              <div class="col-sm-10 mt-2">
                <input type="text" id="startInputOutsource" class="form-control" placeholder="Select Date">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Institute /
                Department <span style="color: red; font-weight: bold;">*</span></label>
              <div class="col-sm-10 mt-2">
                <input type="text" class="form-control " placeholder="Name of the Institite / Department"
                  id="institute">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Project <span
                  style="color: red; font-weight: bold;">*</span> </label>
              <div class="col-sm-10 mt-2">
                <input type="text" class="form-control " placeholder="Name the project" id="projectName">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">PI of the Project</label>
              <div class="col-sm-10 mt-2">
                <input type="text" class="form-control " placeholder="Name of PI" id="nopi">
              </div>
            </div>
            <div class="row ml-1 mb-3">
              <label class="col-sm-2 col-form-label Bold">Shared Status <span
                  style="color: red; font-weight: bold;">*</span></label>
              <div class="col-sm-10 mt-2">
                <div class="custom-control custom-radio custom-control-inline">
                  <input class="custom-control-input" type="radio" name="sharestatus" id="radioPartial" value="ps">
                  <label class="custom-control-label" for="radioPartial">Partial</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input class="custom-control-input" type="radio" name="sharestatus" id="radioFull" value="s">
                  <label class="custom-control-label" for="radioFull">Complete</label>
                </div>
              </div>
            </div>
            <div id="partialSamples" style="display: none;">
              <div class="row ml-1 mb-3">
                <label for="startInput" class="col-sm-2 mb-1 col-form-label col-form-label Bold">Partial shared
                  remark</label>
                <div class="col-sm-10 mt-2">
                  <input type="text" class="form-control " placeholder="" id="parSharedRemark">
                </div>
              </div>
            </div>


            <div id="sharedSampleBox" style="display: none;">
              <div class="row ml-1 mb-3">
                <label for="sharedSampleBox" class="col-sm-2 mb-1 col-form-label">Grid No.</label>
                <div class="col-sm-10 mt-2">
                  <input type="button" class="form-control" id="sharedSample" onclick="popSharedmodal()"
                    placeholder="Shared Grid Box">
                </div>
              </div>
            </div>
            <div class="col mt-4" style="text-align: center;" id="backToCardBtn">
              <button type="button" class="btn btn-primary" onclick="goToTimestampCard()">Back</button>
            </div>
            <div class="col mt-4" style="text-align: center;" id="shareSubmit">
              <button type="submit" class="btn btn-success">Submit</button>
            </div>
          </form>

        </div>
      </div>
    </div>

    <div class="modal fade  bd-example-modal-lg" id="bloodModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="currBloodBoxName"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="blood-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="continuePage" onclick="handleDone()">Done</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade  bd-example-modal-lg" id="rltModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="currRLTBoxName"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="RLT-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="R1" />
                </div>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="continuePage" onclick="handleDone()">Done</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade  bd-example-modal-lg" id="pcModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="currPcBoxName"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="PC-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="R1" />
                </div>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="continuePage" onclick="handleDone()">Done</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade bd-example-modal-lg" id="specimenModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="currSpecimenBoxName"></span> </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="seat-info">
              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="specimen-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="P1" />
                </div>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="continuePage" onclick="handleDone()">Done</button>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade  bd-example-modal-lg" id="sharedBloodModal" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="cursharedBloodBox"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="shared-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade  bd-example-modal-lg" id="sharedSpecimenModal" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="cursharedSpecimenBox"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="shared-s-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade  bd-example-modal-lg" id="sharedRLTModal" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="cursharedRLTBox"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="shared-r-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade  bd-example-modal-lg" id="sharedPCModal" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"><span id="cursharedPCBox"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>

          </div>


          <div class="modal-body">
            <form id="seat-info">

              <div id="blood-box-container" class="seats" style="padding:0px 70px 0px 70px;">
                <div class="shared-p-box" id="box-1">
                  <div class="status" style="margin-bottom: 10px;">
                    <div class="item">Empty</div>
                    <div class="item">Occupied</div>
                    <div class="item">Outsource</div>
                  </div>
                  <input type="checkbox" name="bio_box" id="S1" />
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>
  </div>







  <footer id="footer" style="margin-top: 10px;">
    <div class="container footer-bottom clearfix">
      <div class="copyright">
        &copy; Copyright <strong><span></span></strong>. All Rights Reserved
      </div>
      <div class="credits">

      </div>
      <div class="version" style="float: right; font-size: 12px; color: rgb(255, 255, 255);">
        Version 1.5.7
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>


  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <!-- Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>



  <script>

    if (!sessionStorage.getItem('isLoggedIn') || sessionStorage.getItem('isLoggedIn') !== 'true') {
      window.location.href = "login.html";
    }

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database(app);

    localStorage.removeItem('selectedGrid');
    localStorage.removeItem("selectedSGrid");
    localStorage.removeItem("LocalPlasma")
    localStorage.removeItem("LocalSerum")
    localStorage.removeItem("LocalBuffy")
    localStorage.removeItem("LocalOther")
    localStorage.removeItem("LocalFT");
    localStorage.removeItem("LocalFN");
    localStorage.removeItem("LocalRltGrid");
    localStorage.removeItem("rltSelectedGrid");
    localStorage.removeItem("LocalPC");
    localStorage.removeItem("pcSelectedGrid");


    const referrer = document.referrer;
    const bread2 = document.getElementById('bread2');
    const sampleInputTab = document.getElementById('tab1-tab');
    const followUpTab = document.getElementById('tab2-tab');
    const sharedTab = document.getElementById('tab3-tab');

    const urlParams = new URLSearchParams(window.location.search);
    const hideMnrId = urlParams.get('hideMnrId');
    const shared = urlParams.get('shared');
    const mode = urlParams.get('mode');

    console.log("shared", shared);

    if (referrer.includes('home.html')) {
      if (shared === "true") {
        bread2.innerHTML = '<a href="search.html">Search</a>';
        sharedTab.click();
      }
      else {
        bread2.innerHTML = '<a href="home.html">Home</a>';
        sampleInputTab.click();
      }
    }
    else if (referrer.includes('search.html')) {
      if (shared === "true") {
        bread2.innerHTML = '<a href="search.html">Search</a>';
        sharedTab.click();
      } else {
        bread2.innerHTML = '<a href="search.html">Search</a>';
        sampleInputTab.click();
      }

      const inputs = document.querySelectorAll('input');
      inputs.forEach(input => {
        if (input.type === 'text' || input.type === 'textarea') {
          input.value = '';
        } else if (input.type === 'radio') {
          input.checked = false;
        }
      });

      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        select.selectedIndex = 0;
      });
    }

    if (referrer.includes('todo.html')) {
      if (mode === 'view' || mode === 'edit') {
        bread2.innerHTML = '<a href="todo.html">To-Do</a>';
        followUpTab.click();
      }
      else {
        bread2.innerHTML = '<a href="todo.html">To-Do</a>';
        sampleInputTab.click();
      }
    }


    if (hideMnrId === 'true') {
      const mnrIdElement = document.getElementById('mnrId');
      if (mnrIdElement) {
        mnrIdElement.style.display = 'none';
      }
    }


    let storedMrn = localStorage.getItem('MRN');
    let storeBio = localStorage.getItem("BioVal");
    if (storedMrn) {
      document.getElementById('mrnNo').value = storedMrn;
    }
    if (storeBio) {
      document.getElementById('bioBankId').value = storeBio;
    }

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById("sampleEntry1").addEventListener("click", function () {
        validateAndCollectData();
        console.log("Saved to Firebase!")
      });
    });

    document.getElementById('submitButton').addEventListener('click', function () {
      validateAndCollectData();
    });

    document.getElementById('finishButton').addEventListener('click', function () {
      window.location.href = 'home.html';
    });

    function logout() {
      sessionStorage.removeItem('isLoggedIn');
      sessionStorage.removeItem('userName');
      window.location.href = 'login.html';
    }

  </script>
  <script>
    let BloodSelectedSeats = [];
    let SpecimenSelectedSeats = [];




    let grid = '';

    let spgrid = '';

    let rltgrid = '';

    let pcgrid = '';

    let arr = [];

    let arrinx = [];

    let arrS = [];

    let arrSinx = [];

    let arrR = [];

    let arrRinx = [];

    let arrP = [];

    let arrPinx = [];

    function plasmaModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("bloodVStatus")
      console.log("sts bloodVStatus", sts)
      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || ((mode === 'SearchEdit') && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("PlasmagridNo").value !== '') {
          popVPlasmaModal()
        }
      }
      else {
        popPlasmamodal()
      }
    }

    function serumModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("bloodVStatus")
      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("SerumgridNo").value !== '') {
          popVSerumModal()
        }
      }
      else {
        popSerummodal()
      }
    }

    function buffyModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("bloodVStatus")

      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("bufferCoatgridNo").value !== '') {
          popVBufferModal()
        }
      }
      else {
        popBuffermodal()
      }
    }

    function OSModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("otherVStatus")

      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("OSgridNo").value !== '') {
          popVOtherSampleModal()
        }
      }
      else {
        popOtherSamplemodal()
      }
    }

    function rltSModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("rltVStatus")

      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("rltSgridNo").value !== '') {
          popVrltSModal()
        }
      }
      else {
        poprltSModal()
      }
    }


    function pcSModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("pcVStatus")

      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("pcSgridNo").value !== '') {
          popVpcSModal()
        }
      }
      else {
        poppcSModal()
      }
    }

    function FTModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("specimenVStatus")

      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("ftgrid").value !== '') {
          popVFTmodal()
        }
      }
      else {
        popFTmodal()
      }
    }

    function FNModal() {
      let mode = localStorage.getItem('mode');
      let sts = localStorage.getItem("specimenVStatus")

      if (mode === 'SearchView' || (mode === 'PendingEdit' && (sts === "true")) || (mode === 'SearchEdit' && (sts === "true")) || mode === 'PendingView' || mode === 'ViewFollowUp' || mode === 'SharedView') {
        if (document.getElementById("fngrid").value !== '') {
          popVFNmodal()
        }
      }
      else {
        popFNmodal()
      }
    }



    function splitStringToArray(grid) {
      const data = [...new Set(grid.split(',').map(item => item.trim()))];
      console.log("data", data);
      return data;
    }

    function removeItemFromArray(arr, itemToRemove) {
      // Filter out the item to remove from the array
      return arr.filter(item => item !== itemToRemove);
    }

    function splitRLTStringToArray(grid) {
      const rltGdata = [...new Set(grid.split(',').map(item => item.trim()))];
      console.log("rltGdata", rltGdata);
      return rltGdata;
    }

    function removeRLTItemFromArray(arrR, itemToRemove) {
      // Filter out the item to remove from the array
      return arrR.filter(item => item !== itemToRemove);
    }

    function splitPCStringToArray(pcgrid) {
      const PCGdata = [...new Set(pcgrid.split(',').map(item => item.trim()))];
      console.log("PCGdata", PCGdata);
      return PCGdata;
    }

    function removePCItemFromArray(arrP, itemToRemove) {
      // Filter out the item to remove from the array
      return arrP.filter(item => item !== itemToRemove);
    }

    function popVPlasmaModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const plasmaBoxName = document.getElementById("PlasmagridNo").value;
        const boxname = plasmaBoxName.split('/')[0];
        const gridSample = plasmaBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());
        let activeBoxEntry = [];
        let box_id = [];
        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currBloodBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_B${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });

        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }

    }


    function popPlasmamodal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        let BloodSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }
        let plisteners = true;
        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data in Plasma:", grid);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];
        console.log("activeBoxEntry", activeBoxEntry)
        // console.log("filteredSeats", filteredSeats)
        let psData = document.getElementById("PlasmagridNo").value;

        console.log("psData", psData);
        if (psData.length !== 0) {
          if (localStorage.getItem('LocalPlasma') !== null) {
            psGridData = psData.split('/')[1];
            console.log("psGridData", psGridData)

            let ld = psGridData + "," + localStorage.getItem('LocalPlasma')

            localStorage.setItem('LocalPlasma', ld);
            console.log("FN Data from if", localStorage.getItem('LocalPlasma'))
          } else {
            psGridData = psData.split('/')[1];
            console.log("psGridData", psGridData)

            //let ld = psGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalPlasma', psGridData);
            console.log("Plasma Data from else", localStorage.getItem('LocalPlasma'))
          }
        }


        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currBloodBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        // document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }

        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }
        let removedgrid = false;



        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                if (plisteners) {
                  console.log(" ..... 1 .....", filteredSeats[12]);
                  console.log(" ..... 2 .....", indexedSeats[12]);

                  const rev = localStorage.getItem("LocalPlasma");
                  console.log(" ..... 4 .....", rev, `${removedgrid}`);
                  // if(removedgrid && !rev.includes(seatID)){
                  //   removedgrid=false;
                  //   event.target.checked = true;
                  //  // handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);
                  // } 
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }

                  console.log(" ..... 3 .....", event.target.checked);
                  // let labelsts = document.querySelector(`label[for="${seatID}"]`).check = true;

                  handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);

                }
              });

              let labelElement = document.getElementById(labelName);

              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${indexedSeats[index].sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                // if (seatID.includes(grid)) {
                //   console.log("seatID", seatID.includes(grid) + " seatID", seatID)
                // }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";

                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";

                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";

                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";

                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalPlasma");

          if (rev !== null) {
            let arr = splitStringToArray(rev);
            BloodSelectedSeats = arr;
          }
          console.log("inside handle seat in plasma .. ", seatID, status);

          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              console.log("Selection of empty Grid...")
              // Change the color of the seat to reflect its selection (e.g., #4d6335)
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            }
            else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          }
          else {
            let arr = splitStringToArray(grid);
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
                removedgrid = true;
                console.log("labelElement", labelElement)

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            } else {
              console.log("inside handle seat in plasma  else.. ", seatID, status);
              alert("Please select the empty boxes.")
            }
          }

          // Filter out any empty or null values from BloodSelectedSeats
          BloodSelectedSeats = [...new Set(BloodSelectedSeats.filter(item => item))];

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalPlasma", BloodSelectedSeats.join(','));  // Store as a comma-separated string
          updatePlasmaGridInput();
        }

        function updatePlasmaGridInput() {
          let gridInput = document.querySelector("input[placeholder='Plasma Grid']");

          // Remove null or empty values from BloodSelectedSeats
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats.join(',')); // Store as comma-separated string
          } else {
            // Remove any empty values from grid before updating
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid.concat(BloodSelectedSeats)).join(','));
          }

          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid);
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid);

          if (gridInput) {
            const box_name = boxName;
            // const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MPlasma" : "Plasma";
            const status = "Plasma";

            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updatePlasmaGridInput();
          }
          plisteners = false;
          $('#bloodModalCenter').modal('hide');
        };
      }
    }


    function popVSerumModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const plasmaBoxName = document.getElementById("SerumgridNo").value
        const boxname = plasmaBoxName.split('/')[0];
        console.log("box name", boxname);
        const gridSample = plasmaBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;

        let activeBoxEntry = [];
        let box_id = [];
        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currBloodBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_B${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });
        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }

    }

    function popSerummodal() {

      $('#bloodModalCenter').modal('show');
      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        let BloodSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }

        let slisteners = true;
        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data:", grid);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];


        let ssData = document.getElementById("SerumgridNo").value;

        console.log("ssData", ssData);
        if (ssData.length !== 0) {
          if (localStorage.getItem('LocalSerum') !== null) {
            ssGridData = ssData.split('/')[1];
            console.log("ssGridData", ssGridData)

            let ld = ssGridData + "," + localStorage.getItem('LocalSerum')

            localStorage.setItem('LocalSerum', ld);
            console.log("Serum Data from if", localStorage.getItem('LocalSerum'))
          } else {
            ssGridData = ssData.split('/')[1];
            console.log("ssGridData", ssGridData)

            //let ld = ssGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalSerum', ssGridData);
            console.log("Serum Data from else", localStorage.getItem('LocalSerum'))
          }
        }

        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currBloodBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        // document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }

        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }
        let removedgrid = false;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);


            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                if (slisteners) {
                  const rev = localStorage.getItem("LocalSerum")
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }

                  handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);
                }
              });

              let labelElement = document.getElementById(labelName);

              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalSerum")

          if (rev !== null) {
            let arr = splitStringToArray(rev)
            BloodSelectedSeats = arr;
          }
          console.log("rev : ", rev, " BloodSelectedSeats : ", BloodSelectedSeats)

          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            } else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          }
          else {
            let arr = splitStringToArray(grid)
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
                removedgrid = true;
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
            else {
              alert("Error clicking the filled component.");

            }
          }
          // BloodSelectedSeats = splitStringToArray(BloodSelectedSeats)
          BloodSelectedSeats = [...new Set(BloodSelectedSeats.filter(item => item))];

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalSerum", BloodSelectedSeats)
          updateSerumGridInput();
        }

        function updateSerumGridInput() {
          let gridInput = document.querySelector("input[placeholder='Serum Grid']");
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats.join(','));
          } else {
            //grid.push(BloodSelectedSeats)
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid.concat(BloodSelectedSeats)).join(','));
          }

          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid)
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid);

          if (gridInput) {
            const box_name = boxName;
            // const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MSerum" : "Serum";
            const status = "Serum";

            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updateSerumGridInput();
          }
          slisteners = false
          $('#bloodModalCenter').modal('hide');
        };
      }
    }

    // function splitStringToArray(grid) {
    //   const data = [ ...new Set(grid.split(',').map(item => item.trim()))];
    //   console.log("data ",data)
    //   return data;
    // }



    function popVBufferModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const buffyBoxName = document.getElementById("bufferCoatgridNo").value
        const boxname = buffyBoxName.split('/')[0];
        console.log("box name", boxname);
        const gridSample = buffyBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        let activeBoxEntry = [];
        let box_id = [];
        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currBloodBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_B${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });
        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }

    }

    function popBuffermodal() {

      $('#bloodModalCenter').modal('show');
      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        let BloodSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }

        let bcListeners = true
        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data:", grid);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];

        let bcsData = document.getElementById("bufferCoatgridNo").value;

        console.log("bcsData", bcsData);
        if (bcsData.length !== 0) {
          if (localStorage.getItem('LocalBuffy') !== null) {
            bcsGridData = bcsData.split('/')[1];
            console.log("bcsGridData", bcsGridData)

            let ld = bcsGridData + "," + localStorage.getItem('LocalBuffy')

            localStorage.setItem('LocalBuffy', ld);
            console.log("Buffy Coat Data from if", localStorage.getItem('LocalBuffy'))
          } else {
            bcsGridData = bcsData.split('/')[1];
            console.log("bcsGridData", bcsGridData)

            //let ld = bcsGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalBuffy', bcsGridData);
            console.log("Buffy Coat Data from else", localStorage.getItem('LocalBuffy'))
          }
        }

        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currBloodBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });

        // document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }

        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }
        let removedgrid = false;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('click', function (event) {
                if (bcListeners) {
                  const rev = localStorage.getItem("LocalBuffy");
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }

                  handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status, 'buffy Coat')
                }
              });

              let labelElement = document.getElementById(labelName);

              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status, debug) {
          const rev = localStorage.getItem("LocalBuffy");

          if (rev !== null) {
            let arr = splitStringToArray(rev)
            BloodSelectedSeats = arr;
          }
          console.log("rev : ", rev, " BloodSelectedSeats : ", BloodSelectedSeats)

          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            } else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          }
          else {
            let arr = splitStringToArray(grid)
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
                removedgrid = true;
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
            else {
              alert("Error clicking the filled component.");
            }
          }
          BloodSelectedSeats = [...new Set(BloodSelectedSeats.filter(item => item))];

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalBuffy", BloodSelectedSeats)
          updateBuffyGridInput();
        }
        function updateBuffyGridInput() {
          let gridInput = document.querySelector("input[placeholder='Buffer Grid']");
          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats.join(',')); // Store as comma-separated string
          } else {
            // Remove any empty values from grid before updating
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid.concat(BloodSelectedSeats)).join(','));
          }

          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid)
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid);

          if (gridInput) {
            const box_name = boxName;
            // const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MBuffy Coat" : "Buffy Coat";
            const status = "Buffy Coat";

            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updateBuffyGridInput();
          }
          bcListeners = false;
          $('#bloodModalCenter').modal('hide');
        };
      }
    }

    function popVOtherSampleModal() {
      $('#bloodModalCenter').modal('show');

      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const OSBoxName = document.getElementById("OSgridNo").value
        const boxname = OSBoxName.split('/')[0];
        const gridSample = OSBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        let activeBoxEntry = [];
        let box_id = [];
        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currBloodBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_B${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });
        window.handleDone = function () {
          $('#bloodModalCenter').modal('hide');
        };
      }
    }

    function popOtherSamplemodal() {

      $('#bloodModalCenter').modal('show');
      fetchSeatDataFromDB('bb').then(seatData => {
        populateBSeats('blood-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateBSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        let BloodSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }

        let osListeners = true;
        grid = localStorage.getItem("selectedGrid");
        console.log("selected Grid Data:", grid);

        const [box_id, filteredSeats] = activeBoxEntry;
        console.log("Active Box Name:", box_id);
        let boxName = [];


        let osData = document.getElementById("OSgridNo").value;

        console.log("osData", osData);
        if (osData.length !== 0) {
          if (localStorage.getItem('LocalOther') !== null) {
            osGridData = osData.split('/')[1];
            console.log("osGridData", osGridData)

            let ld = osGridData + "," + localStorage.getItem('LocalOther')

            localStorage.setItem('LocalOther', ld);
            console.log("Other Data from if", localStorage.getItem('LocalOther'))
          } else {
            osGridData = osData.split('/')[1];
            console.log("osGridData", osGridData)

            //let ld = osGridData+","+localStorage.getItem('LocalOther')

            localStorage.setItem('LocalOther', osGridData);
            console.log("Other Data from else", localStorage.getItem('LocalOther'))
          }
        }

        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currBloodBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        // document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {

          let arr = splitStringToArray(grid);
          let arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }
        // Make sure indexedSeats is defined
        const indexedSeats = filteredSeats;
        console.log("indexedSeats", indexedSeats)
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;  // Stop further execution if no indexed seats are available
        }
        let removedgrid = false;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_B${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );

              document.getElementById(seatID).addEventListener('change', function (event) {
                if (osListeners) {
                  const rev = localStorage.getItem("LocalOther")
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }
                  handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);
                }
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${seat.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalOther")

          if (rev !== null) {
            let arr = splitStringToArray(rev)
            BloodSelectedSeats = arr;
          }

          console.log("rev : ", rev, " BloodSelectedSeats :", BloodSelectedSeats)
          const labelElement = document.querySelector(`label[for="${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              BloodSelectedSeats.push(seatID);
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            } else {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
          }
          else {
            let arr = splitStringToArray(grid)
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = BloodSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                BloodSelectedSeats.splice(seatIndex, 1);
                let arr = splitStringToArray(grid)
                arr = removeItemFromArray(arr, seatID);
                grid = arr.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
                removedgrid = true;
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
            else {
              alert("Error clicking the filled component.");
            }
          }

          BloodSelectedSeats = [...new Set(BloodSelectedSeats.filter(item => item))];

          console.log("Selected seats:", BloodSelectedSeats);
          localStorage.setItem("LocalOther", BloodSelectedSeats)
          updateOtherGridInput();
        }

        function updateOtherGridInput() {
          let gridInput = document.querySelector("input[placeholder='Other Sample Grid']");

          BloodSelectedSeats = BloodSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("selectedGrid", BloodSelectedSeats.join(',')); // Store as comma-separated string
          } else {
            // Remove any empty values from grid before updating
            grid = splitStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("selectedGrid", (grid.concat(BloodSelectedSeats)).join(','));
          }


          console.log("Data check in handle", localStorage.getItem("selectedGrid"), "grid", grid)
          grid = localStorage.getItem("selectedGrid");
          splitStringToArray(grid)
          if (gridInput) {
            const box_name = boxName;
            // const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MOther" : "Other";
            const status = "Other";

            const grid_id = BloodSelectedSeats.join(', ');
            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {
          if (BloodSelectedSeats.length > 0) {
            updateOtherGridInput();
          }
          osListeners = false;
          $('#bloodModalCenter').modal('hide');
        };
      }
    }




    function splitSpecimenStringToArray(spgrid) {
      const Sdata = [...new Set(spgrid.split(',').map(item => item.trim()))];
      console.log("Sdata", Sdata);
      return Sdata;
    }

    function removeItemFromSpecimenArray(arrS, itemToRemove) {
      return arrS.filter(item => item !== itemToRemove);
    }

    window.onload = function () {
      // Clear the selected specimen grid data on page reload
      localStorage.removeItem("selectedSGrid");
      localStorage.removeItem("LocalPlasma");
      localStorage.removeItem("LocalSerum");
      localStorage.removeItem("LocalBuffy");
      localStorage.removeItem("LocalOther");

    };


    function popVFTmodal() {
      $('#specimenModalCenter').modal('show');

      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'ft');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const FTBoxName = document.getElementById("ftgrid").value
        const boxname = FTBoxName.split('/')[0];
        const gridSample = FTBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        let activeBoxEntry = [];
        let box_id = [];

        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currSpecimenBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_S${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });
        window.handleDone = function () {
          $('#specimenModalCenter').modal('hide');
        };
      }
    }

    function popFTmodal() {
      console.log("inside model display testing ... ");

      $('#specimenModalCenter').modal('show');
      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'ft');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;
        let ftListener = true;
        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }

        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        };
        let ftData = document.getElementById("ftgrid").value;

        console.log("ftData", ftData);
        if (ftData.length !== 0) {
          if (localStorage.getItem('LocalFT') !== null) {
            ftGridData = ftData.split('/')[1];
            console.log("ftGridData", ftGridData)

            let ld = ftGridData + "," + localStorage.getItem('LocalFT')

            localStorage.setItem('LocalFT', ld);
            console.log("FT Data from if", localStorage.getItem('LocalFT'))
          } else {
            ftGridData = ftData.split('/')[1];
            console.log("ftGridData", ftGridData)

            localStorage.setItem('LocalFT', ftGridData);
            console.log("FT Data from else", localStorage.getItem('LocalFT'))
          }
        }

        let spgrid = localStorage.getItem("selectedSGrid");
        const maxSelectionsFT = parseInt(document.getElementById('ft_tubes').value, 10);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];
        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currSpecimenBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        // document.getElementById('currSpecimenBoxName').textContent = activeBoxName;
        console.log("spgrid -- ", spgrid);
        if (spgrid !== null) {
          let arrS = splitSpecimenStringToArray(spgrid);
          let arrSinx = [];
          console.log(" arrS = ", arrS);
          arrS.forEach(item => arrSinx.push(getSeatIndex(item)));

          arrSinx.forEach(item => {
            filteredSeats[item] = stsInx;
          });
        }
        console.log("filteredSeats --- ", filteredSeats);

        const indexedSeats = filteredSeats;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_S${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seatData = indexedSeats[index];

            if (seatData) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );



              document.getElementById(seatID).addEventListener('click', function (event) {
                console.log("FT grid Check----", maxSelectionsFT, seatID)
                if (ftListener) {
                  if (maxSelectionsFT > 0) {
                    const rev = localStorage.getItem("LocalFT")
                    if (rev !== null) {
                      if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                        event.target.checked = false;
                      } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                        event.target.checked = true;
                      }
                    } else {
                      if (indexedSeats[index].status === "o") {
                        event.target.checked = false;
                      } else if (indexedSeats[index].status === "e") {
                        event.target.checked = true;
                      }
                    }

                    handleSSeatSelection(seatID, event.target.checked, indexedSeats[index].status, maxSelectionsFT, 'FT Grid');
                  } else {
                    alert("Please select no of FT Tubes");
                  }
                }
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${seatData.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleSSeatSelection(seatID, isChecked, status, maxSelectionsFT, debug) {

          const rev = localStorage.getItem("LocalFT");

          if (rev !== null) {
            let arrS = splitSpecimenStringToArray(rev);
            SpecimenSelectedSeats = arrS.filter(item => item);  // Filter out falsy values
          }

          console.log("rev : ", rev, " SpecimenSelectedSeats : ", SpecimenSelectedSeats);
          // const labelElement = document.querySelector(`label[for="${seatID}"]`);
          const labelElement = document.querySelector(`label[id="label_S${seatID}"]`);

          console.log("label Element in the FT Grid Selection", labelElement)

          if (status === 'e') {
            if (isChecked) {
              if (SpecimenSelectedSeats.length < maxSelectionsFT) {
                SpecimenSelectedSeats.push(seatID);
                if (labelElement) labelElement.style.backgroundColor = '#4d6335';
              } else {
                //document.getElementById(seatID).checked = false;
                alert(`You can select a maximum of ${maxSelectionsFT} seats.`);
              }
            } else {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
          }
          else {
            let arr = splitSpecimenStringToArray(spgrid);
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            } else {
              alert("Error clicking the filled component.");
            }
          }

          console.log("Selected seats:", SpecimenSelectedSeats);
          localStorage.setItem("LocalFT", SpecimenSelectedSeats.filter(item => item).join(','));  // Filter out falsy values
          updateFTGridInput();
        }

        function updateFTGridInput() {
          let gridInput = document.querySelector("input[placeholder='FT Grid No.']");

          SpecimenSelectedSeats = SpecimenSelectedSeats.filter(item => item);  // Filter out falsy values

          if (spgrid === null) {
            localStorage.setItem("selectedSGrid", SpecimenSelectedSeats.join(','));
          } else {
            spgrid = splitSpecimenStringToArray(spgrid).filter(item => item);  // Filter out falsy values
            localStorage.setItem("selectedSGrid", (spgrid.concat(SpecimenSelectedSeats)).join(','));
          }

          spgrid = localStorage.getItem("selectedSGrid");
          splitSpecimenStringToArray(spgrid);

          if (gridInput) {
            const box_name = boxName;
            let ftStatuses = [];

            for (let i = 1; i <= SpecimenSelectedSeats.length; i++) {
              // if (document.querySelector('input[name="MetastasisSample"]:checked').value === "true") {
              //   ftStatuses.push(`MFT-${i}`);
              // } else {
              ftStatuses.push(`FT-${i}`);
              // }
            }

            const grid_id = SpecimenSelectedSeats.join(', ');
            const status = ftStatuses.join(', ');

            if (grid_id.length > 0) {
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {

          if (SpecimenSelectedSeats.length === maxSelectionsFT) {
            updateFTGridInput();
            ftListener = false;
            $('#specimenModalCenter').modal('hide');

          }
          else {
            alert(`Please select ${maxSelectionsFT} grids`)
          }
        };
      }
    }

    function popVFNmodal() {
      $('#specimenModalCenter').modal('show');

      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'ft');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const FNBoxName = document.getElementById("fngrid").value
        const boxname = FNBoxName.split('/')[0];
        const gridSample = FNBoxName.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        let activeBoxEntry = [];
        let box_id = [];

        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currSpecimenBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_S${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          }); window.handleDone = function () {
            $('#specimenModalCenter').modal('hide');
          };
      }
    }

    function popFNmodal() {

      $('#specimenModalCenter').modal('show');
      fetchSeatDataFromDB('sb').then(seatData => {
        populateSSeats('specimen-box', seatData, 'fn');
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateSSeats(containerClass, seatData, type) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';
        let SpecimenSelectedSeats = [];

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;
        let fnListener = true;
        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }

        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        };
        let fnData = document.getElementById("fngrid").value;

        console.log("fnData", fnData);
        if (fnData.length !== 0) {
          if (localStorage.getItem('LocalFN') !== null) {
            fnGridData = fnData.split('/')[1];
            console.log("fnGridData", fnGridData)

            let ld = fnGridData + "," + localStorage.getItem('LocalFN')

            localStorage.setItem('LocalFN', ld);
            console.log("FN Data from if", localStorage.getItem('LocalFN'))
          } else {
            fnGridData = fnData.split('/')[1];
            console.log("fnGridData", fnGridData)

            localStorage.setItem('LocalFN', fnGridData);
            console.log("FN Data from else", localStorage.getItem('LocalFN'))
          }
        }

        let spgrid = localStorage.getItem("selectedSGrid");
        const maxSelections = parseInt(document.getElementById('fn_tubes').value, 10);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];
        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currBloodBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        //document.getElementById('currSpecimenBoxName').textContent = activeBoxName;
        console.log("spgrid -- ", spgrid);
        if (spgrid !== null) {
          let arrS = splitSpecimenStringToArray(spgrid);
          let arrSinx = [];
          console.log(" arrS = ", arrS);
          arrS.forEach(item => arrSinx.push(getSeatIndex(item)));

          arrSinx.forEach(item => {
            filteredSeats[item] = stsInx;
          });
        }
        console.log("filteredSeats --- ", filteredSeats);

        const indexedSeats = filteredSeats;

        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_S${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seatData = indexedSeats[index];

            if (seatData) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );

              document.getElementById(seatID).addEventListener('change', function (event) {
                if (fnListener) {
                  const rev = localStorage.getItem("LocalFN")
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }
                  handleSSeatSelection(seatID, event.target.checked, indexedSeats[index].status, maxSelections, 'FN Grid');
                }
              });

              let labelElement = document.getElementById(labelName);
              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${seatData.sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";
                }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";
                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";
                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";
                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";
                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleSSeatSelection(seatID, isChecked, status, maxSelections, debug) {
          console.log("handleSSeatSelection", debug);
          const rev = localStorage.getItem("LocalFN")

          if (rev !== null) {
            let arr = splitSpecimenStringToArray(rev)
            SpecimenSelectedSeats = arr.filter(item => item);
          }

          //console.log("rev : ",rev," SpecimenSelectedSeats : ",SpecimenSelectedSeats)
          console.log(" maxSelections : ", maxSelections)
          const labelElement = document.querySelector(`label[id="label_S${seatID}"]`);
          console.log("label Element in the FN Grid Selection", labelElement)

          if (status === 'e') {
            if (isChecked) {
              if (SpecimenSelectedSeats.length < maxSelections) {
                SpecimenSelectedSeats.push(seatID);
                if (labelElement) labelElement.style.backgroundColor = '#4d6335';
              } else {
                console.log(`You can select a maximum of ${maxSelections} seats.`);

                alert(`You can select a maximum of ${maxSelections} seats.`);
              }
            } else {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
          } else {
            let arr = splitSpecimenStringToArray(spgrid)
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = SpecimenSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                SpecimenSelectedSeats.splice(seatIndex, 1);
                let arrS = splitSpecimenStringToArray(spgrid);
                arrS = removeItemFromSpecimenArray(arrS, seatID);
                spgrid = arrS.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            }
            else {
              alert("Error clicking the filled component.");
            }
          }

          console.log("Selected seats:", SpecimenSelectedSeats);
          localStorage.setItem("LocalFN", SpecimenSelectedSeats.filter(item => item).join(','));
          updateFNGridInput();
        }

        function updateFNGridInput() {
          let gridInput = document.querySelector("input[placeholder='FN Grid No.']");

          SpecimenSelectedSeats = SpecimenSelectedSeats.filter(item => item);  // Filter out falsy values

          if (spgrid === null) {
            localStorage.setItem("selectedSGrid", SpecimenSelectedSeats.join(','));
          } else {
            spgrid = splitSpecimenStringToArray(spgrid).filter(item => item);  // Filter out falsy values
            localStorage.setItem("selectedSGrid", (spgrid.concat(SpecimenSelectedSeats)).join(','));
          }

          spgrid = localStorage.getItem("selectedSGrid");
          splitSpecimenStringToArray(spgrid);

          if (gridInput) {
            const box_name = boxName;
            let fnStatuses = [];

            for (let i = 1; i <= SpecimenSelectedSeats.length; i++) {
              // if (document.querySelector('input[name="MetastasisSample"]:checked').value === "true") {
              //   fnStatuses.push(`MFN-${i}`);
              // } else {
              fnStatuses.push(`FN-${i}`);
              // }
            }

            const grid_id = SpecimenSelectedSeats.join(', ');
            const status = fnStatuses.join(', ');

            if (grid_id.length > 0) {  // Only update gridInput if grid_id is not empty
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';  // Clear the gridInput value if grid_id is empty
            }
          }
        }

        window.handleDone = function () {

          if (SpecimenSelectedSeats.length === maxSelections) {
            updateFNGridInput();
            fnListener = false;
            $('#specimenModalCenter').modal('hide');

          }
          else {
            alert(`Please select ${maxSelections} grids`)
          }
        };
      }
    }

    function popVrltSModal() {
      $('#rltModalCenter').modal('show');

      fetchSeatDataFromDB('rlt').then(seatData => {
        populateRSeats('RLT-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateRSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        let rsData = document.getElementById("rltSgridNo").value;
        const boxname = rsData.split('/')[0];
        const gridSample = rsData.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        let activeBoxEntry = [];
        let box_id = [];



        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currRLTBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_R${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });

        window.handleDone = function () {
          $('#rltModalCenter').modal('hide');
        };
      }
    }



    function poprltSModal() {
      $('#rltModalCenter').modal('show');

      fetchSeatDataFromDB('rlt').then(seatData => {
        populateRSeats('RLT-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateRSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        let rltSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }
        let rslisteners = true;
        grid = localStorage.getItem("rltSelectedGrid");
        console.log("selected Grid Data in Plasma:", grid);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];
        console.log("activeBoxEntry", activeBoxEntry)
        let rsData = document.getElementById("rltSgridNo").value;

        console.log("rsData", rsData);
        if (rsData.length !== 0) {
          if (localStorage.getItem('LocalRltGrid') !== null) {
            rsGridData = rsData.split('/')[1];
            let ld = rsGridData + "," + localStorage.getItem('LocalRltGrid')
            localStorage.setItem('LocalRltGrid', ld);
          } else {
            rsGridData = rsData.split('/')[1];
            console.log("rsGridData", rsGridData)
            localStorage.setItem('LocalRltGrid', rsGridData);
          }
        }


        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currRLTBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        // document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitRLTStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }

        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }
        let removedgrid = false;



        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_R${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                if (rslisteners) {
                  console.log(" ..... 1 .....", filteredSeats[12]);
                  console.log(" ..... 2 .....", indexedSeats[12]);

                  const rev = localStorage.getItem("LocalRltGrid");
                  console.log(" ..... 4 .....", rev, `${removedgrid}`);
                  // if(removedgrid && !rev.includes(seatID)){
                  //   removedgrid=false;
                  //   event.target.checked = true;
                  //  // handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);
                  // } 
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }

                  console.log(" ..... 3 .....", event.target.checked);
                  // let labelsts = document.querySelector(`label[for="${seatID}"]`).check = true;

                  handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);

                }
              });

              let labelElement = document.getElementById(labelName);

              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${indexedSeats[index].sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                // if (seatID.includes(grid)) {
                //   console.log("seatID", seatID.includes(grid) + " seatID", seatID)
                // }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";

                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";

                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";

                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";

                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalRltGrid");

          if (rev !== null) {
            let arr = splitRLTStringToArray(rev);
            rltSelectedSeats = arr;
          }
          console.log("inside handle seat in plasma .. ", seatID, status);

          const labelElement = document.querySelector(`label[ id="label_R${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              rltSelectedSeats.push(seatID);
              console.log("Selection of empty Grid...")
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            }
            else {
              let seatIndex = rltSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                rltSelectedSeats.splice(seatIndex, 1);
                let arr = splitRLTStringToArray(grid)
                arr = removeRLTItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          }
          else {
            let arr = splitRLTStringToArray(grid);
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = rltSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                rltSelectedSeats.splice(seatIndex, 1);
                arr = removeRLTItemFromArray(arr, seatID);
                grid = arr.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
                removedgrid = true;
                console.log("labelElement", labelElement)

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            } else {
              console.log("inside handle seat in plasma  else.. ", seatID, status);
              alert("Please select the empty boxes.")
            }
          }

          rltSelectedSeats = [...new Set(rltSelectedSeats.filter(item => item))];

          console.log("Selected seats:", rltSelectedSeats);
          localStorage.setItem("LocalRltGrid", rltSelectedSeats.join(','));  // Store as a comma-separated string
          updateRLTGridInput();
        }

        function updateRLTGridInput() {
          let gridInput = document.querySelector("input[placeholder='RLT Sample Grid']");

          rltSelectedSeats = rltSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("rltSelectedGrid", rltSelectedSeats.join(',')); // Store as comma-separated string
          } else {
            // Remove any empty values from grid before updating
            grid = splitRLTStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("rltSelectedGrid", (grid.concat(rltSelectedSeats)).join(','));
          }

          console.log("Data check in handle", localStorage.getItem("rltSelectedGrid"), "grid", grid);
          grid = localStorage.getItem("rltSelectedGrid");
          splitRLTStringToArray(grid);

          if (gridInput) {
            const box_name = boxName;
            // const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MPlasma" : "Plasma";
            const status = "RLT";

            const grid_id = rltSelectedSeats.join(', ');
            if (grid_id.length > 0) {
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';
            }
          }
        }

        window.handleDone = function () {
          if (rltSelectedSeats.length > 0) {
            updateRLTGridInput();
          }
          rslisteners = false;
          $('#rltModalCenter').modal('hide');
        };
      }
    }


    function popVpcSModal() {
      $('#pcModalCenter').modal('show');

      fetchSeatDataFromDB('pcb').then(seatData => {
        populateRSeats('PC-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populateRSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        let pcsData = document.getElementById("pcSgridNo").value;
        const boxname = pcsData.split('/')[0];
        const gridSample = pcsData.split('/')[1];
        const gridSamples = gridSample.split(',').map(sample => sample.trim());;
        let activeBoxEntry = [];
        let box_id = [];



        db.ref('bn/').once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              const boxIDs = snapshot.val();

              bioInfo = Object.entries(boxIDs).find(([bio_id, boxData]) => boxData === boxname);
              const [id, boxData] = bioInfo;
              box_id = id;
              console.log("bioinfo", bioInfo)
              console.log("box_id", box_id)


              console.log("box name", boxname);
              console.log("seatData", seatData);
              console.log("box box_id", box_id);


              activeBoxEntry = Object.entries(seatData).find(([boxid, data]) => boxid === box_id);


              if (!activeBoxEntry) {
                console.log("No active box found.");
                return;
              }
              const [boxid, filteredSeats] = activeBoxEntry;
              let boxName = [];
              console.log("Active Box Name:", boxid);
              const indexedSeats = filteredSeats;

              db.ref('bn/' + boxid).once('value')
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    boxName = snapshot.val();

                    console.log("Box Name for ID " + boxid + ": " + boxName);
                    document.getElementById('currPcBoxName').textContent = boxName;

                  } else {
                    console.log("No box found with ID " + boxid);
                  }
                  if (!indexedSeats) {
                    console.log("No indexed seats available in the active box.");
                    return;
                  }
                  for (let row = 0; row < rows.length; row++) {
                    for (let col = 1; col <= cols; col++) {
                      const labelName = `label_P${rows[row]}${col}`;
                      const seatID = `${rows[row]}${col}`;
                      const index = row * cols + (col - 1);

                      const seat = indexedSeats[index];

                      if (seat) {
                        container.insertAdjacentHTML(
                          "beforeend",
                          `<input type="checkbox" name="seats" id="${seatID}" />` +
                          `<label for="${seatID}" class="viewSeat" id="${labelName}">${labelName}</label>`
                        );

                        let labelElement = document.getElementById(labelName);
                        if (labelElement) {
                          if (seat.bioBankId !== '') {
                            labelElement.innerHTML = `${seat.bioBankId || ''}<br>${seat.sampleType || ''}`;
                            labelElement.style.fontWeight = "bolder";
                            labelElement.style.fontSize = "9px";
                            labelElement.style.textAlign = "center";
                            labelElement.style.color = 'white';
                          } else if (seat.bioBankId === '') {
                            labelElement.innerHTML = `${'-'}<br>`;
                            labelElement.style.color = "rgb(143, 218, 187)";
                            labelElement.style.textAlign = "center";
                          }

                          if (seat.status === "o") {
                            labelElement.style.background = "rgb(129, 129, 192)";
                          } else if (seat.status === "s") {
                            labelElement.style.background = "rgb(180, 180, 180)";
                          } else if (seat.status === "ps") {
                            labelElement.style.background = "rgb(193, 154, 107)";
                          } else if (seat.status === "e") {
                            labelElement.style.background = "rgb(143, 218, 187)";
                          }

                          if (gridSamples.includes(seatID)) {
                            labelElement.style.background = "#4d6335";
                          }
                        }
                      }
                    }
                    container.insertAdjacentHTML("beforeend", "<br/>");
                  }

                })


                .catch((error) => {
                  console.error("Error fetching box name for ID " + boxid + ": ", error);
                });

              // document.getElementById('currBloodBoxName').textContent = activeBoxName;

            } else {
              console.log("No boxes found in the database.");
            }
          })
          .catch((error) => {
            console.error("Error fetching box names:", error);
          });

        window.handleDone = function () {
          $('#pcModalCenter').modal('hide');
        };
      }
    }



    function poppcSModal() {
      $('#pcModalCenter').modal('show');

      fetchSeatDataFromDB('pcb').then(seatData => {
        populatePSeats('PC-box', seatData);
      });

      function fetchSeatDataFromDB(nodeName) {
        return new Promise((resolve, reject) => {
          let dbRef = firebase.database().ref(nodeName);
          dbRef.once('value')
            .then(snapshot => {
              let seatData = snapshot.val();
              resolve(seatData);
            })
            .catch(error => {
              console.error("Error fetching seat data:", error);
              reject(error);
            });
        });
      }

      function populatePSeats(containerClass, seatData) {
        let container = document.querySelector(`.${containerClass}`);
        container.innerHTML = '';

        const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
        const cols = 10;

        const activeBoxEntry = Object.entries(seatData).find(([box_id, data]) => data.bxsts === 'AC');
        let pcSelectedSeats = [];

        if (!activeBoxEntry) {
          console.error("No active box found with status 'AC'.");
          return;
        }
        const stsInx = {
          "bioBankId": "",
          "sampleType": "",
          "status": "o"
        }
        let pclisteners = true;
        grid = localStorage.getItem("pcSelectedGrid");
        console.log("selected Grid Data in Plasma:", grid);

        const [box_id, filteredSeats] = activeBoxEntry;
        let boxName = [];
        console.log("activeBoxEntry", activeBoxEntry)
        let psData = document.getElementById("pcSgridNo").value;

        console.log("psData", psData);
        if (psData.length !== 0) {
          if (localStorage.getItem('LocalPC') !== null) {
            psGridData = psData.split('/')[1];
            console.log("psGridData", psGridData)

            let ld = psGridData + "," + localStorage.getItem('LocalPC')

            localStorage.setItem('LocalPC', ld);
            console.log("FN Data from if", localStorage.getItem('LocalPC'))
          } else {
            psGridData = psData.split('/')[1];
            console.log("psGridData", psGridData)

            //let ld = psGridData+","+localStorage.getItem('LocalFN')

            localStorage.setItem('LocalPC', psGridData);
            console.log("Plasma Data from else", localStorage.getItem('LocalPC'))
          }
        }


        console.log("Active Box Name:", box_id);

        db.ref('bn/' + box_id).once('value')
          .then((snapshot) => {
            if (snapshot.exists()) {
              boxName = snapshot.val();

              console.log("Box Name for ID " + box_id + ": " + boxName);
              document.getElementById('currPcBoxName').textContent = boxName;

            } else {
              console.log("No box found with ID " + box_id);
            }
          })
          .catch((error) => {
            console.error("Error fetching box name for ID " + box_id + ": ", error);
          });
        // document.getElementById('currBloodBoxName').textContent = activeBoxName;
        if (grid !== null) {
          console.log("grid", grid)
          arr = splitPCStringToArray(grid);
          arrinx = [];
          arr.forEach(item => {

            arrinx.push(getSeatIndex(item))

          })

          arrinx.forEach(item => {
            // arrPinx[item]= stsInx;
            filteredSeats[item] = stsInx;
          })
          console.log("arrPinx", arrinx)
          console.log("filteredSeats", filteredSeats)
        }

        const indexedSeats = filteredSeats;
        if (!indexedSeats) {
          console.log("No indexed seats available in the active box.");
          return;
        }
        let removedgrid = false;



        for (let row = 0; row < rows.length; row++) {
          for (let col = 1; col <= cols; col++) {
            const labelName = `label_P${rows[row]}${col}`;
            const seatID = `${rows[row]}${col}`;
            const index = row * cols + (col - 1);

            const seat = indexedSeats[index];

            if (seat) {
              container.insertAdjacentHTML(
                "beforeend",
                `<input type="checkbox" name="seats" id="${seatID}" />` +
                `<label for="${seatID}" class="seat" id="${labelName}">${labelName}</label>`
              );
              document.getElementById(seatID).addEventListener('change', function (event) {
                if (pclisteners) {
                  console.log(" ..... 1 .....", filteredSeats[12]);
                  console.log(" ..... 2 .....", indexedSeats[12]);

                  const rev = localStorage.getItem("LocalPC");
                  console.log(" ..... 4 .....", rev, `${removedgrid}`);
                  // if(removedgrid && !rev.includes(seatID)){
                  //   removedgrid=false;
                  //   event.target.checked = true;
                  //  // handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);
                  // } 
                  if (rev !== null) {
                    if ((indexedSeats[index].status === "o") && rev.includes(seatID)) {
                      event.target.checked = false;
                    } else if ((indexedSeats[index].status === "e") && !rev.includes(seatID)) {
                      event.target.checked = true;
                    }
                  } else {
                    if (indexedSeats[index].status === "o") {
                      event.target.checked = false;
                    } else if (indexedSeats[index].status === "e") {
                      event.target.checked = true;
                    }
                  }

                  console.log(" ..... 3 .....", event.target.checked);
                  // let labelsts = document.querySelector(`label[for="${seatID}"]`).check = true;

                  handleBSeatSelection(seatID, event.target.checked, indexedSeats[index].status);

                }
              });

              let labelElement = document.getElementById(labelName);

              if (labelElement) {
                if (indexedSeats[index].bioBankId !== '') {
                  labelElement.innerHTML = `${indexedSeats[index].bioBankId || ''}<br>${indexedSeats[index].sampleType || ''}`;
                  labelElement.style.fontWeight = "bolder";
                  labelElement.style.fontSize = "9px";
                  labelElement.style.textAlign = "center";
                  labelElement.style.color = 'white';
                }
                else if (indexedSeats[index].bioBankId === '') {
                  labelElement.innerHTML = `${'-'}<br>`;
                  labelElement.style.color = "rgb(143, 218, 187)";
                  labelElement.style.textAlign = "center";

                }

                // if (seatID.includes(grid)) {
                //   console.log("seatID", seatID.includes(grid) + " seatID", seatID)
                // }

                if (indexedSeats[index].status === "o") {
                  labelElement.style.background = "rgb(129, 129, 192)";

                } else if (indexedSeats[index].status === "s") {
                  labelElement.style.background = "rgb(180, 180, 180)";

                } else if (indexedSeats[index].status === "ps") {
                  labelElement.style.background = "rgb(193, 154, 107)";

                } else if (indexedSeats[index].status === "e") {
                  labelElement.style.background = "rgb(143, 218, 187)";

                }
              }
            }
          }
          container.insertAdjacentHTML("beforeend", "<br/>");
        }

        function handleBSeatSelection(seatID, isChecked, status) {
          const rev = localStorage.getItem("LocalPC");

          if (rev !== null) {
            let arr = splitPCStringToArray(rev);
            pcSelectedSeats = arr;
          }
          console.log("inside handle seat in plasma .. ", seatID, status);

          const labelElement = document.querySelector(`label[ id="label_P${seatID}"]`);

          if (status === 'e') {
            if (isChecked) {
              pcSelectedSeats.push(seatID);
              console.log("Selection of empty Grid...")
              // Change the color of the seat to reflect its selection (e.g., #4d6335)
              if (labelElement) labelElement.style.backgroundColor = '#4d6335';
            }
            else {
              let seatIndex = pcSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                pcSelectedSeats.splice(seatIndex, 1);
                let arr = splitPCStringToArray(grid)
                arr = removePCItemFromArray(arr, seatID);
                grid = arr.join(',');

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';

            }
          }
          else {
            let arr = splitPCStringToArray(grid);
            if (status === 'o' && arr.includes(seatID) && rev.includes(seatID)) {
              let seatIndex = pcSelectedSeats.indexOf(seatID);
              if (seatIndex !== -1) {
                pcSelectedSeats.splice(seatIndex, 1);
                arr = removePCItemFromArray(arr, seatID);
                grid = arr.join(',');
                let alocc = getSeatIndex(seatID);
                const stsInxempty = {
                  "bioBankId": "",
                  "sampleType": "",
                  "status": "e"
                }
                console.log(" index seating before .... ", alocc, indexedSeats[alocc]);

                indexedSeats[alocc] = stsInxempty;
                filteredSeats[alocc] = stsInxempty;
                console.log(" index seating after .... ", alocc, indexedSeats[alocc]);
                removedgrid = true;
                console.log("labelElement", labelElement)

              }
              if (labelElement) labelElement.style.backgroundColor = 'rgb(143, 218, 187)';
            } else {
              console.log("inside handle seat in plasma  else.. ", seatID, status);
              alert("Please select the empty boxes.")
            }
          }

          // Filter out any empty or null values from pcSelectedSeats
          pcSelectedSeats = [...new Set(pcSelectedSeats.filter(item => item))];

          console.log("Selected seats:", pcSelectedSeats);
          localStorage.setItem("LocalPC", pcSelectedSeats.join(','));  // Store as a comma-separated string
          updatePCGridInput();
        }

        function updatePCGridInput() {
          let gridInput = document.querySelector("input[placeholder='PC Sample Grid']");

          // Remove null or empty values from pcSelectedSeats
          pcSelectedSeats = pcSelectedSeats.filter(item => item);

          if (grid === null) {
            localStorage.setItem("pcSelectedGrid", pcSelectedSeats.join(',')); // Store as comma-separated string
          } else {
            // Remove any empty values from grid before updating
            grid = splitPCStringToArray(grid).filter(item => item);  // Filter out null or empty values
            localStorage.setItem("pcSelectedGrid", (grid.concat(pcSelectedSeats)).join(','));
          }

          console.log("Data check in handle", localStorage.getItem("pcSelectedGrid"), "grid", grid);
          grid = localStorage.getItem("pcSelectedGrid");
          splitPCStringToArray(grid);

          if (gridInput) {
            const box_name = boxName;
            // const status = document.querySelector('input[name="MetastasisSample"]:checked') && document.querySelector('input[name="MetastasisSample"]:checked').value === "true" ? "MPlasma" : "Plasma";
            const status = "PC";

            const grid_id = pcSelectedSeats.join(', ');
            if (grid_id.length > 0) {
              gridInput.value = `${box_name}/${grid_id}/${status}`;
            } else {
              gridInput.value = '';
            }
          }
        }

        window.handleDone = function () {
          if (pcSelectedSeats.length > 0) {
            updatePCGridInput();
          }
          pclisteners = false;
          $('#pcModalCenter').modal('hide');
        };
      }
    }





  </script>

  <script>
    $(document).ready(function () {
      let startInput = $('#startInputFollow');
      let endInput = $('#startInputOutsource');
      let receivedTime = $('#receivedTime');
      let processedTime = $('#processedTime');
      let deathDate = $('#deathDate');
      let recurrenceDate = $('#recurrenceDate');
      let reportedDate = $('#reportedDate');

      const today = new Date();

      startInput.datepicker({
        format: 'dd/mm/yyyy ',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });

      endInput.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      receivedTime.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      processedTime.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      deathDate.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });
      recurrenceDate.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        minDate: today
      });
      reportedDate.datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        todayHighlight: true,
        maxDate: today
      });

    });
    document.getElementById("nextButton1").addEventListener("click", function () {
      const requiredFields = [
        { field: document.getElementById('mrnNo'), name: 'MRN Number' },
        { field: document.getElementById('bioBankId'), name: 'Bio Bank ID' },
        { field: document.getElementById('patAge'), name: 'Age' },
        { field: document.querySelector('input[name="customRadio"]:checked'), name: 'Gender' },
        { field: document.getElementById('cancer_type'), name: 'Cancer Type' },
        { field: document.querySelector('input[name="customProcedure"]:checked'), name: 'Procedure Types' },
        { field: document.querySelector('input[name="MetastasisSample"]:checked'), name: 'Metastasis Sample' },
        { field: document.querySelector('input[name="bloodSample"]:checked'), name: 'Blood Sample' },
        { field: document.querySelector('input[name="specimenSample"]:checked'), name: 'Specimen Sample' },
        { field: document.querySelector('input[name="otherSample"]:checked'), name: 'Other Sample' },
        // { field: document.querySelector('input[name="customConsent"]:checked'), name: 'Consent' },
        // { field: document.querySelector('input[name="IschemicRadio"]:checked'), name: 'Ischemic Sample' },
        // { field: document.querySelector('input[name="processedRadio"]:checked'), name: 'All samples Received Together' }
      ];

      let allFilled = true;
      const emptyFields = [];

      requiredFields.forEach(item => {
        if (!item.field || (item.field.type === 'radio' && !item.field.checked) || (item.field.type === 'number' && item.field.value === '')) {
          allFilled = false;
          emptyFields.push(item.name);
        }
      });
      let mode = localStorage.getItem('mode');

      if (mode === "SearchView" || mode === "pendingView") {
        if (!allFilled) {
          console.log('Please fill in the following required fields:', emptyFields.join(', '));
        }
      }
      else if (!allFilled) {
        alert('Please enter all the required fields');
        return;

      }

      document.getElementById("form1").style.display = "none";
      document.getElementById("form2").style.display = "block";

    });

    document.getElementById("nextButton2").addEventListener("click", function () {
      document.getElementById("form2").style.display = "none";
      document.getElementById("form3").style.display = "block";
    });

    document.getElementById("backButton1").addEventListener("click", function () {
      document.getElementById("form2").style.display = "none";
      document.getElementById("form1").style.display = "block";
    });

    document.getElementById("backButton2").addEventListener("click", function () {
      document.getElementById("form3").style.display = "none";
      document.getElementById("form2").style.display = "block";
    });
  </script>

  <script>
    document.getElementById('subtype').addEventListener('change', function () {
      var selectedValue = this.value;
      var otherSubtypeDiv = document.getElementById('pSubtypeOther');

      if (selectedValue === 'other' || selectedValue === 'option6') {
        otherSubtypeDiv.style.display = 'block';
      } else {
        otherSubtypeDiv.style.display = 'none';
      }
    });

    document.getElementById('ft_tubes').addEventListener('change', function () {
      var selectedValue = this.value;

      if (selectedValue) {
        $('#ftgrid').val('');
        let spGrids = localStorage.getItem("selectedSGrid");
        let ftGrids = localStorage.getItem("LocalFT");

        if (spGrids && ftGrids) {
          let spGridsArray = spGrids.split(',');
          let ftGridsArray = ftGrids.split(',');

          spGridsArray = spGridsArray.filter(grid => !ftGridsArray.includes(grid));
          localStorage.setItem("selectedSGrid", spGridsArray.join(','));
          localStorage.removeItem("LocalFT");
        }
      }
    });

    document.getElementById('fn_tubes').addEventListener('change', function () {
      var selectedValue = this.value;

      if (selectedValue) {
        $('#fngrid').val('');
        let spGrids = localStorage.getItem("selectedSGrid");
        let fnGrids = localStorage.getItem("LocalFN");

        if (spGrids && fnGrids) {
          let spGridsArray = spGrids.split(',');
          let fnGridsArray = fnGrids.split(',');

          spGridsArray = spGridsArray.filter(grid => !fnGridsArray.includes(grid));
          localStorage.setItem("selectedSGrid", spGridsArray.join(','));
          localStorage.removeItem("LocalFN");
        }
      }
    });


    $(document).ready(function () {
      function toggleDeathDate() {
        if ($('#radioDead').is(':checked')) {
          $('#deathDateContainer').show();
        }
        else {
          $('#deathDateContainer').hide();
        }
      }

      toggleDeathDate();

      $('input[name="livestatus"]').change(function () {
        toggleDeathDate();
      });

    });

    $(document).ready(function () {
      function toggleFollowup() {
        if ($('#radioOther').is(':checked')) {
          $('#otherText').show();
        }
        else {
          $('#otherText').hide();
        }
        if ($('#radioRecurrence').is(':checked')) {
          $('#recurID').show();
        }
        else {
          $('#recurID').hide();
        }
        if ($('#radioLost').is(':checked')) {
          $('#lostFollowUpID').show();
        }
        else {
          $('#lostFollowUpID').hide();
        }
        if ($('#radioDiseasePro').is(':checked')) {
          $('#proDisID').show();
          $('#pmr').show();
        }
        else {
          $('#proDisID').hide();
          $('#pmr').hide();
        }
      }
      toggleFollowup();
      $('input[name="flexRadioDefault"]').change(function () {
        toggleFollowup();
      });

      function familyHabitToggle() {
        if ($('#familyHistoryCancer1').is(':checked')) {
          $('#relation_Cancer').show();
        }
        else {
          $('#relation_Cancer').hide();
          $('#familyRelation').val('');
          $('#familyCancerType').val('');
        }
      }

      familyHabitToggle();
      $('input[name="RadioFHabit"]').change(function () {
        familyHabitToggle();
      });

      function ExistComorbidity() {
        if ($('#ECH1').is(':checked')) {
          $('#medications').show();
        }
        else {
          $('#medications').hide();
          $('#comorbidityMedications').val('');
        }
      }

      ExistComorbidity();
      $('input[name="ECH"]').change(function () {
        ExistComorbidity();
      });

      function IHCMarker() {
        if ($('#IHC_yes').is(':checked')) {
          $('#ihcDescr').show();
        }
        else {
          $('#ihcDescr').hide();
          $('#IHC_Description').val('');
        }
      }

      IHCMarker();
      $('input[name="IHC"]').change(function () {
        IHCMarker();
      });

      function GeneticT() {
        if ($('#gt_yes').is(':checked')) {
          $('#dt_Desc').show();
        }
        else {
          $('#dt_Desc').hide();
          $('#GT_Description').val('');
        }
      }

      GeneticT();
      $('input[name="GeneticT"]').change(function () {
        GeneticT();
      });

      function NactYes() {
        if ($('#NACTYes').is(':checked')) {
          $('#nactDC').show();
          $('#nactDLC').show();
        }
        else {
          $('#nactDC').hide();
          $('#nactDLC').hide();
          $('#NACT_cycle').val('');
          $('#NACT_cycle_D').val('');
        }
      }

      NactYes();
      $('input[name="NACT"]').change(function () {
        NactYes();
      });

      function actYes() {
        if ($('#ACTYes').is(':checked')) {
          $('#actDC').show();
          $('#actDLC').show();
        }
        else {
          $('#actDC').hide();
          $('#actDLC').hide();
          $('#actDrugCycles').val('');
          $('#actDateLastCycle').val('');
        }
      }

      actYes();
      $('input[name="ACT"]').change(function () {
        actYes();
      });

      function dcisY() {
        if ($('#dcisY').is(':checked')) {
          $('#dcisGradeSec').show();
        }
        else {
          $('#dcisGradeSec').hide();
          $('#dcisGrade').val('');

        }
      }

      dcisY();
      $('input[name="dcis"]').change(function () {
        dcisY();
      });

      function toggleMetastasisFields() {
        const isMetastasisSampleYes = $('#MetastasisSampleY').is(':checked');
        const isDenovoYes = $('#denovoYes').is(':checked');

        if (isMetastasisSampleYes || isDenovoYes) {
          $('#mptA').show();
          $('#mptS').show();
          $('#mptRS').show();
        } else {
          $('#mptA').hide();
          $('#mptS').hide();
          $('#mptRS').hide();
          $('#mpt_age').val('');
          $('#mpt_site').val('');
          $('#mpt_rs').val('');
        }
      }
      toggleMetastasisFields();
      $('input[name="MetastasisSample"], input[name="denovo"]').change(function () {
        toggleMetastasisFields();
      });


      function bloodSample() {
        console.log("bloodSample", ($('#bloodSampleY').is(':checked')))
        if ($('#bloodSampleY').is(':checked')) {
          $('#plasmatubes').show();
          $('#serumtubes').show();
          $('#bufferCoatTubes').show();
        }
        else if ($('#bloodSampleN').is(':checked')) {
          $('#plasmatubes').hide();
          $('#serumtubes').hide();
          $('#bufferCoatTubes').hide();
          $('#PlasmagridNo').val('');
          $('#SerumgridNo').val('')
          $('#bufferCoatgridNo').val('')
          let pGrids = localStorage.getItem("LocalPlasma");
          let sGrids = localStorage.getItem("LocalSerum");
          let bcGrids = localStorage.getItem("LocalBuffy");

          if (pGrids !== null) {
            let mainGrids = localStorage.getItem("selectedGrid");

            let mainGridsArray = mainGrids.split(',');
            let pGridsArray = pGrids.split(',');

            mainGridsArray = mainGridsArray.filter(grid => !pGridsArray.includes(grid));

            localStorage.setItem("selectedGrid", mainGridsArray.join(','));
            localStorage.removeItem("LocalPlasma");
          }
          if (sGrids !== null) {
            let mainGrids = localStorage.getItem("selectedGrid");

            let mainGridsArray = mainGrids.split(',');
            let sGridsArray = sGrids.split(',');

            mainGridsArray = mainGridsArray.filter(grid => !sGridsArray.includes(grid));

            localStorage.setItem("selectedGrid", mainGridsArray.join(','));
            localStorage.removeItem("LocalSerum");
          }
          if (bcGrids !== null) {
            let mainGrids = localStorage.getItem("selectedGrid");

            let mainGridsArray = mainGrids.split(',');
            let bcGridsArray = bcGrids.split(',');

            mainGridsArray = mainGridsArray.filter(grid => !bcGridsArray.includes(grid));

            localStorage.setItem("selectedGrid", mainGridsArray.join(','));
            localStorage.removeItem("LocalBuffy");
          }

        }
      }
      bloodSample();
      $('input[name="bloodSample"]').change(function () {
        bloodSample();
      });

      function otherSample() {
        if ($('#otherSampleY').is(':checked')) {
          $('#oSampleTubes').show();
          $('#oSampleDesc').show();
        }
        else if ($('#otherSampleN').is(':checked')) {
          $('#oSampleTubes').hide();
          $('#oSampleDesc').hide();
          $('#OSgridNo').val('');
          $('#otSampleDesc').val('');

          let osGrids = localStorage.getItem("LocalOther");

          if (osGrids !== null) {
            let mainGrids = localStorage.getItem("selectedGrid");
            let mainGridsArray = mainGrids.split(',');
            let osGridsArray = osGrids.split(',');

            mainGridsArray = mainGridsArray.filter(grid => !osGridsArray.includes(grid));

            localStorage.setItem("selectedGrid", mainGridsArray.join(','));
            localStorage.removeItem("LocalOther");
          }
        }
      }

      otherSample();
      $('input[name="otherSample"]').change(function () {
        otherSample();
      });

      function specimenSample() {
        if ($('#specimenSampleY').is(':checked')) {
          $('#countFttubes').show();
          $('#fttubes').show();
          $('#countFntubes').show();
          $('#fntubes').show();
        }
        else if ($('#specimenSampleN').is(':checked')) {
          $('#countFttubes').hide();
          $('#fttubes').hide();
          $('#countFntubes').hide();
          const spgrid = [];
          localStorage.removeItem("selectedSGrid");
          localStorage.removeItem("LocalFN");
          localStorage.removeItem("LocalFT");
          $('#fntubes').hide();
          $('#ftgrid').val('');
          $('#fngrid').val('');
          $('#ft_tubes').val('0');
          $('#fn_tubes').val('0');
        }
      }

      specimenSample();
      $('input[name="specimenSample"]').change(function () {
        specimenSample();
      });




      function rltSample() {
        if ($('#rltSampleY').is(':checked')) {
          $('#rltSampleTubes').show();
        }
        else if ($('#rltSampleN').is(':checked')) {
          localStorage.removeItem("LocalRltGrid");
          localStorage.removeItem("rltSelectedGrid");
          $('#rltSampleTubes').hide();
          $('#rltSgridNo').val('');


          // let rltGrids = localStorage.getItem("LocalRltGrid");

          // if (rltGrids !== null) {
          //   let mainGrids = localStorage.getItem("selectedRltGrid");
          //   let rltMainGridsArray = mainGrids.split(',');
          //   let rltGridsArray = rltGrids.split(',');

          //   rltMainGridsArray = rltMainGridsArray.filter(grid => !rltGridsArray.includes(grid));

          //   localStorage.setItem("selectedRltGrid", rltMainGridsArray.join(','));
          //   localStorage.removeItem("LocalRltGrid");

          // }
        }
      }

      rltSample();
      $('input[name="rltSample"]').change(function () {
        rltSample();
      });

      function pcbSample() {
        if ($('#pcbSampleY').is(':checked')) {
          // $('#pcbSampleTubes').show();
          $('#pcbViable').show();
          if ($('#pcbVY').is(':checked')) {
            $('#pcbSampleTubes').show();
          }

        }
        else if ($('#pcbSampleN').is(':checked')) {
          $('#pcbSampleTubes').hide();
          $('input[name="pcbV"]').prop('checked', false);
          $('#pcbViable').hide();
          $('#pcSgridNo').val('');
          localStorage.removeItem("LocalPC");
          localStorage.removeItem("pcSelectedGrid");
        }
      }

      pcbSample();
      $('input[name="pcbSample"]').change(function () {
        pcbSample();
      });

      function pcbV() {
        if ($('#pcbVY').is(':checked')) {
          $('#pcbSampleTubes').show();
        }
        else {
          $('#pcbSampleTubes').hide();
          $('#pcSgridNo').val('');
          localStorage.removeItem("LocalPC");
          localStorage.removeItem("pcSelectedGrid");
        }
      }

      pcbV();
      $('input[name="pcbV"]').change(function () {
        pcbV();
      });

      function sampleReceive() {
        console.log("Function checking", $('#radioprocessed1').is(':checked'), $('#radioprocessed2').is(':checked'))
        if ($('#radioprocessed1').is(':checked')) {
          $('#receiveAllSample').show();
          $('#processAllSample').show();
          $('#AllSamplesProcess').show();
          $('#BprocessedBy').val('');
          $('#bloodSampleReceivedDate').val('');
          $('#bloodSampleReceivedTime').val('');
          $('#bloodSampleProcessedDate').val('');
          $('#bloodSampleProcessedTime').val('');
          $('#SprocessedBy').val('');
          $('#SpecimenSampleReceivedDate').val('');
          $('#SpecimenSampleReceivedTime').val('');
          $('#SpecimenSampleProcessedDate').val('');
          $('#SpecimenSampleProcessedTime').val('');
          $('#OprocessedBy').val('');
          $('#OtherSampleReceivedDate').val('');
          $('#OtherSampleReceivedTime').val('');
          $('#OtherSampleProcessedDate').val('');
          $('#OtherSampleProcessedTime').val('');
          $('#RLTprocessedBy').val('');
          $('#RLTSampleReceivedDate').val('');
          $('#RLTSampleReceivedTime').val('');
          $('#RLTSampleProcessedDate').val('');
          $('#RLTSampleProcessedTime').val('');
          $('#PCprocessedBy').val('');
          $('#PCSampleReceivedDate').val('');
          $('#PCSampleReceivedTime').val('');
          $('#PCSampleProcessedDate').val('');
          $('#PCSampleProcessedTime').val('');

        }
        else if ($('#radioprocessed2').is(':checked')) {
          $('#receiveAllSample').hide();
          $('#processAllSample').hide();
          $('#AllSamplesProcess').hide();
          $('#processedBy').val('');
          $('#sampleReceivedDate').val('');
          $('#sampleReceivedTime').val('');
          $('#sampleProcessedDate').val('');
          $('#sampleProcessedTime').val('');
        }
        else if (!($('#radioprocessed1').is(':checked')) && !($('#radioprocessed2').is(':checked'))) {
          $('#receiveAllSample').hide();
          $('#processAllSample').hide();
          $('#AllSamplesProcess').hide();
          $('#processedBy').val('');
          $('#sampleReceivedDate').val('');
          $('#sampleReceivedTime').val('');
          $('#sampleProcessedDate').val('');
          $('#sampleProcessedTime').val('');
          $('#BprocessedBy').val('');
          $('#bloodSampleReceivedDate').val('');
          $('#bloodSampleReceivedTime').val('');
          $('#bloodSampleProcessedDate').val('');
          $('#bloodSampleProcessedTime').val('');
          $('#SprocessedBy').val('');
          $('#SpecimenSampleReceivedDate').val('');
          $('#SpecimenSampleReceivedTime').val('');
          $('#SpecimenSampleProcessedDate').val('');
          $('#SpecimenSampleProcessedTime').val('');
          $('#OprocessedBy').val('');
          $('#OtherSampleReceivedDate').val('');
          $('#OtherSampleReceivedTime').val('');
          $('#OtherSampleProcessedDate').val('');
          $('#OtherSampleProcessedTime').val('');
        }
        if (($('#radioprocessed2').is(':checked')) && ($('#bloodSampleY').is(':checked'))) {
          $('#receiveBloodSample').show();
          $('#processBloodSample').show();
          $('#BloodSamplesProcess').show();
        }
        else {
          $('#receiveBloodSample').hide();
          $('#processBloodSample').hide();
          $('#BloodSamplesProcess').hide();

        }
        if (($('#radioprocessed2').is(':checked')) && ($('#specimenSampleY').is(':checked'))) {
          $('#receiveSpecimenSample').show();
          $('#processSpecimenSample').show();
          $('#SpecimenSamplesProcess').show();
        }
        else {
          $('#receiveSpecimenSample').hide();
          $('#processSpecimenSample').hide();
          $('#SpecimenSamplesProcess').hide();

        }
        if (($('#radioprocessed2').is(':checked')) && ($('#otherSampleY').is(':checked'))) {
          $('#receiveOtherSample').show();
          $('#processOtherSample').show();
          $('#OtherSamplesProcess').show();
        }
        else {
          $('#receiveOtherSample').hide();
          $('#processOtherSample').hide();
          $('#OtherSamplesProcess').hide();
        }
        if (($('#radioprocessed2').is(':checked')) && ($('#rltSampleY').is(':checked'))) {
          $('#receiveRLTSample').show();
          $('#processRLTSample').show();
          $('#RLTSamplesProcess').show();
        }
        else {
          $('#receiveRLTSample').hide();
          $('#processRLTSample').hide();
          $('#RLTSamplesProcess').hide();
        }
        if (($('#radioprocessed2').is(':checked')) && ($('#pcbSampleY').is(':checked'))) {
          $('#receivePCSample').show();
          $('#processPCSample').show();
          $('#PCSamplesProcess').show();
        }
        else {
          $('#receivePCSample').hide();
          $('#processPCSample').hide();
          $('#PCSamplesProcess').hide();
        }
      }

      sampleReceive();
      $('input[name="processedRadio"]').change(function () {
        sampleReceive();
      });

      // function sampleBloodReceive() {
      //   if (($('#radioprocessed2').is(':checked'))&&($('#bloodSampleY').is(':checked'))) {
      //     $('#receiveBloodSample').show();
      //     $('#processBloodSample').show();
      //   }
      //   else {
      //     $('#receiveBloodSample').hide();
      //     $('#processBloodSample').hide();
      //   }
      // }

      // sampleBloodReceive();
      // $('input[name="processedRadio"]').change(function () {
      //   sampleBloodReceive();
      // });

      // function sampleSpecimenReceive() {
      //   if (($('#radioprocessed2').is(':checked'))&&($('#specimenSampleY').is(':checked'))) {
      //     $('#receiveSpecimenSample').show();
      //     $('#processSpecimenSample').show();
      //   }
      //   else {
      //     $('#receiveSpecimenSample').hide();
      //     $('#processSpecimenSample').hide();
      //   }
      // }

      // sampleSpecimenReceive();
      // $('input[name="processedRadio"]').change(function () {
      //   sampleSpecimenReceive();
      // });
      // function sampleOtherReceive() {
      //   if (($('#radioprocessed2').is(':checked'))&&($('#otherSampleY').is(':checked'))) {
      //     $('#receiveOtherSample').show();
      //     $('#processOtherSample').show();
      //   }
      //   else {
      //     $('#receiveOtherSample').hide();
      //     $('#processOtherSample').hide();
      //   }
      // }

      // sampleOtherReceive();
      // $('input[name="processedRadio"]').change(function () {
      //   sampleOtherReceive();
      // });

      function RadioTYes() {
        if ($('#RTYes').is(':checked')) {
          $('#rtDC').show();
          $('#rtDLC').show();
        }
        else {
          $('#rtDC').hide();
          $('#rtDLC').hide();
          $('#radiotherapyDetails').val('');
          $('#radiotherapyLastCycleDate').val('');
        }
      }

      RadioTYes();
      $('input[name="RadioT"]').change(function () {
        RadioTYes();
      });

      function pbYes() {
        if ($('#pbYes').is(':checked')) {
          $('#PBN').show();
        }
        else {
          $('#PBN').hide();
          $('#PBInput').val('');
        }
      }

      pbYes();
      $('input[name="pbT"]').change(function () {
        pbYes();
      });

      //form3

      function sharestatusYes() {
        if ($('#radioPartial').is(':checked')) {
          $('#partialSamples').show();
        }
        else {
          $('#partialSamples').hide();
        }
      }

      sharestatusYes();
      $('input[name="sharestatus"]').change(function () {
        sharestatusYes();
      });


      function parity() {
        let parityValue = parseInt($('#parity').val(), 10);

        if (parityValue > 15) {
          parityValue = 0;
          $('#parity').val(parityValue);
        } else if (parityValue < 0) {
          parityValue = 0;
          $('#parity').val(parityValue);
        }

        if (parityValue > 0) {
          $('#noChild').show();
        } else {
          $('#noChild').hide();
        }
      }
      parity();
      $('#parity').on('input', function () {
        parity();
      });

      $('#patAge').on('input', function () {
        let patAgeValue = parseInt($('#patAge').val(), 10);

        if (patAgeValue > 100) {
          patAgeValue = 0;
          $('#patAge').val(patAgeValue);
        } else if (patAgeValue < 0) {
          patAgeValue = 0;
          $('#patAge').val(patAgeValue);
        }
      });
      $('#positiveNodes').on('input', function () {
        let positiveNodesValue = parseInt($('#positiveNodes').val(), 10);
        let nodesTested = document.getElementById('nodesTested').value;

        if (positiveNodesValue > nodesTested) {
          positiveNodesValue = 0;
          $('#positiveNodes').val(positiveNodesValue);
        } else if (positiveNodesValue < 0) {
          positiveNodesValue = 0;
          $('#positiveNodes').val(positiveNodesValue);
        }
      });


      function numChild() {
        let numChildValue = parseInt($('#numChild').val(), 10);

        if (numChildValue > 30) {
          numChildValue = 0;
          $('#numChild').val(numChildValue);
        } else if (numChildValue < 0) {
          numChildValue = 0;
          $('#numChild').val(numChildValue);
        }

        if (numChildValue > 0) {
          $('#ageFC').show();
          $('#breFd').show();
        } else {
          $('#ageFC').hide();
          $('#breFd').hide();
        }
      }
      numChild();
      $('#numChild').on('input', function () {
        numChild();
      });

      function breFd() {
        if ($('#breFdYes').is(':checked')) {
          $('#durFeed').show();
        }
        else {
          $('#durFeed').hide();
        }
      }
      breFd();
      $('#breFd').on('change', function () {
        breFd();
      });



    });

  </script>


  <script>
    // function formatbtHPEInput(input) {
    //   let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
    //   let formattedValue = '';

    //   if (value.length > 2) {
    //     formattedValue += value.substring(0, 2) + '-';
    //     if (value.length > 3) {
    //       formattedValue += value.substring(2, 3) + '-';
    //       formattedValue += value.substring(3, 9);
    //     } else {
    //       formattedValue += value.substring(2, 3);
    //     }
    //   } else {
    //     formattedValue = value;
    //   }

    //   input.value = formattedValue;
    // }
    function formatbtHPEInput(input) {
      let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
      let formattedValue = '';

      let firstTwoNumbers = value.substring(0, 2).replace(/[^0-9]/g, '');

      let thirdAlphabet = value.substring(2, 3).replace(/[^a-zA-Z]/g, '');

      let remaining = value.substring(3, 9);

      if (firstTwoNumbers.length === 2) {
        formattedValue += firstTwoNumbers + '-';

        if (thirdAlphabet.length === 1) {
          formattedValue += thirdAlphabet + '-';
          formattedValue += remaining;
        }
      } else {
        formattedValue = firstTwoNumbers;
      }

      input.value = formattedValue;
    }


    // function formatStHPEInput(input) {
    //   let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
    //   let formattedValue = '';

    //   if (value.length > 2) {
    //     formattedValue += value.substring(0, 2) + '-';
    //     if (value.length > 3) {
    //       formattedValue += value.substring(2, 3) + '-';
    //       formattedValue += value.substring(3, 9);
    //     } else {
    //       formattedValue += value.substring(2, 3);
    //     }
    //   } else {
    //     formattedValue = value;
    //   }

    //   input.value = formattedValue;
    // }

    function formatStHPEInput(input) {
      let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
      let formattedValue = '';

      let firstTwoNumbers = value.substring(0, 2).replace(/[^0-9]/g, '');

      let thirdAlphabet = value.substring(2, 3).replace(/[^a-zA-Z]/g, '');

      let remaining = value.substring(3, 9);

      if (firstTwoNumbers.length === 2) {
        formattedValue += firstTwoNumbers + '-';

        if (thirdAlphabet.length === 1) {
          formattedValue += thirdAlphabet + '-';
          formattedValue += remaining;
        }
      } else {
        formattedValue = firstTwoNumbers;
      }

      input.value = formattedValue;
    }
    // function formatPBInput(input) {
    //   let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
    //   let formattedValue = '';

    //   if (value.length > 2) {
    //     formattedValue += value.substring(0, 2) + '-';
    //     if (value.length > 3) {
    //       formattedValue += value.substring(2, 3) + '-';
    //       formattedValue += value.substring(3, 7);
    //     } else {
    //       formattedValue += value.substring(2, 3);
    //     }
    //   } else {
    //     formattedValue = value;
    //   }

    //   input.value = formattedValue;
    // }

    function formatPBInput(input) {
      let value = input.value.replace(/[^a-zA-Z0-9]/g, '');
      let formattedValue = '';

      let firstTwoNumbers = value.substring(0, 2).replace(/[^0-9]/g, '');

      let thirdAlphabet = value.substring(2, 3).replace(/[^a-zA-Z]/g, '');

      let remaining = value.substring(3, 7);

      if (firstTwoNumbers.length === 2) {
        formattedValue += firstTwoNumbers + '-';

        if (thirdAlphabet.length === 1) {
          formattedValue += thirdAlphabet + '-';
          formattedValue += remaining;
        }
      } else {
        formattedValue = firstTwoNumbers;
      }

      input.value = formattedValue;
    }

    function formatBioInput(input) {
      let value = input.value.replace(/[^a-zA-Z0-9]/g, '');

      let ct = document.getElementById('cancer_type').value;

      if (ct === "brst" && !value.startsWith("BR")) {
        input.value = `BR${value}`;
      }
      if (input === "") {
        input.value = '';
      }
    }




  </script>

  <script>
    const prevBtns = document.querySelectorAll(".btn-prev");
    const nextBtns = document.querySelectorAll(".btn-next");
    const progress = document.getElementById("progress");
    const formSteps = document.querySelectorAll(".form-step");
    const progressSteps = document.querySelectorAll(".progress-step");

    let formStepsNum = 0;

    nextBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        formStepsNum++;
        updateFormSteps();
        updateProgressbar();
      });
    });

    prevBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        formStepsNum--;
        updateFormSteps();
        updateProgressbar();
      });
    });

    function updateFormSteps() {
      formSteps.forEach((formStep) => {
        formStep.classList.contains("form-step-active") &&
          formStep.classList.remove("form-step-active");
      });

      formSteps[formStepsNum].classList.add("form-step-active");
    }

    function updateProgressbar() {
      progressSteps.forEach((progressStep, idx) => {
        if (idx < formStepsNum + 1) {
          progressStep.classList.add("progress-step-active");
        } else {
          progressStep.classList.remove("progress-step-active");
        }
      });

      const progressActive = document.querySelectorAll(".progress-step-active");

      progress.style.width =
        ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
    }
    // window.onload = function () {
    //   let storedMrn = localStorage.getItem('MRN');
    //   let storeBio = localStorage.getItem("BioVal");
    //   console.log("storedMrn",storedMrn)
    //   console.log("storeBio",storeBio)

    //   if (storedMrn) {
    //     document.getElementById('mrnNo').value = storedMrn;
    //   }
    //   if (storeBio) {
    //     document.getElementById('bioBankId').value = storeBio;
    //   }

    // };

    window.onload = function () {
      let storedMrn = localStorage.getItem('MRN');
      let storeBio = localStorage.getItem("BioVal");
      localStorage.removeItem("selectedGrid");
      localStorage.removeItem("selectedSGrid");
      localStorage.removeItem("LocalPlasma")
      localStorage.removeItem("LocalSerum")
      localStorage.removeItem("LocalBuffy")
      localStorage.removeItem("LocalOther")
      localStorage.removeItem("LocalFT");
      localStorage.removeItem("LocalFN");

      // if (storedMrn) {
      //   document.getElementById('mrnNo').value = storedMrn;
      // }
      // if (storeBio) {
      //   document.getElementById('bioBankId').value = storeBio;
      // }
    };
    $(document).ready(function () {
      // document.getElementById("bloodSampleN").addEventListener('click', function () {
      //   localStorage.removeItem("LocalPlasma");
      //   localStorage.removeItem("LocalSerum");
      //   localStorage.removeItem("LocalBuffy");
      // });

      var subtypeElement = document.getElementById('subtype');
      var otherSubtypeDiv = document.getElementById('pSubtypeOther');

      // Check the initial value of the subtype dropdown
      if (subtypeElement.value === 'other' || subtypeElement.value === 'option6') {
        otherSubtypeDiv.style.display = 'block';
      } else {
        otherSubtypeDiv.style.display = 'none';
      }
    });



    document.addEventListener('DOMContentLoaded', function () {
      const formData = sessionStorage.getItem('formData');
      let mode = localStorage.getItem('mode');
      let biobankID = localStorage.getItem('bioid')
      console.log("mode", mode)
      if (mode === 'SearchView' || mode === 'PendingView') {
        const formElements = document.querySelectorAll('input, select, textarea');
        const doneBtn = document.getElementById("sampleEntry1");
        const submitBtn = document.getElementById("submitButton");
        const finishBtn = document.getElementById('finishButton');
        const followUpBtn = document.getElementById('subFollowUp');
        // document.getElementById('tab2-tab').classList.add('disabled');
        // document.getElementById('tab3-tab').classList.add('disabled');
        document.getElementById("backToCardBtn").style.display = 'none';
        document.getElementById("sharedSampleBox").style.display = 'none';
        document.getElementById("shareSubmit").style.display = 'none';
        document.getElementById("rcbScores").placeholder = "";
        document.getElementById('breadBack').style.display = "block";

        // formElements.forEach(element => {
        //   element.disabled = true;
        // });
        formElements.forEach(element => {
          const idsToExclude = ['PlasmagridNo', 'SerumgridNo', 'bufferCoatgridNo', 'OSgridNo', 'ftgrid', 'fngrid', 'rltSgridNo', 'pcSgridNo'];

          // Only disable elements that are not in idsToExclude and have a value
          if (!idsToExclude.includes(element.id)) {
            element.disabled = true;
          }
        });
        finishBtn.style.display = 'block'
        doneBtn.style.display = 'none'
        followUpBtn.style.display = 'none'
        submitBtn.style.display = 'none'
        document.getElementById('sefCurrentUser').style.display = "block"
        document.getElementById('mdCurrentUser').style.display = "block"
        document.getElementById('brfCurrentUser').style.display = "block"
      }
      else if (mode === 'ViewFollowUp') {
        const formElements = document.querySelectorAll('input, select, textarea');
        const doneBtn = document.getElementById("sampleEntry1");
        const submitBtn = document.getElementById("submitButton");
        const finishBtn = document.getElementById('finishButton');
        const followUpBtn = document.getElementById('subFollowUp');
        document.getElementById('tab1-tab').classList.add('disabled');
        document.getElementById('tab3-tab').classList.add('disabled');

        // formElements.forEach(element => {
        //   element.disabled = true;
        // });
        formElements.forEach(element => {
          const idsToExclude = ['PlasmagridNo', 'SerumgridNo', 'bufferCoatgridNo', 'OSgridNo', 'ftgrid', 'fngrid', 'rltSgridNo', 'pcSgridNo'];

          // Only disable elements that are not in idsToExclude and have a value
          if (!idsToExclude.includes(element.id)) {
            element.disabled = true;
          }
        });
        finishBtn.style.display = 'block'
        doneBtn.style.display = 'none'
        followUpBtn.style.display = 'none'
        submitBtn.style.display = 'none'
        document.getElementById('sefCurrentUser').style.display = "block"
        document.getElementById('mdCurrentUser').style.display = "block"
        document.getElementById('brfCurrentUser').style.display = "block"
      }

      // else if (mode === 'SearchEdit') {
      //   // document.getElementById('mrnNo').setAttribute('disabled', true);
      //   document.getElementById('bioBankId').setAttribute('disabled', true);
      // }
      else if (mode === 'SearchEdit' || mode === 'PendingEdit') {
        document.getElementById('mrnNo').setAttribute('disabled', true);
        document.getElementById('bioBankId').setAttribute('disabled', true);
        document.getElementById('cancer_type').setAttribute('disabled', true);
        document.getElementById('breadBack').style.display = "block";


        if (mode === 'PendingEdit') {
          document.getElementById('tab2-tab').classList.add('disabled');
        }

        document.getElementById('tab3-tab').classList.add('disabled');
        document.getElementById('patAge').setAttribute('disabled', true);

        const gdrInputs = document.querySelectorAll('input[name="customRadio"]');
        gdrInputs.forEach(input => {
          input.setAttribute('disabled', true);
          console.log(`Input with ID ${input.id} disabled`);
        });

        const pocedureInputs = document.querySelectorAll('input[name="customProcedure"]');
        pocedureInputs.forEach(input => {
          input.setAttribute('disabled', true);
          console.log(`Input with ID ${input.id} disabled`);
        });

        // const MSInputs = document.querySelectorAll('input[name="MetastasisSample"]');
        // MSInputs.forEach(input => {
        //   input.setAttribute('disabled', true);
        //   console.log(`Input with ID ${input.id} disabled`);
        // });

        const finishBtn = document.getElementById('finishButton');

        finishBtn.style.display = 'none';
      }
      else if (mode === "EditFollowUps") {
        document.getElementById('tab1-tab').classList.add('disabled');
        document.getElementById('tab3-tab').classList.add('disabled');
      }

      else if (mode === "undefined") {
        console.log("mode", mode)
        const finishBtn = document.getElementById('finishButton');

        finishBtn.style.display = 'none'
        document.getElementById('tab2-tab').classList.add('disabled');
        document.getElementById('tab3-tab').classList.add('disabled');
      }



      if (formData && mode !== "undefined") {

        const data = JSON.parse(formData);
        console.log("Data retrieved from sessionStorage:", data);
        localStorage.removeItem("bloodVStatus");
        localStorage.removeItem("specimenVStatus");
        localStorage.removeItem("otherVStatus");

        if (data.ie) fillIeForm(data.ie);
        if (data.md) fillMdForm(data.md);
        if (data.brf) fillBrfForm(data.brf);
        // console.log("data.ie.bs", data.ie.bs)
        const bloodSampleInputs = document.querySelectorAll('input[name="bloodSample"]');
        const specimenSampleInputs = document.querySelectorAll('input[name="specimenSample"]');
        const otherSampleInputs = document.querySelectorAll('input[name="otherSample"]');
        const rltSampleInputs = document.querySelectorAll('input[name="rltSample"]');
        const pcSampleInputs = document.querySelectorAll('input[name="pcbSample"]');
        localStorage.setItem("bloodVStatus", data.ie.bs);
        localStorage.setItem("specimenVStatus", data.ie.ss);
        localStorage.setItem("otherVStatus", data.ie.osmp);
        localStorage.setItem("rltVStatus", data.ie.rltS);
        localStorage.setItem("pcVStatus", data.ie.pcS);

        if (mode === 'SearchEdit' || mode === 'PendingEdit') {
          if (data.ie.bs === 'true') {
            bloodSampleInputs.forEach(input => {
              input.setAttribute('disabled', true);
              console.log(`Input with ID ${input.id} disabled`);
            });
          } else {
            bloodSampleInputs.forEach(input => {
              input.removeAttribute('disabled');
              console.log(`Input with ID ${input.id} enabled`);
            });
          }
          if (data.ie.ss === 'true') {
            document.getElementById('ft_tubes').setAttribute('disabled', true);
            document.getElementById('fn_tubes').setAttribute('disabled', true);
            specimenSampleInputs.forEach(input => {
              input.setAttribute('disabled', true);
              console.log(`Input with ID ${input.id} disabled`);
              localStorage.removeItem("LocalFT");
            });
          } else {
            specimenSampleInputs.forEach(input => {
              input.removeAttribute('disabled');
              console.log(`Input with ID ${input.id} enabled`);
            });
          }
          if (data.ie.osmp === 'true') {
            otherSampleInputs.forEach(input => {
              input.setAttribute('disabled', true);
              console.log(`Input with ID ${input.id} disabled`);
            });
          } else {
            otherSampleInputs.forEach(input => {
              input.removeAttribute('disabled');
              console.log(`Input with ID ${input.id} enabled`);
            });
          }
          if (data.ie.rltS === 'true') {
            rltSampleInputs.forEach(input => {
              input.setAttribute('disabled', true);
              console.log(`Input with ID ${input.id} disabled`);
            });
          } else {
            rltSampleInputs.forEach(input => {
              input.removeAttribute('disabled');
              console.log(`Input with ID ${input.id} enabled`);
            });
          }
          if (data.ie.pcS === 'true') {
            pcSampleInputs.forEach(input => {
              input.setAttribute('disabled', true);
              console.log(`Input with ID ${input.id} disabled`);
            });
          } else {
            pcSampleInputs.forEach(input => {
              input.removeAttribute('disabled');
              console.log(`Input with ID ${input.id} enabled`);
            });
          }
          document.getElementById('tab2').classList.add('disabled');
          document.getElementById('tab3').classList.add('disabled');
        }

      } else {
        console.error('No data found in sessionStorage');
      }
      if (mode === 'ViewFollowUp') {
        retrieveFollowup(biobankID);

      }

    });

    document.addEventListener('DOMContentLoaded', function () {
      let mode = localStorage.getItem('mode');
      console.log("mode checking ", mode);

      if (mode === "" || mode === undefined) {
        // Clear all input fields
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
          if (input.type === 'radio' || input.type === 'checkbox') {
            input.checked = false; // Uncheck radio buttons and checkboxes
          }
        });


        // // Clear all select elements
        // const selects = document.querySelectorAll('select');
        // selects.forEach(select => select.selectedIndex = 0);

        // // Clear all textareas
        // const textareas = document.querySelectorAll('textarea');
        // textareas.forEach(textarea => textarea.value = '');
      }
    });

  </script>
  <script>
    let userN = sessionStorage.getItem('userName');
    console.log("User Name", userN)


    // function shareData(selectedPatients) {
    //   console.log("Shared patients :", selectedPatients);
    // }
    document.addEventListener('DOMContentLoaded', function () {
      const selectedPatients = JSON.parse(localStorage.getItem('selectedPatients'));

      console.log('Retrieved selectedPatients:', selectedPatients);
    });
    document.getElementById('shareForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const timestamp = Math.floor(Date.now() / 1000);

      const dateOfEntry = document.getElementById('startInputOutsource').value;
      const institute = document.getElementById('institute').value;
      const projectName = document.getElementById('projectName').value;
      const nopi = document.getElementById('nopi').value;
      const sharedStatus = document.querySelector('input[name="sharestatus"]:checked').value;
      const parSharedRemark = document.getElementById('parSharedRemark').value;

      // Retrieve selected patients from localStorage
      const selectedPatients = JSON.parse(localStorage.getItem('selectedPatients'));

      if (!selectedPatients || selectedPatients.length === 0) {
        alert("No patients selected.");
        return;
      }

      // Prepare the database structure
      const database = {};  // This will be your database object

      selectedPatients.forEach(patient => {
        const { bioBankId, seqKey, boxName, gridData } = patient;

        // Ensure gridData is an array
        let seatList = Array.isArray(gridData) ? gridData : gridData.split(',').map(seat => seat.trim());

        // Fetch existing sections from Firebase for the specific bioBankId
        db.ref(`Os/${bioBankId}`).once('value')
          .then(snapshot => {
            const sections = snapshot.val();

            // Create the structure for each patient
            const patientEntry = {
              doe: dateOfEntry,
              dpt: institute,
              prj: projectName,
              pip: nopi || "N/A",
              os_ub: userN,
              lbi: {},
              ossts: sharedStatus,
              psr: parSharedRemark || "N/A"
            };

            // Check if the patient entry already exists in the database structure
            if (!database[bioBankId]) database[bioBankId] = {};
            if (!database[bioBankId][seqKey]) database[bioBankId][seqKey] = {};
            if (!database[bioBankId][seqKey][timestamp]) {
              database[bioBankId][seqKey][timestamp] = patientEntry;
            }
            let existingEntry = {};

            existingEntry = database[bioBankId][seqKey][timestamp];
            const storedBnData = JSON.parse(localStorage.getItem('bnData'));
            console.log('Retrieved bnData from local storage:', storedBnData);

            const boxEntry = storedBnData.find(entry => entry.name === boxName);
            const box_id = boxEntry.id;

            if (!existingEntry.lbi[box_id]) {
              existingEntry.lbi[box_id] = [];
            }

            // Iterate over gridData to append each seatID to the array
            seatList.forEach(seatID => {
              existingEntry.lbi[box_id].push(seatID.trim());
            });
            return db.ref(`Os/${bioBankId}/${seqKey}/${timestamp}`).set(existingEntry);

            // Initialize lbi[boxName] as an array if it doesn't exist


            // Update Firebase with the consolidated data
          })
          .then(() => {
            // alert('Form submitted successfully for BioBank ID: ' + bioBankId);

            const seatPromises = seatList.map(seatID => {
              seatID = seatID.trim();
              const index = getSeatIndex(seatID);

              // Retrieve the bn data from localStorage
              const storedBnData = JSON.parse(localStorage.getItem('bnData'));

              // Find the box entry based on the box name
              const boxEntry = storedBnData.find(entry => entry.name === boxName);

              if (boxEntry) {
                // const [id, boxData] = boxEntry;
                const box_id = boxEntry.id;

                // Handle updating both bb and sb nodes in parallel
                const bbPromise = db.ref(`bb/${box_id}`).once('value')
                  .then(snapshot => {
                    if (snapshot.exists()) {
                      return db.ref(`bb/${box_id}/${index}`).update({ status: sharedStatus });
                    } else {
                      console.log("bb does not exist");
                    }
                  });

                const sbPromise = db.ref(`sb/${box_id}`).once('value')
                  .then(snapshot => {
                    if (snapshot.exists()) {
                      return db.ref(`sb/${box_id}/${index}`).update({ status: sharedStatus });
                    } else {
                      console.log("sb does not exist");
                    }
                  });
                const rltPromise = db.ref(`rlt/${box_id}`).once('value')
                  .then(snapshot => {
                    if (snapshot.exists()) {
                      return db.ref(`rlt/${box_id}/${index}`).update({ status: sharedStatus });
                    } else {
                      console.log("RLT does not exist");
                    }
                  }); const pcbPromise = db.ref(`pcb/${box_id}`).once('value')
                    .then(snapshot => {
                      if (snapshot.exists()) {
                        return db.ref(`pcb/${box_id}/${index}`).update({ status: sharedStatus });
                      } else {
                        console.log("Primary Culture does not exist");
                      }
                    });
                // Return a promise that resolves when both bb and sb updates are complete
                return Promise.all([bbPromise, sbPromise, rltPromise, pcbPromise]);
              } else {
                console.error(`Box name "${box_id}" not found in localStorage.`);
              }
            });

            Promise.all(seatPromises)
              .then(() => {
                console.log("All seat updates completed.");

                // Redirect based on the mode
                let mode = localStorage.getItem('mode');
                switch (mode) {
                  case 'SearchView':
                  case 'SearchEdit':
                  case 'share':
                    window.location.href = 'search.html';
                    break;
                  case 'PendingView':
                  case 'PendingEdit':
                  case 'EditFollowUps':
                  case 'ViewFollowUp':
                    window.location.href = 'todo.html';
                    break;
                  default:
                    window.location.href = 'home.html';
                    break;
                }
              })
              .catch(error => {
                console.error('Error in seatPromises:', error);
              });

          })
          // .then(() => {
          //   // Redirect based on the mode
          //   let mode = localStorage.getItem('mode');
          //   switch (mode) {
          //     case 'SearchView':
          //     case 'SearchEdit':
          //     case 'share':
          //       window.location.href = 'search.html';
          //       break;
          //     case 'PendingView':
          //     case 'PendingEdit':
          //     case 'EditFollowUps':
          //     case 'ViewFollowUp':
          //       window.location.href = 'todo.html';
          //       break;
          //     default:
          //       window.location.href = 'home.html';
          //       break;
          //   }
          // })

          .catch(error => {
            console.error('Error:', error);
            alert('Error submitting form for BioBank ID: ' + bioBankId);
          });
      });

      console.log("Database structure to be saved:", database);
    });

  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Assuming you have Firebase initialized already

      // Fetch the bioBankId from the input field
      var bioidFetch = document.getElementById("bioBankId").value;

      if (bioidFetch) {
        // Query Firebase to get the MRN number for the given bioBankId
        db.ref('bbnmrn').orderByValue().equalTo(bioidFetch).once('value', snapshot => {
          if (snapshot.exists()) {
            // Retrieve the MRN key (which is the MRN number)
            const mrnNumber = Object.keys(snapshot.val())[0];
            console.log("MRN Number for BioBank ID", bioidFetch, ":", mrnNumber);

            document.getElementById("mrnNo").value = mrnNumber;
          } else {
            console.log("No MRN found for BioBank ID:", bioidFetch);
          }
        }).catch(error => {
          console.error("Error fetching MRN:", error);
        });
      } else {
        console.log("BioBank ID is empty or undefined.");
      }
    });

  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      let mode = localStorage.getItem('mode');
      let biobankID = localStorage.getItem('sharedbioid');
      console.log("mode in shared :", mode)
      if (mode === 'share') {
        console.log("Adv. Happy New Year");
        document.getElementById('tab2-tab').classList.add('disabled');
        document.getElementById('tab1-tab').classList.add('disabled');
        document.getElementById("backToCardBtn").style.display = 'none';
        document.getElementById("sharedSampleBox").style.display = 'none';

        document.getElementById('sharedCard').style.display = 'none';
        document.getElementById('shareForm').style.display = 'block';


      }

      if (mode === 'sharedView') {
        const formElements = document.querySelectorAll('input, select, textarea');
        const doneBtn = document.getElementById("sampleEntry1");
        const submitBtn = document.getElementById("shareSubmit");
        document.getElementById('tab2-tab').classList.add('disabled');
        document.getElementById('tab1-tab').classList.add('disabled');
        // Disable all form elements
        formElements.forEach(element => {
          // Exclude the input with id 'sharedSampleBox' from being disabled
          if (element.id !== 'sharedSample') {
            element.disabled = true;
          }
        });



        document.getElementById('sharedSampleBox').style.display = 'block';
        document.getElementById('sharedCard').style.display = 'block';
        document.getElementById('shareForm').style.display = 'none';
        doneBtn.style.display = 'none';
        submitBtn.style.display = 'none';
      }

      console.log("bhanu");
      retrieveOs(biobankID);
    });




  </script>
  <script>
    //    function toggleRadio(radio) {
    //   if (radio.checked) {
    //     radio.wasChecked = true;
    //   }
    //   radio.onclick = function () {
    //     if (radio.wasChecked) {
    //       radio.checked = false;
    //       radio.wasChecked = false;
    //     } else {
    //       // Get all radios with the same name and uncheck the others
    //       const radiosInGroup = document.getElementsByName(radio.name);
    //       radiosInGroup.forEach(r => r.wasChecked = false);
    //       radio.wasChecked = true;
    //     }
    //   };
    // }

    // // Get all radio buttons on the page
    // const allRadioButtons = document.querySelectorAll('input[type="radio"]');

    // // Apply the toggle function to each radio button
    // allRadioButtons.forEach(toggleRadio);

    function createEraseIcon(groupName) {
      const img = document.createElement('img');
      img.src = 'assets/images/erase.svg';
      img.alt = 'erase';
      img.width = 30;
      img.height = 30;
      img.style.verticalAlign = 'middle';
      img.style.cursor = 'pointer';
      img.style.marginRight = '5px';

      // Add click event listener to clear radio button selection
      img.onclick = function () {
        clearRadioSelection(groupName);
      };

      return img;
    }

    // Function to clear the selected radio buttons
    function clearRadioSelection(groupName) {
      const radios = document.getElementsByName(groupName);
      radios.forEach(radio => radio.checked = false);
      if (groupName === 'RadioFHabit') {
        familyHabitToggle();
      }
      if (groupName === 'ECH') {
        ExistComorbidity();
      }
      if (groupName === 'IHC') {
        IHCMarker();
      }
      if (groupName === 'GeneticT') {
        GeneticT();
      }
      if (groupName === 'NACT') {
        NactYes();
      }
      if (groupName === 'ACT') {
        actYes();
      }
      if (groupName === 'RadioT') {
        RadioTYes();
      }
      if (groupName === 'processedRadio') {
        console.log("Function call")
        sampleReceive();
      }
      if (groupName = 'pbT') {
        pbYes();
      }
      if (groupName = 'dcis') {
        dcisY();
      }
      if (groupName = 'denovo') {
        denovo();
      }
    }

    // Function to append erase icons to specified radio groups
    function addEraseIconToGroups() {
      const radioGroups = [
        { groupName: 'customConsent', containerClass: 'erase-icon-container-consent' },
        { groupName: 'IschemicRadio', containerClass: 'erase-icon-container' },
        { groupName: 'processedRadio', containerClass: 'erase-icon-container-samRev' },
        { groupName: 'RadioFHabit', containerClass: 'erase-icon-container-RadioFHabit' },
        { groupName: 'RadioFdHabit', containerClass: 'erase-icon-container-RadioFdHabit' },
        { groupName: 'RadioAlcoholHabit', containerClass: 'erase-icon-container-RadioAlcoholHabit' },
        { groupName: 'RadioSmokeHabit', containerClass: 'erase-icon-container-RadioSmokeHabit' },
        { groupName: 'ECH', containerClass: 'erase-icon-container-ECH' },
        { groupName: 'tumorSite', containerClass: 'erase-icon-container-tumorSite' },
        { groupName: 'IHC', containerClass: 'erase-icon-container-IHC' },
        { groupName: 'GeneticT', containerClass: 'erase-icon-container-GeneticT' },
        { groupName: 'focal', containerClass: 'erase-icon-container-focal' },
        { groupName: 'LVI', containerClass: 'erase-icon-container-LVI' },
        { groupName: 'PNI', containerClass: 'erase-icon-container-PNI' },
        { groupName: 'denovo', containerClass: 'erase-icon-container-denovo' },
        { groupName: 'MetaPT', containerClass: 'erase-icon-container-MPT' },
        { groupName: 'NACT', containerClass: 'erase-icon-container-NACT' },
        { groupName: 'ACT', containerClass: 'erase-icon-container-ACT' },
        { groupName: 'RadioT', containerClass: 'erase-icon-container-RadioT' },
        { groupName: 'pbT', containerClass: 'erase-icon-container-pbT' },
        { groupName: 'mStatus', containerClass: 'erase-icon-container-mStatus' },
        { groupName: 'ERRadio', containerClass: 'erase-icon-container-ERRadio' },
        { groupName: 'PRRadio', containerClass: 'erase-icon-container-PRRadio' },
        { groupName: 'HER2Radio', containerClass: 'erase-icon-container-HER2Radio' },
        { groupName: 'dcis', containerClass: 'erase-icon-container-dcis' }
      ];

      radioGroups.forEach(group => {
        const container = document.querySelector(`.${group.containerClass}`);
        if (container) {
          let mode = localStorage.getItem('mode');
          if (mode !== 'SearchView' && mode !== 'PendingView') {
            console.log("mode: ", mode)
            const eraseIcon = createEraseIcon(group.groupName);
            container.appendChild(eraseIcon);
          }
        }
      });
    }

    // Call the function to append icons on page load
    window.onload = addEraseIconToGroups;
  </script>

  <script>

    document.addEventListener("DOMContentLoaded", function () {
      updateNavigation();
    });

    function updateNavigation() {
      var links = document.querySelectorAll(".navLinks");
      let mode = localStorage.getItem("mode");
      let bioBankId = localStorage.getItem("bioBankId");
      let lastSection = localStorage.getItem("lastSection");
      let user = sessionStorage.getItem('userName');
      let act = {
        "mode": "",
        "user": user
      };

      let confirmationActive = false;
      let confirmationCancel = false;
      let formSubmitting = false;

      if (mode === "SearchEdit" || mode === "PendingEdit") {
        history.pushState(null, null, window.location.href);

        function handleNavigation(event, isBackAction = false, link = null) {
          if (confirmationActive || formSubmitting) {
            return;
          }

          event.preventDefault();

          let text = isBackAction
            ? "Are you sure you want to navigate back without saving your data?"
            : "Are you sure you want to leave without saving your data?";
          let userConfirmed = confirm(text);

          if (userConfirmed) {
            confirmationCancel = false;
            confirmationActive = true;

            db.ref(`act/${bioBankId}/${lastSection}`).set(act)
              .then(() => {
                console.log("New act set, proceeding with navigation.");

                if (isBackAction) {
                  history.back();
                } else if (link && link.getAttribute('data-href')) {
                  window.location.href = link.getAttribute('data-href');
                }
              })
              .catch((error) => {
                console.error("Error setting new act: ", error);
              });
          } else {
            console.log("User canceled navigation.");
            confirmationActive = false;
            confirmationCancel = true;

            if (isBackAction) {
              history.pushState(null, null, window.location.href);
            }
          }
        }

        links.forEach(function (link) {
          link.addEventListener('click', function (e) {
            confirmationActive = false;
            handleNavigation(e, false, link);
          });
        });

        window.addEventListener('popstate', function (event) {
          if (!confirmationActive && !confirmationCancel) {
            handleNavigation(event, true);
          } else if (confirmationCancel) {
            confirmationCancel = false;
          }
        });

        var form1 = document.getElementById("form1");
        var submitButton = document.getElementById("submitButton");
        var sampleEntryButton = document.getElementById("sampleEntry1");

        if (form1) {
          form1.addEventListener("submit", function () {
            formSubmitting = true;
          });

          if (submitButton) {
            submitButton.addEventListener("click", function () {
              formSubmitting = true;
            });
          }

          if (sampleEntryButton) {
            sampleEntryButton.addEventListener("click", function () {
              formSubmitting = true;
            });
          }
        }

        window.addEventListener('beforeunload', function (event) {
          if (!confirmationActive && !formSubmitting) {
            event.preventDefault();
            event.returnValue = null;
          }
        });


      }
      else {
        links.forEach(function (link) {
          link.addEventListener('click', function () {
            window.location.href = link.getAttribute('data-href');
          });
        });
        window.onpopstate = null;
        window.onbeforeunload = null;
      }
    }

  </script>

  <script>
    const rcbScoresInput = document.getElementById('rcbScores');

    rcbScoresInput.addEventListener('input', function () {
      let value = parseFloat(rcbScoresInput.value);

      // Check if the value exceeds the maximum allowed (3.28)
      if (value > 3.28) {
        // If the value is greater than 3.28, reset it to 0
        rcbScoresInput.value = 0;
      } else if (value < 0) {
        // If the value is less than 0, reset it to 0 (optional, depending on the behavior you want)
        rcbScoresInput.value = 0;
      }
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('input[name="customProcedure"]').forEach(function (radio) {
        radio.addEventListener("change", function () {
          console.log("Data testing");

          fillform();
        });
      });
    });
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('input[name="MetastasisSample"]').forEach(function (radio) {
        radio.addEventListener("change", function () {
          console.log("Data testing");

          fillform2();
        });
      });
    });
    function fillform() {
      const proType = document.querySelector('input[name="customProcedure"]:checked').value;

      let mode = localStorage.getItem('mode');
      let biobankID = localStorage.getItem('BioVal')
      console.log("biobankID ", biobankID)
      console.log("proType ", proType)
      db.ref(`sef/${biobankID}/`).once('value').then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          const seqKeys = Object.keys(data);
          seqKeys.sort();
          const lastSeqKey = seqKeys[seqKeys.length - 1];

          const lastSeq = data[lastSeqKey];
          const timestampKeys = Object.keys(lastSeq);
          let ieDataArr = [];
          let mdDataArr = [];
          let brfDataArr = [];

          if (timestampKeys.length > 0) {
            const lastTimestampKey = timestampKeys[timestampKeys.length - 1]; // Get the last timestamp key
            const lastTimestampData = lastSeq[lastTimestampKey]; // Access the last timestamp data

            if (lastTimestampData.ie) {
              ieDataArr = lastTimestampData.ie;
            }
            if (lastTimestampData.md) {
              mdDataArr = lastTimestampData.md;
            }
            if (lastTimestampData.brf) {
              brfDataArr = lastTimestampData.brf;
            }
          }
          console.log("ieDataArr", ieDataArr);
          console.log("mdDataArr", mdDataArr);
          console.log("brfDataArr", brfDataArr);
          if (ieDataArr.tpr === "b" && proType === "r") {
            console.log("hello")
            document.getElementById("cancer_type").value = ieDataArr.ct || '';
            document.querySelector(`input[name="customRadio"][value="${ieDataArr.sx}"]`).checked = true || '';
            if (mdDataArr.fhc !== '') {
              document.querySelector(`input[name="RadioFHabit"][value="${mdDataArr.fhc}"]`).checked = true;
            }
            familyHabitToggle();
            document.getElementById('familyRelation').value = mdDataArr.fhcr || '';
            document.getElementById('familyCancerType').value = mdDataArr.fhct || '';

            if (mdDataArr.fh) document.querySelector(`input[name="RadioFdHabit"][value="${mdDataArr.fh}"]`).checked = true;
            if (mdDataArr.hac) document.querySelector(`input[name="RadioAlcoholHabit"][value="${mdDataArr.hac}"]`).checked = true;
            if (mdDataArr.hs) document.querySelector(`input[name="RadioSmokeHabit"][value="${mdDataArr.hs}"]`).checked = true;
            if (mdDataArr.ec) document.querySelector(`input[name="ECH"][value="${mdDataArr.ec}"]`).checked = true;
            ExistComorbidity();
            document.getElementById('comorbidityMedications').value = mdDataArr.ecm || '';
            if (mdDataArr.tst) document.querySelector(`input[name="tumorSite"][value="${mdDataArr.tst}"]`).checked = true;
            document.getElementById('clinicalStage').value = mdDataArr.cs || '';
            document.getElementById('subtype').value = mdDataArr.pst || '';



            document.getElementById('ageAtMenarche').value = brfDataArr.am || '';
            document.getElementById('parity').value = brfDataArr.pty || '';
            if (brfDataArr.ms) {
              document.querySelector(`input[name="mStatus"][value="${brfDataArr.ms}"]`).checked = true;
            }
            if (brfDataArr.er) {
              document.querySelector(`input[name="ERRadio"][value="${brfDataArr.er}"]`).checked = true;
            }
            if (brfDataArr.pr) {
              document.querySelector(`input[name="PRRadio"][value="${brfDataArr.pr}"]`).checked = true;
            }
            if (brfDataArr.h2) {
              document.querySelector(`input[name="HER2Radio"][value="${brfDataArr.h2}"]`).checked = true;
            }
            document.getElementById('sbt').value = brfDataArr.sbt || '';
            document.getElementById('k67').value = brfDataArr.k67 || '';
            document.getElementById('HistologicalS').value = brfDataArr.ht || '';
          }


          // else if (ieDataArr.tpr === "r" && proType === "r") {
          //   const metastasisS = document.querySelector('input[name="MetastasisSample"]:checked').value;


          //   if (ieDataArr.mts === "false" && metastasisS === "true") {


          //     document.getElementById("cancer_type").value = ieDataArr.ct || '';
          //     document.querySelector(`input[name="customRadio"][value="${ieDataArr.sx}"]`).checked = true || '';
          //     if (mdDataArr.fhc !== '') {
          //       document.querySelector(`input[name="RadioFHabit"][value="${mdDataArr.fhc}"]`).checked = true;
          //     }
          //     familyHabitToggle();
          //     document.getElementById('familyRelation').value = mdDataArr.fhcr || '';
          //     document.getElementById('familyCancerType').value = mdDataArr.fhct || '';

          //     if (mdDataArr.fh) document.querySelector(`input[name="RadioFdHabit"][value="${mdDataArr.fh}"]`).checked = true;
          //     if (mdDataArr.hac) document.querySelector(`input[name="RadioAlcoholHabit"][value="${mdDataArr.hac}"]`).checked = true;
          //     if (mdDataArr.hs) document.querySelector(`input[name="RadioSmokeHabit"][value="${mdDataArr.hs}"]`).checked = true;
          //     if (mdDataArr.ec) document.querySelector(`input[name="ECH"][value="${mdDataArr.ec}"]`).checked = true;
          //     ExistComorbidity();
          //     document.getElementById('comorbidityMedications').value = mdDataArr.ecm || '';
          //     if (mdDataArr.tst) document.querySelector(`input[name="tumorSite"][value="${mdDataArr.tst}"]`).checked = true;
          //     document.getElementById('clinicalStage').value = mdDataArr.cs || '';
          //     document.getElementById('subtype').value = mdDataArr.pst || '';



          //     document.getElementById('ageAtMenarche').value = brfDataArr.am || '';
          //     document.getElementById('parity').value = brfDataArr.pty || '';
          //     if (brfDataArr.ms) {
          //       document.querySelector(`input[name="mStatus"][value="${brfDataArr.ms}"]`).checked = true;
          //     }
          //     if (brfDataArr.er) {
          //       document.querySelector(`input[name="ERRadio"][value="${brfDataArr.er}"]`).checked = true;
          //     }
          //     if (brfDataArr.pr) {
          //       document.querySelector(`input[name="PRRadio"][value="${brfDataArr.pr}"]`).checked = true;
          //     }
          //     if (brfDataArr.h2) {
          //       document.querySelector(`input[name="HER2Radio"][value="${brfDataArr.h2}"]`).checked = true;
          //     }
          //     document.getElementById('sbt').value = brfDataArr.sbt || '';
          //     document.getElementById('k67').value = brfDataArr.k67 || '';
          //     document.getElementById('HistologicalS').value = brfDataArr.ht || '';
          //   }
          // }
        
        } 
        else {
          return;
        }
      });

    }
  
    function fillform2() {
      const proType = document.querySelector('input[name="customProcedure"]:checked').value;

      let mode = localStorage.getItem('mode');
      let biobankID = localStorage.getItem('BioVal')
      console.log("biobankID ", biobankID)
      console.log("proType ", proType)
      db.ref(`sef/${biobankID}/`).once('value').then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          const seqKeys = Object.keys(data);
          seqKeys.sort();
          const lastSeqKey = seqKeys[seqKeys.length - 1];

          const lastSeq = data[lastSeqKey];
          const timestampKeys = Object.keys(lastSeq);
          let ieDataArr = [];
          let mdDataArr = [];
          let brfDataArr = [];

          if (timestampKeys.length > 0) {
            const lastTimestampKey = timestampKeys[timestampKeys.length - 1]; // Get the last timestamp key
            const lastTimestampData = lastSeq[lastTimestampKey]; // Access the last timestamp data

            if (lastTimestampData.ie) {
              ieDataArr = lastTimestampData.ie;
            }
            if (lastTimestampData.md) {
              mdDataArr = lastTimestampData.md;
            }
            if (lastTimestampData.brf) {
              brfDataArr = lastTimestampData.brf;
            }
          }
          console.log("ieDataArr", ieDataArr);
          console.log("mdDataArr", mdDataArr);
          console.log("brfDataArr", brfDataArr);
          if (ieDataArr.tpr === "r" && proType === "r") {
            const metastasisS = document.querySelector('input[name="MetastasisSample"]:checked').value;


            if (ieDataArr.mts === "false" && metastasisS === "true") {


              document.getElementById("cancer_type").value = ieDataArr.ct || '';
              document.querySelector(`input[name="customRadio"][value="${ieDataArr.sx}"]`).checked = true || '';
              if (mdDataArr.fhc !== '') {
                document.querySelector(`input[name="RadioFHabit"][value="${mdDataArr.fhc}"]`).checked = true;
              }
              familyHabitToggle();
              document.getElementById('familyRelation').value = mdDataArr.fhcr || '';
              document.getElementById('familyCancerType').value = mdDataArr.fhct || '';

              if (mdDataArr.fh) document.querySelector(`input[name="RadioFdHabit"][value="${mdDataArr.fh}"]`).checked = true;
              if (mdDataArr.hac) document.querySelector(`input[name="RadioAlcoholHabit"][value="${mdDataArr.hac}"]`).checked = true;
              if (mdDataArr.hs) document.querySelector(`input[name="RadioSmokeHabit"][value="${mdDataArr.hs}"]`).checked = true;
              if (mdDataArr.ec) document.querySelector(`input[name="ECH"][value="${mdDataArr.ec}"]`).checked = true;
              ExistComorbidity();
              document.getElementById('comorbidityMedications').value = mdDataArr.ecm || '';
              if (mdDataArr.tst) document.querySelector(`input[name="tumorSite"][value="${mdDataArr.tst}"]`).checked = true;
              document.getElementById('clinicalStage').value = mdDataArr.cs || '';
              document.getElementById('subtype').value = mdDataArr.pst || '';

              document.getElementById('ageAtMenarche').value = brfDataArr.am || '';
              document.getElementById('k67').value = brfDataArr.k67 || '';
              document.getElementById('HistologicalS').value = brfDataArr.ht || '';
            }
          }
        } else {
          return;
        }
      });

    }
  
  </script>
</body>

</html>
